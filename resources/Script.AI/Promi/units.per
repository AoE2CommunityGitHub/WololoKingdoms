(defrule
	(true)
=>
	(set-goal traintransport no)
	(set-goal trainvillager no)
	(set-goal traincart no)
	(set-goal trainmonk no)
	(set-goal trainunique no)
	(set-goal trainpetard no)
	(set-goal traintrebuchet no)
	(set-goal trainram no)
	(set-goal trainmangonel no)
	(set-goal trainscorpion no)
	(set-goal trainbombard no)
	(set-goal trainfish no)
	(set-goal traingalley no)
	(set-goal trainfire no)
	(set-goal traindemo no))
(defrule
	(true)
=>
	(set-goal trainturtle no)
	(set-goal trainlongboat no)
	(set-goal traincannon no)
	(set-goal trainarcher no)
	(set-goal trainskirm no)
	(set-goal trainhandcannon no)
	(set-goal traincavarcher no)
	(set-goal trainslinger no)
	(set-goal trainpike no)
	(set-goal trainchamp no)
	(set-goal traineagle no)
	(set-goal traincondottiero no)
	(set-goal traincamel no)
	(set-goal trainknight no)
	(set-goal trainhussar no))
(defrule
	(true)
=>
	(set-goal traincog no)
	(set-goal traincaravel no)
	(set-goal trainbattle no)
	(set-goal traingenitour no))
;=========================================================
; Civilian units
;=========================================================
;=========================================================
; Transport ships
;=========================================================
(defrule
	(goal islands yes)
(or	(population >= max-civ-pop)
	(goal attacking yes))
(or	(soldier-count >= 10)
	(population >= del-civ-pop))
(or	(strategic-number sn-military-superiority >= 1)
	(strategic-number teamsuperiority >= 1))
	(goal underattack no)
	(unit-type-count-total transport-ship < maxtransports)
	(unit-type-count-total transport-ship < 6); for now
=>
	(set-goal traintransport yes))
(defrule
	(goal islands yes)
(or	(strategic-number sn-current-age >= imperial)
(or	(population >= max-civ-pop)
	(goal attacking yes)))
(or	(population >= max-civ-pop)
	(and	(soldier-count >= 10)
		(or	(up-compare-goal navycount >= 10)
			(goal enemy-boats no))))
	(unit-type-count-total transport-ship < maxtransports)
	(unit-type-count-total transport-ship < 6); for now
=>
	(set-goal traintransport yes))
;=========================================================
; Villagers
;=========================================================
(defrule
	(strategic-number sn-current-age <= dark);	(up-research-status c: feudal-age == research-available)
	(up-timer-status FDrop == timer-running)
	(building-type-count town-center == 1)
	(up-pending-objects c: villager >= 1)
=>
	(up-jump-rule 11))
(defrule
(or	(strategic-number sn-current-age > dark)
	(and	(up-compare-goal total-food-amount >= 750); 900
		(and	(up-research-status c: feudal-age == research-available)
			(or	(up-compare-goal total-food-amount >= 900); 1100
				(unit-type-count-total villager >= 15))))); 24
=>
	(up-jump-rule 4))
(defrule
	(up-compare-goal strategy == r-flush)
	(up-compare-goal enemyState <= dark)
	(wood-amount < 175); test
	(building-type-count-total barracks <= 0)
	(unit-type-count-total villager < 23)
	(civilian-population < 25); for odd cases
=>
	(set-goal trainvillager yes))
(defrule
(or	(up-compare-goal strategy == r-flush)
	(up-compare-goal strategy == usual))
(or	(unit-type-count-total villager < 21)
(or	(and	(up-compare-goal total-food-amount < 500); 480); 470
		(unit-type-count-total villager < 23)); 22
	(and	(up-compare-goal total-food-amount < 480); 460); 440
		(unit-type-count-total villager < 25))))
=>
	(set-goal trainvillager yes))
(defrule
	(up-compare-goal strategy != r-flush)
	(up-compare-goal strategy != usual)
(or	(unit-type-count-total villager < 20)
(or	(and	(up-compare-goal total-food-amount < 500)
		(unit-type-count-total villager < 21))
(or	(and	(up-compare-goal total-food-amount < 480); 470); 460
		(unit-type-count-total villager < 22))
	(and	(up-compare-goal total-food-amount < 460); 440); 420
		(unit-type-count-total villager < 23)))))
=>
	(set-goal trainvillager yes))
(defrule
(or	(up-compare-goal strategy == drush)
(or	(up-compare-goal strategy == s-flush)
	(up-compare-goal strategy == r-flush)))
	(unit-type-count-total villager < 22)
(or	(up-compare-goal strategy != s-flush)
	(unit-type-count-total villager < 21))
	(building-type-count-total barracks <= 0);	(building-type-count-total lumber-camp <= 1)
	(wood-amount < 175); 100
=>
	(set-goal trainvillager yes)); end jump
;=========================================================
(defrule
	(up-research-status c: feudal-age == research-available)
(or	(and	(up-compare-goal total-food-amount >= 700)
		(unit-type-count-total villager >= 30))
	(and	(up-compare-goal total-food-amount >= 1000)
		(or	(up-compare-goal total-food-amount >= 1100)
			(unit-type-count-total villager >= 24))))
=>
	(up-jump-rule 5))
(defrule
	(up-research-status c: feudal-age == research-available)
(or	(unit-type-count-total villager >= 25); 26
	(up-compare-goal total-food-amount >= 450)); 440
	(up-compare-goal total-food-amount >= 400);
	(unit-type-count-total villager >= 21)
;(or	(and	(up-compare-goal total-food-amount >= 800); 720
;		(unit-type-count-total fishing-ship >= 5)); 7
(or	(goal strategy sling)
	(up-compare-goal strategy-type == feudal-war));)
=>
	(up-jump-rule 4))

;(defrule
;	(unit-type-count-total villager < darkvills); max
;(or	(and	(up-compare-goal total-food-amount < 765); 810
;		(unit-type-count-total villager < 29))
;	(and	(up-compare-goal total-food-amount < 830); 860
;		(unit-type-count-total villager < 28)))
;	(strategic-number sn-current-age == dark)
;;(or
;	(nand	(up-compare-goal enemy-goal == flush)
;		(goal strategy usual)); test
;;	(goal strategy drush))
;=>
;	(set-goal trainvillager yes))
;(defrule
;	(unit-type-count-total villager < darkvills); max
;(or	(and	(up-compare-goal total-food-amount < 905); 910)
;		(unit-type-count-total villager < 27))
;	(and	(up-compare-goal total-food-amount < 970); 960
;		(unit-type-count-total villager < 26)))
;	(strategic-number sn-current-age == dark)
;;(or
;	(nand	(up-compare-goal enemy-goal == flush)
;		(goal strategy usual)); test
;;	(goal strategy drush))
;=>
;	(set-goal trainvillager yes))

(defrule
	(unit-type-count-total villager < darkvills); max
(or	(unit-type-count-total villager < 25)
	(up-compare-goal total-food-amount < 900))
(or	(unit-type-count-total villager < 26)
	(up-compare-goal total-food-amount < 850))
(or	(unit-type-count-total villager < 27)
	(up-compare-goal total-food-amount < 800))
	(strategic-number sn-current-age == dark)
;(or
	(nand	(up-compare-goal enemy-goal == flush)
		(goal strategy usual)); test
;	(goal strategy drush))
=>
	(set-goal trainvillager yes))
(defrule
	(unit-type-count-total villager < darkvills); max
(or	(unit-type-count-total villager < 28)
	(up-compare-goal total-food-amount < 750))
(or	(unit-type-count-total villager < 29)
	(up-compare-goal total-food-amount < 700))
(or	(unit-type-count-total villager < 30)
	(up-compare-goal total-food-amount < 650))
	(strategic-number sn-current-age == dark)
;(or
	(nand	(up-compare-goal enemy-goal == flush)
		(goal strategy usual)); test
;	(goal strategy drush))
=>
	(set-goal trainvillager yes))
(defrule
	(unit-type-count-total villager < darkvills); max
	(goal drushmicro yes)
	(up-compare-goal trainvillager != yes)
	(up-compare-goal total-food-amount < 750)
(or	(building-type-count-total farm g:< maxfarms)
	(up-compare-goal total-food-amount < 700))
(or	(up-compare-goal strategy-type >= castle-war)
	(up-compare-goal total-food-amount < 475))
	(strategic-number sn-current-age == dark)
=>
	(set-goal trainvillager yes))
(defrule
	(unit-type-count-total villager < darkvills); max
;	(up-compare-goal total-food-amount < 1035); 470
(or	(unit-type-count-total villager < 21)
(or	(nand	(up-compare-goal enemy-goal == flush)
		(goal strategy usual)); test
	(up-compare-goal total-food-amount < 470)))
	(unit-type-count-total villager < 25); 24
	(strategic-number sn-current-age == dark)
=>
	(set-goal trainvillager yes)); end jump ; end big jump
;=========================================================
(defrule
(or	(goal position-goal pocket)
(or	(up-compare-goal enemyState <= dark)
;(or	(players-current-age every-enemy <= dark-age); test
	(goal strategy drush)));)
	(up-compare-goal strategy-type != feudal-war);
	(building-type-count town-center >= 2)
	(unit-type-count-total villager < 36)
	(up-compare-goal total-food-amount < 440)
	(up-compare-goal total-food-amount < feudal-food)
	(strategic-number sn-current-age <= dark)
=>
	(set-goal trainvillager yes))
;=========================================================
(defrule
(or	(strategic-number sn-current-age == dfeudal)
	(and	(goal strategy sling)
		(goal woodavailable yes)))
	(strategic-number sn-current-age >= dfeudal)
=>
	(set-goal trainvillager yes))
;=========================================================
(defrule
(or	(unit-type-count-total villager < 18)
	(and	(up-compare-goal total-food-amount < 650); 660
		(goal woodavailable yes)))
	(strategic-number sn-current-age == feudal)
=>
	(set-goal trainvillager yes))
;=========================================================
(defrule
	(strategic-number sn-current-age == feudal)
=>
	(up-get-fact unit-type-count villager feudalvills)
	(up-modify-goal feudalvills c:+ 2)
;	(up-chat-data-to-player my-player-number "feudalvills: %d" g: feudalvills)
	(disable-self))
(defrule
(not	(can-research-with-escrow castle-age))
	(dropsite-min-distance wood >= 0)
	(dropsite-min-distance wood < 255)
	(strategic-number sn-current-age == feudal)
	(unit-type-count-total villager g:< feudalvills)
=>
	(set-goal trainvillager yes))
;=========================================================
(defrule
	(up-pending-objects c: villager <= 0)
	(up-compare-goal total-food-amount >= 770)
;	(building-type-count blacksmith == 0)
	(building-type-count archery-range == 0)
	(building-type-count stable == 0)
	(building-type-count market == 0)
	(goal woodavailable yes)
	(strategic-number sn-current-age == feudal)
=>
	(set-goal trainvillager yes))
;=========================================================
(defrule
	(up-pending-objects c: villager <= 0)
	(up-compare-goal total-food-amount >= 770)
	(building-type-count blacksmith == 0); test
	(goal woodavailable yes)
	(strategic-number sn-current-age == feudal)
=>
	(set-goal trainvillager yes))
;=========================================================
(defrule
	(up-pending-objects c: villager <= 0)
	(up-compare-goal total-food-amount >= 620)
;	(gold-amount >= 150)
	(up-compare-goal strategy-type >= castle-war)
	(building-type-count blacksmith == 0)
	(goal woodavailable yes)
	(strategic-number sn-current-age == feudal)
=>
	(set-goal trainvillager yes))
;=========================================================
(defrule
	(up-pending-objects c: villager <= 0)
	(up-compare-goal total-food-amount >= 850)
	(gold-amount <= 170)
	(gold-amount < castle-gold)
;(not	(can-research-with-escrow castle-age)) ^ stops CA research delay with the new queuesys
	(goal woodavailable yes)
	(strategic-number sn-current-age == feudal)
=>
	(set-goal trainvillager yes))
;=========================================================
#load-if-defined WONDER-RACE
(defrule
(or	(unit-type-count-total villager < 50)
	(and	(strategic-number sn-current-age >= imperial)
		(unit-type-count-total villager < 60)))
	(strategic-number sn-current-age >= fcastlea)
=>
	(set-goal trainvillager yes))
#else
(defrule
(or	(unit-type-count-total villager < 9)
(or	(population < max-civ-pop)
	(and	(unit-type-count-total villager < 50)
		(population < del-civ-pop))))
	(civilian-population < up-max-civ)
	(unit-type-count-total villager < min-number-vills); 60
	(strategic-number sn-current-age >= fcastlea)
=>
	(set-goal trainvillager yes))
;=========================================================
(defrule
	(up-compare-goal strategy-type == feudal-war)
	(strategic-number sn-current-age >= dfeudal)
=>
	(set-goal trainvillager yes))
;=========================================================
(defrule
	(unit-type-count-total villager < min-number-vills); 60
(or	(and	(strategic-number sn-current-age >= fcastlea)
		(and	(dropsite-min-distance wood < 20)
			(goal woodavailable yes)))
	(unit-type-count-total villager < 2))
=>
	(set-goal trainvillager yes))
;=========================================================
(defrule
	(strategic-number sn-current-age >= fcastlea)
	(dropsite-min-distance wood < 20)
(or	(wood-amount < 400)
(or	(food-amount < 400)
(or	(gold-amount < 400)
(or	(up-compare-goal excessWood < 200)
(or	(up-compare-goal excessFood < 200)
	(up-compare-goal excessGold < 200))))))
	(goal woodavailable yes)
=>
	(set-goal trainvillager yes))
;=========================================================
(defrule
	(unit-type-count-total villager < res-vills-d)
	(dropsite-min-distance wood < 20)
	(up-compare-goal tradeunits < 40)
(or	(wood-amount < 3200)
(or	(food-amount < 3200)
	(gold-amount < 3200)))
	(goal woodavailable yes)
	(strategic-number sn-current-age >= fcastlea)
=>
	(set-goal trainvillager yes))
;=========================================================
(defrule
	(unit-type-count-total villager < res-vills-c)
	(dropsite-min-distance wood < 20)
	(up-compare-goal tradeunits < 40)
(or	(wood-amount < 2400)
(or	(food-amount < 2400)
	(gold-amount < 2400)))
	(goal woodavailable yes)
	(strategic-number sn-current-age >= fcastlea)
=>
	(set-goal trainvillager yes))
;=========================================================
(defrule
	(unit-type-count-total villager < res-vills-b)
	(dropsite-min-distance wood < 20)
	(up-compare-goal tradeunits < 40)
(or	(wood-amount < 1500)
(or	(food-amount < 1500)
	(gold-amount < 1500)))
	(goal woodavailable yes)
	(strategic-number sn-current-age >= fcastlea)
=>
	(set-goal trainvillager yes))
;=========================================================
(defrule
	(unit-type-count-total villager < res-vills-a)
	(dropsite-min-distance wood < 20)
	(up-compare-goal tradeunits < 40)
(or	(wood-amount < 700)
(or	(food-amount < 700)
	(gold-amount < 700)))
	(goal woodavailable yes)
	(strategic-number sn-current-age >= fcastlea)
=>
	(set-goal trainvillager yes))
;=========================================================
(defrule
	(research-available feudal-age)
	(goal trainvillager yes)
(or	(unit-type-count-total villager >= 23)
	(goal maa-var yes))
	(unit-type-count-total villager >= 21)
	(up-compare-goal strategy-type == feudal-war)
	(up-compare-goal total-food-amount >= feudal-food)
	(goal position-goal flank)
=>
	(set-goal trainvillager no))
;=========================================================
; Trade Carts
;=========================================================
(defrule
(or	(up-compare-goal tradecarts != yes)
(or	(goal underattack yes)
(or	(players-building-type-count every-ally market <= 0)
(or	(and	(or	(unit-type-count-total 178 >= 3)
			(unit-type-count-total 205 >= 3))
		(up-compare-goal verbuendete <= 0))
(or	(up-compare-goal tradeunits >= maxcartspop); depending on popcap and difficulty
	(up-compare-goal tradeunits >= maxcartssize)))))); depending on map size
=>
	(up-jump-rule 6))
(defrule
(or	(and	(up-research-status c: imperial-age <= research-unavailable)
		(and	(strategic-number sn-current-age < imperial)
			(up-compare-goal excessWood < 300)))
	(and	(up-research-status c: imperial-age == research-available)
		(and	(gold-amount < imperial-gs)
			(gold-amount < 850))))
=>
	(up-jump-rule 1))
(defrule
	(goal dreitc yes)
(or	(up-research-status c: imperial-age >= research-pending)
(or	(game-time >= 2400)
(or	(population >= max-civ-pop)
(or	(civilian-population >= up-max-civ)
(or	(building-type-count-total town-center >= 4)
(or	(wood-amount >= tc-100-wood)
	(stone-amount < 100)))))))
	(up-compare-goal tradeunits < 45)
=>
	(set-goal traincart yes))
(defrule
	(strategic-number sn-current-age >= imperial)
;	(wood-amount >= 200)
(or	(players-building-type-count any-ally market >= 2); test
(or	(game-time >= 2400)
(or	(strategic-number teamsuperiority >= -1);	(goal underattack no)
(or	(strategic-number sn-military-superiority >= -1)
(or	(civilian-population >= up-max-civ)
(or	(population >= max-civ-pop)
	(military-population >= 16)))))))
	(up-compare-goal tradeunits < 45)
=>
	(set-goal traincart yes))
(defrule
	(strategic-number sn-current-age >= imperial)
	(goal dreitc yes)
(or	(building-type-count-total stable >= number-stables)
	(up-compare-goal palagoal != yes))
(or	(building-type-count-total barracks >= number-barracks)
	(up-compare-goal champgoal != yes))
(or	(building-type-count-total stable >= number-stables)
(or	(building-type-count-total archery-range >= number-archery-ranges)
	(building-type-count-total barracks >= number-barracks)))
	(up-compare-goal tradeunits < 45)
=>
	(set-goal traincart yes))
(defrule
(or	(dropsite-min-distance wood >= 24); 40
	(dropsite-min-distance wood <= -1))
	(up-compare-goal tradeunits < 54)
=>
	(set-goal traincart yes))
(defrule
(or	(strategic-number sn-current-age >= fcastlea)
	(gold-amount >= 250))
(or	(strategic-number sn-military-superiority >= -1)
(or	(strategic-number teamsuperiority >= -1);	(goal underattack no)
	(military-population >= 20)))
(nand	(commodity-selling-price wood >= 34)
	(gold-amount < castle-gs))
(or	(dropsite-min-distance gold >= 24); 40
	(dropsite-min-distance gold <= -1))
	(up-compare-goal tradeunits < 54)
=>
	(set-goal traincart yes)); end jump

(defrule
(or	(and	(players-building-type-count every-ally dock == 0)
		(not	(player-in-game any-ally)))
(or	(up-compare-goal tradeunits >= maxcartspop); depending on popcap and difficulty
	(up-compare-goal tradeunits >= maxcartssize))); depending on map size
=>
	(up-jump-rule 1))
(defrule
	(goal tradecarts no)
	(strategic-number sn-current-age >= imperial)
(or	(strategic-number teamsuperiority >= 2)
(or	(strategic-number sn-military-superiority >= 2)
(or	(goal enemy-boats no)
(or	(up-compare-goal biggestenemynavy <= 0)
	(up-compare-goal navycount >= 40)))))
(or	(population >= max-civ-pop)
	(up-idle-unit-count idle-type-villager >= 20))
	(up-compare-goal tradeunits < 40); 45
=>
	(set-goal traincog yes))

(defrule
	(goal tradecarts yes)
;	(population < del-civ-pop)
;	(civilian-population < max-civ-pop)
	(unit-type-count-total villager <= 0)
	(building-type-count town-center <= 0)
	(players-building-type-count any-ally market > 0)
	(up-compare-goal tradeunits < maxcartspop);
	(up-compare-goal tradeunits < maxcartssize);
	(up-compare-goal tradeunits < 75)
=>
	(set-goal traincart yes))
(defrule
	(goal tradecarts no)
;	(population < del-civ-pop)
;	(civilian-population < max-civ-pop)
	(unit-type-count-total villager <= 0)
	(building-type-count town-center <= 0)
	(players-building-type-count any-ally dock > 0)
	(up-compare-goal tradeunits < maxcartspop);
	(up-compare-goal tradeunits < maxcartssize);
	(up-compare-goal tradeunits < 60); 90
=>
	(set-goal traincog yes))

#load-if-defined POPULATION-CAP-EXTENDED
#load-if-not-defined POPULATION-CAP-200
#load-if-not-defined POPULATION-CAP-225
(defrule
(or	(and	(players-building-type-count every-ally market == 0)
		(not	(player-in-game any-ally)))
(or	(up-compare-goal tradeunits >= maxcartspop); depending on popcap and difficulty
	(up-compare-goal tradeunits >= maxcartssize))); depending on map size
=>
	(up-jump-rule 2))
(defrule
	(goal tradecarts yes)
;	(population < del-civ-pop)
;	(civilian-population < max-civ-pop)
	(up-compare-goal excessWood >= 200)
(or	(strategic-number sn-current-age >= imperial)
(or	(up-compare-goal excessWood >= 850)
	(building-type-count-total town-center >= 4)))
	(players-building-type-count any-ally market > 0)
	(up-compare-goal tradeunits < 75)
=>
	(set-goal traincart yes))
(defrule
	(goal tradecarts no)
;	(population < del-civ-pop)
;	(civilian-population < max-civ-pop)
	(up-compare-goal excessWood >= 200)
	(strategic-number sn-current-age >= imperial)
(or	(strategic-number teamsuperiority >= 2)
(or	(strategic-number sn-military-superiority >= 2)
(or	(goal enemy-boats no)
(or	(up-compare-goal biggestenemynavy <= 0)
	(up-compare-goal navycount >= 40)))))
	(players-building-type-count any-ally dock > 0)
	(up-compare-goal tradeunits < 60); 90
=>
	(set-goal traincog yes))
#end-if
#end-if
#end-if
(defrule
(or	(and	(players-building-type-count every-ally market == 0)
		(not	(player-in-game any-ally)))
(or	(up-compare-goal tradeunits >= maxcartspop); depending on popcap and difficulty
	(up-compare-goal tradeunits >= maxcartssize))); depending on map size
=>
	(up-jump-rule 2))
(defrule
	(goal tradecarts yes)
	(goal strategy sling)
	(players-building-type-count any-ally market > 0)
	(up-compare-goal tradeunits < 50)
=>
	(set-goal traincart yes))
(defrule
	(goal tradecarts no)
	(goal strategy sling)
(or	(strategic-number teamsuperiority >= 2)
(or	(strategic-number sn-military-superiority >= 2)
(or	(goal enemy-boats no)
(or	(up-compare-goal biggestenemynavy <= 0)
	(up-compare-goal navycount >= 40)))))
	(players-building-type-count any-ally dock > 0)
	(up-compare-goal tradeunits < 40); 50
=>
	(set-goal traincog yes))
;=========================================================
; Military units
;=========================================================
;=========================================================
; Siege
;=========================================================
;(defrule
;(or	(gold-amount >= 75)
;	(unit-type-count villager-gold >= 2))
;(or	(wood-amount >= 160)
;	(unit-type-count villager-wood >= 4))
;(or	(up-building-type-in-town c: castle >= 1); should be fine even when attacking
;(or	(up-building-type-in-town c: watch-tower >= 4); same here
;	(up-building-type-in-town c: bombard-tower >= 2))); same here
;	(unit-available battering-ram-line)
;	(goal escrowing no)
;=>
;	(set-escrow-percentage wood 100)
;	(set-escrow-percentage gold 100)
;	(set-goal escrowing battering-ram-line))
;(defrule
;	(goal escrowing battering-ram-line)
;	(escrow-amount wood >= 160)
;=>
;	(set-escrow-percentage wood 0))
;(defrule
;	(goal escrowing battering-ram-line)
;	(escrow-amount gold >= 75)
;=>
;	(set-escrow-percentage gold 0))
;(defrule
;(or	(population >= max-pop)
;(or	(unit-type-count-total battering-ram-line >= 2)
;(or	(unit-type-count-total trebuchet-set >= 2)
;(or	(building-type-count-total town-center <= 0)
;	(building-type-count siege-workshop <= 0)))))
;	(goal escrowing battering-ram-line)
;=>
;	(release-escrow wood)
;	(release-escrow gold)
;	(set-escrow-percentage wood 0)
;	(set-escrow-percentage gold 0)
;	(set-goal escrowing 0))
;(defrule
;(or	(population >= max-pop)
;	(not	(unit-available battering-ram-line)))
;	(goal escrowing battering-ram-line)
;=>
;	(release-escrow wood)
;	(release-escrow gold)
;	(set-escrow-percentage wood 0)
;	(set-escrow-percentage gold 0)
;	(set-goal escrowing 0))
;(defrule
;	(goal escrowing battering-ram-line)
;	(can-train-with-escrow battering-ram-line)
;=>
;	(release-escrow wood)
;	(release-escrow gold)
;	(set-escrow-percentage wood 0)
;	(set-escrow-percentage gold 0)
;	(train battering-ram-line)
;	(set-goal escrowing 0))
;=========================================================
(defrule
(or	(strategic-number sn-current-age < imperial)
	(and	(up-compare-goal islands == yes)
		(and	(unit-type-count-total transport-ship < 1)
			(wood-amount < 300))))
=>
	(up-jump-rule 2))
(defrule
	(goal underattack no)
(or	(population >= siege-pop)
(or	(military-population >= 50); 60
(or	(goal siegereq no)
(or	(strategic-number sn-military-superiority >= 1); 2
	(goal attacking yes)))))
(or	(unit-type-count-total trebuchet-set < 2)
	(goal siegereq no))
	(unit-type-count-total trebuchet-set < 5)
=>
	(set-goal traintrebuchet yes))
(defrule
(or	(military-population >= 33); 30
(or	(goal siegereq no)
(or	(strategic-number sn-military-superiority >= 1)
	(goal attacking yes))))
(or	(and	(goal siegereq no)
		(up-research-status c: ri-siege-ram >= research-pending))
	(unit-type-count-total battering-ram-line < 6))
	(unit-type-count-total battering-ram-line < 8)
=>
	(set-goal trainram yes)); total siege units less than #x and y condition (full civ pop?)
;=========================================================
(defrule
	(goal milunits yes)
	(unit-type-count-total trebuchet-set < 4); 5
	(goal underattack no)
(or	(population > max-civ-pop)
	(goal attacking yes))
(or	(goal attacking yes)
	(strategic-number sn-military-superiority >= 0))
(or	(players-building-type-count focus-player castle > 0)
(or	(players-building-type-count focus-player bombard-tower > 0)
	(players-building-type-count focus-player watch-tower > 1)))
=>
	(set-goal traintrebuchet yes))
;=========================================================
(defrule
	(goal milunits yes)
	(unit-type-count-total battering-ram-line < 3); 2
	(enemy-buildings-in-town)
(or	(players-building-type-count focus-player castle > 0)
(or	(players-building-type-count focus-player bombard-tower > 0)
	(players-building-type-count focus-player watch-tower > 1)))
	(unit-type-count-total trebuchet-set < 3)
=>
	(set-goal traintrebuchet yes))
;=========================================================
(defrule
	(goal milunits yes)
	(goal underattack no)
	(strategic-number sn-current-age <= castlea)
	(up-compare-goal strategy-type <= castle-war)
	(military-population >= 22)
	(strategic-number sn-military-superiority >= 0)
	(unit-type-count-total battering-ram-line < 1)
=>
	(set-goal trainram yes))
;=========================================================
(defrule
	(up-compare-goal milunits != no)
	(goal underattack no)
(or	(goal attacking yes)
	(and	(strategic-number sn-military-superiority >= 1)
		(or	(up-compare-goal strategy-type <= castle-war)
			(strategic-number sn-current-age >= imperial))));(current-age >= imperial-age))))
	(unit-type-count-total battering-ram-line < 3)
=>
	(set-goal trainram yes))
;=========================================================
(defrule
	(goal milunits yes)
	(goal underattack no)
(or	(goal attacking yes)
	(and	(strategic-number sn-military-superiority >= 2)
		(or	(up-compare-goal strategy-type <= castle-war)
			(strategic-number sn-current-age >= imperial))));(current-age >= imperial-age))))
	(unit-type-count-total battering-ram-line < 5)
=>
	(set-goal trainram yes))
;=========================================================
(defrule
	(goal milunits yes)
	(goal underattack no)
(or	(goal attacking yes)
	(and	(strategic-number sn-military-superiority >= 3)
		(or	(up-compare-goal strategy-type <= castle-war)
			(strategic-number sn-current-age >= imperial))));(current-age >= imperial-age))))
	(unit-type-count-total battering-ram-line < 7)
=>
	(set-goal trainram yes))
;=========================================================
(defrule
;	(goal milunits yes)
	(enemy-buildings-in-town)
(or	(strategic-number sn-current-age == castlea)
	(and	(strategic-number sn-current-age >= imperial)
		(unit-type-count-total trebuchet-set < 3)))
(or	(players-building-type-count focus-player castle >= 2)
(or	(players-building-type-count focus-player bombard-tower >= 2)
	(players-building-type-count focus-player watch-tower >= 4)))
	(unit-type-count-total battering-ram-line < 5)
=>
	(set-goal trainram yes))
;=========================================================
(defrule
;	(goal milunits yes)
	(enemy-buildings-in-town)
(or	(strategic-number sn-current-age == castlea)
	(and	(strategic-number sn-current-age >= imperial)
		(unit-type-count-total trebuchet-set <= 1)))
(or	(players-building-type-count focus-player castle >= 1)
(or	(players-building-type-count focus-player bombard-tower >= 1)
	(players-building-type-count focus-player watch-tower >= 2)))
	(unit-type-count-total battering-ram-line < 5)
=>
	(set-goal trainram yes))
;=========================================================
(defrule
	(goal milunits no)
	(enemy-buildings-in-town)
	(unit-type-count-total battering-ram-line < 2)
	(unit-type-count-total trebuchet-set < 1)
	(unit-type-count-total bombard-cannon < 4)
=>
	(set-goal trainram yes))
#load-if-not-defined INCAN-CIV
#load-if-not-defined INDIAN-CIV
#load-if-not-defined ITALIAN-CIV
#load-if-not-defined MAGYAR-CIV
#load-if-not-defined SLAVIC-CIV
#load-if-not-defined AZTEC-CIV
#load-if-not-defined BRITON-CIV
#load-if-not-defined BYZANTINE-CIV
#load-if-not-defined CELTIC-CIV
#load-if-not-defined CHINESE-CIV
#load-if-not-defined GOTHIC-CIV
#load-if-not-defined HUN-CIV
#load-if-not-defined JAPANESE-CIV
#load-if-not-defined KOREAN-CIV
#load-if-not-defined MONGOL-CIV
#load-if-not-defined MAYAN-CIV
#load-if-not-defined PERSIAN-CIV
#load-if-not-defined FRANKISH-CIV
#load-if-not-defined TEUTONIC-CIV
#load-if-not-defined SARACEN-CIV
#load-if-not-defined VIKING-CIV ; Turks, Spanish
(defrule
	(goal milunits yes)
	(military-population >= 15)
	(goal underattack no)
(or	(goal siegereq no)
(or	(strategic-number sn-military-superiority >= 1); 2
	(goal attacking yes)))
	(strategic-number cavalry < 35)
	(strategic-number eagles < 40)
	(players-unit-type-count focus-player woad-raider-line < 40)
	(unit-type-count-total bombard-cannon < 8)
=>
	(set-goal trainbombard yes))
#load-if-not-defined SPANISH-CIV; Turks
(defrule
	(goal milunits yes)
	(strategic-number skirmsarchers >= 15)
;	(up-research-status c: ri-elite-skirmisher <= research-unavailable)
	(strategic-number cavalry < 35)
	(strategic-number eagles < 40)
	(players-unit-type-count focus-player woad-raider-line < 40)
	(unit-type-count-total bombard-cannon < 8)
=>
	(set-goal trainbombard yes))
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
(defrule
	(goal milunits yes)
	(up-compare-goal mangonel-set < 5)
	(players-unit-type-count focus-player scorpion-line >= 4)
(or	(unit-type-count-total bombard-cannon < 2)
(or	(and	(players-unit-type-count focus-player scorpion-line >= 8)
		(unit-type-count-total bombard-cannon < 4))
(or	(and	(players-unit-type-count focus-player scorpion-line >= 12)
		(unit-type-count-total bombard-cannon < 6))
	(players-unit-type-count focus-player scorpion-line >= 16))))
	(unit-type-count-total bombard-cannon < 8)
=>
	(set-goal trainbombard yes))
(defrule
	(goal milunits yes)
	(up-compare-goal mangonel-set < 8); 5
	(players-unit-type-count focus-player mangonel-line >= 3)
(or	(unit-type-count-total bombard-cannon < 2)
(or	(and	(players-unit-type-count focus-player mangonel-line >= 6)
		(unit-type-count-total bombard-cannon < 4))
(or	(and	(players-unit-type-count focus-player mangonel-line >= 9)
		(unit-type-count-total bombard-cannon < 6))
	(players-unit-type-count focus-player mangonel-line >= 12))))
	(unit-type-count-total bombard-cannon < 8)
=>
	(set-goal trainbombard yes))
(defrule
	(goal milunits yes)
(or	(goal researchplan yes)
(or	(goal attacking yes)
	(current-age-time >= 480)))
(or	(military-population >= 33)
(or	(population >= siege-pop)
	(strategic-number sn-military-superiority >= 1)))
(or	(unit-type-count-total bombard-cannon < 2)
	(up-compare-goal excessGold >= 425))
	(unit-type-count-total bombard-cannon < 4)
=>
	(set-goal trainbombard yes))
;=========================================================
#load-if-not-defined INCAN-CIV
#load-if-not-defined INDIAN-CIV
#load-if-not-defined ITALIAN-CIV
#load-if-not-defined MAGYAR-CIV
#load-if-not-defined SLAVIC-CIV
#load-if-not-defined AZTEC-CIV
#load-if-not-defined BRITON-CIV
#load-if-not-defined BYZANTINE-CIV
#load-if-not-defined CHINESE-CIV
#load-if-not-defined FRANKISH-CIV
#load-if-not-defined GOTHIC-CIV
#load-if-not-defined HUN-CIV
#load-if-not-defined JAPANESE-CIV
#load-if-not-defined MAYAN-CIV
#load-if-not-defined MONGOL-CIV
#load-if-not-defined PERSIAN-CIV
#load-if-not-defined SARACEN-CIV
#load-if-not-defined SPANISH-CIV
#load-if-not-defined TEUTONIC-CIV
#load-if-not-defined TURKISH-CIV
#load-if-not-defined VIKING-CIV ; Koreans;, Celts

;#load-if-not-defined CELTIC-CIV
(defrule
	(goal milunits yes)
	(strategic-number cavalry < 25)
	(strategic-number eagles < 25)
	(players-unit-type-count focus-player woad-raider-line < 28)
	(strategic-number husks < 34)
(or	(strategic-number sn-current-age >= imperial)
	(gold-amount >= 935))
	(up-compare-goal mangonel-set < 20); 24
=>
	(set-goal trainmangonel yes))
;#end-if

#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if

;#load-if-defined CELTIC-CIV
;(defrule
;	(goal milunits yes)
;	(strategic-number cavalry < 25)
;;	(strategic-number husks < 25)
;	(strategic-number eagles < 25)
;	(players-unit-type-count focus-player mangonel-line < 5)
;	(players-unit-type-count focus-player woad-raider-line < 25)
;(or	(strategic-number sn-current-age >= imperial)
;	(strategic-number sn-military-superiority <= -1))
;;	(unit-type-count-total bombard-cannon < 20)
;;	(up-compare-goal mangonel-set < 40)
;;	(unit-type-count-total scorpion-line < 60)
;=>
;	(set-goal trainscorpion yes))
;#end-if

#load-if-defined CHINESE-CIV
(defrule
	(goal milunits yes)
	(strategic-number skirms >= 20)
	(strategic-number cavalry < 25)
	(strategic-number husks < 25)
	(strategic-number eagles < 25)
	(players-unit-type-count focus-player mangonel-line < 4)
	(players-unit-type-count focus-player woad-raider-line < 33)
	(up-research-status c: imperial-age >= research-pending);(or	(strategic-number sn-current-age >= imperial)
;	(strategic-number sn-military-superiority <= -1))
;	(unit-type-count-total bombard-cannon < 20)
	(up-compare-goal mangonel-set < 10)
	(unit-type-count-total scorpion-line < 12); 15
(or	(unit-type-count-total scorpion-line < 7)
	(up-research-status c: my-unique-research >= research-pending))
=>
	(set-goal trainscorpion yes))
#end-if

#load-if-defined BRITON-CIV
(defrule
	(goal milunits yes)
(or	(strategic-number skirms >= 20)
	(players-unit-type-count focus-player battering-ram-line >= 6))
	(strategic-number cavalry < 25)
	(strategic-number husks < 25)
	(strategic-number eagles < 25)
	(players-unit-type-count focus-player woad-raider-line < 25)
(or	(strategic-number sn-military-superiority <= 0)
	(strategic-number sn-current-age >= imperial))
	(up-compare-goal mangonel-set < 8)
=>
	(set-goal trainmangonel yes))
#end-if







(defrule
(or	(goal position-goal flank)
	(goal underattack yes))
	(strategic-number skirmsarchers >= 10)
	(strategic-number cavalry < 7)
	(strategic-number husks < 7)
	(strategic-number eagles < 7)
	(players-unit-type-count focus-player woad-raider-line < 7)
	(strategic-number sn-current-age <= castlea)
	(strategic-number sn-military-superiority <= 1)
	(up-compare-goal mangonel-set < 2)
=>
	(set-goal trainmangonel yes))
(defrule
(or	(goal position-goal flank)
	(goal underattack yes))
	(strategic-number skirmsarchers >= 16)
	(strategic-number cavalry < 11)
	(strategic-number husks < 11)
	(strategic-number eagles < 11)
	(players-unit-type-count focus-player woad-raider-line < 11)
	(strategic-number sn-military-superiority <= 1)
	(up-compare-goal mangonel-set < 3)
=>
	(set-goal trainmangonel yes))
(defrule
(or	(strategic-number sn-current-age >= imperial)
(or	(goal position-goal flank)
	(goal underattack yes)))
	(strategic-number skirmsarchers >= 25)
	(strategic-number cavalry < 15)
	(strategic-number husks < 15)
	(strategic-number eagles < 15)
	(players-unit-type-count focus-player woad-raider-line < 15)
	(strategic-number sn-military-superiority <= 1)
	(up-compare-goal mangonel-set < 6)
=>
	(set-goal trainmangonel yes)); end jump

(defrule; test
	(up-compare-goal milunits != no)
	(up-research-status c: imperial-age <= research-available)
	(players-unit-type-count focus-player mangonel-line >= 1)
	(unit-type-count-total infantry-class < 12)
	(unit-type-count-total cavalry-class < 6)
	(unit-type-count-total archery-class >= 9)
	(up-compare-goal mangonel-set < 2)
=>
	(set-goal trainmangonel yes))
(defrule
	(up-compare-goal milunits != no)
(or	(and	(players-unit-type-count focus-player scorpion-line >= 4)
		(up-compare-goal mangonel-set < 2))
(or	(and	(players-unit-type-count focus-player scorpion-line >= 8)
		(up-compare-goal mangonel-set < 4)); 5
	(and	(players-unit-type-count focus-player scorpion-line >= 12)
		(up-compare-goal mangonel-set < 6)))); 8
=>
	(set-goal trainmangonel yes))
(defrule
	(up-compare-goal milunits != no)
(or	(and	(players-unit-type-count focus-player scorpion-line >= 16)
		(up-compare-goal mangonel-set < 8)); 11
(or	(and	(players-unit-type-count focus-player scorpion-line >= 20)
		(up-compare-goal mangonel-set < 10)); 14
	(and	(players-unit-type-count focus-player scorpion-line >= 24)
		(up-compare-goal mangonel-set < 12)))); 17
=>
	(set-goal trainmangonel yes))
(defrule
	(up-compare-goal milunits != no)
(or	(and	(players-unit-type-count focus-player scorpion-line >= 28)
		(up-compare-goal mangonel-set < 14)); 28
(or	(and	(players-unit-type-count focus-player scorpion-line >= 32)
		(up-compare-goal mangonel-set < 16)); 32
	(and	(players-unit-type-count focus-player scorpion-line >= 36)
		(up-compare-goal mangonel-set < 18)))); 26
=>
	(set-goal trainmangonel yes))

(defrule
(or	(up-compare-goal milunits != yes)
(or	(strategic-number sn-military-superiority >= 1)
(or	(current-age <= castle-age)
(or	(and	(unit-available huskarl-line)
		(strategic-number gunpowder < 15))
	(nor	(up-compare-goal champgoal == yes)
		(and	(up-compare-goal uugoal == yes)
			(up-compare-const uu-type == infantry-uu)))))))
;(nor	(goal milunits yes)
;(or	(strategic-number sn-military-superiority >= 1)
;(or	(strategic-number sn-current-age < imperial)
;(or	(not	(civ-selected gothic))
;(or	(goal champgoal yes)
;	(and	(goal uugoal yes)
;		(up-compare-const uu-type == infantry-uu)))))))
=>
	(up-jump-rule 2))
(defrule
(or	(up-research-status c: ri-onager >= research-pending)
	(up-research-status c: ri-heavy-scorpion < research-pending))
	(up-research-status c: ri-onager >= research-available)
(or	(strategic-number archers >= 25)
	(strategic-number skirmsarchers >= 40))
	(strategic-number cavalry < 26)
	(strategic-number husks < 33)
	(strategic-number eagles < 33)
	(players-unit-type-count focus-player woad-raider-line < 33)
;	(unit-type-count-total bombard-cannon < 20)
;	(unit-type-count-total scorpion-line < 20)
	(up-compare-goal mangonel-set < 7)
=>
	(set-goal trainmangonel yes))
(defrule
	(up-research-status c: ri-onager < research-pending)
	(up-research-status c: ri-heavy-scorpion >= research-available)
(or	(up-research-status c: ri-onager < research-available)
	(up-research-status c: ri-heavy-scorpion >= research-pending))
(or	(strategic-number archers >= 25)
	(strategic-number skirmsarchers >= 40))
	(strategic-number cavalry < 26)
	(strategic-number husks < 33)
	(strategic-number eagles < 33)
	(players-unit-type-count focus-player woad-raider-line < 33)
	(players-unit-type-count focus-player mangonel-line < 5)
;	(unit-type-count-total bombard-cannon < 20)
	(up-compare-goal mangonel-set < 8)
	(unit-type-count-total scorpion-line < 10)
=>
	(set-goal trainscorpion yes)); end jump

;#load-if-not-defined KOREAN-CIV; SO civs elsewhere
;#load-if-not-defined BRITON-CIV
;#load-if-not-defined CELTIC-CIV
(defrule
(or	(and	(up-research-status c: ri-onager < research-available);	(up-research-status c: ri-heavy-scorpion < research-available)
		(up-research-status c: imperial-age >= research-complete)); -pending
(or	(and	(strategic-number sn-current-age < imperial);	(current-age <= castle-age)
		(goal position-goal pocket))
	(up-compare-goal milunits != yes)))
=>
	(up-jump-rule 3))
(defrule
	(players-unit-type-count focus-player mangonel-line < 4)
(or	(up-compare-goal enemy-goal != 0)
	(strategic-number skirmsarchers >= 12)); 10
(or	(players-building-type-count focus-player archery-range >= 2)
	(strategic-number skirmsarchers >= 7))
	(strategic-number cavalry < 8)
	(strategic-number eagles < 8)
	(strategic-number husks < 8)
	(players-unit-type-count focus-player woad-raider-line < 8)
	(strategic-number sn-military-superiority <= 0)
	(unit-type-count-total bombard-cannon < 2)
	(up-compare-goal mangonel-set < 2)
	(unit-type-count-total scorpion-line < 3)
=>
	(set-goal trainmangonel yes))
(defrule
	(players-unit-type-count focus-player mangonel-line < 12); 8
(or	(up-compare-goal mangonel-set < 4)
	(strategic-number skirmsarchers >= 36)); 30
	(strategic-number skirmsarchers >= 24); 20
	(strategic-number cavalry < 16)
	(strategic-number eagles < 16)
	(strategic-number husks < 16)
	(players-unit-type-count focus-player woad-raider-line < 16)
	(strategic-number sn-military-superiority <= 1); test
	(unit-type-count-total bombard-cannon < 6)
	(up-compare-goal mangonel-set < 6)
	(unit-type-count-total scorpion-line < 9)
=>
	(set-goal trainmangonel yes))
(defrule
	(players-unit-type-count focus-player mangonel-line < 20); 12
(or	(up-compare-goal mangonel-set < 8)
	(strategic-number skirmsarchers >= 60)); 50
	(strategic-number skirmsarchers >= 48); 40
	(strategic-number cavalry < 32)
	(strategic-number eagles < 32)
	(strategic-number husks < 32)
	(players-unit-type-count focus-player woad-raider-line < 32)
	(strategic-number sn-military-superiority <= 2); test
	(unit-type-count-total bombard-cannon < 10)
	(up-compare-goal mangonel-set < 10)
	(unit-type-count-total scorpion-line < 15)
=>
	(set-goal trainmangonel yes))
(defrule
(or	(nand	(unit-available scorpion-line)
		(not	(unit-available mangonel-line)))
(or	(and	(up-research-status c: ri-heavy-scorpion < research-pending);	(up-research-status c: ri-heavy-scorpion < research-available)
		(up-research-status c: imperial-age >= research-pending)); -complete
(or	(and	(strategic-number sn-current-age < imperial);	(current-age <= castle-age)
		(goal position-goal pocket))
	(up-compare-goal milunits != yes))))
=>
	(up-jump-rule 3))
(defrule
	(players-unit-type-count focus-player mangonel-line < 2)
(or	(up-compare-goal enemy-goal != 0)
	(strategic-number skirmsarchers >= 12)); 10
(or	(players-building-type-count focus-player archery-range >= 2)
	(strategic-number skirmsarchers >= 7))
	(strategic-number cavalry < 7)
	(strategic-number eagles < 7)
	(strategic-number husks < 8)
	(players-unit-type-count focus-player woad-raider-line < 8)
	(strategic-number sn-military-superiority <= 0)
	(unit-type-count-total bombard-cannon < 2)
	(up-compare-goal mangonel-set < 1)
	(unit-type-count-total scorpion-line < 3)
=>
	(set-goal trainscorpion yes))
(defrule
	(players-unit-type-count focus-player mangonel-line < 4)
(or	(unit-type-count-total scorpion-line < 6)
	(strategic-number skirmsarchers >= 36)); 30
	(strategic-number skirmsarchers >= 24); 20
	(strategic-number cavalry < 16)
	(strategic-number eagles < 16)
	(strategic-number husks < 16)
	(players-unit-type-count focus-player woad-raider-line < 16)
	(strategic-number sn-military-superiority <= 1); test
	(unit-type-count-total bombard-cannon < 6)
	(up-compare-goal mangonel-set < 3)
	(unit-type-count-total scorpion-line < 9)
=>
	(set-goal trainscorpion yes))
(defrule
	(players-unit-type-count focus-player mangonel-line < 6)
(or	(unit-type-count-total scorpion-line < 12)
	(strategic-number skirmsarchers >= 60)); 50
	(strategic-number skirmsarchers >= 48); 40
	(strategic-number cavalry < 32)
	(strategic-number eagles < 32)
	(strategic-number husks < 32)
	(players-unit-type-count focus-player woad-raider-line < 32)
	(strategic-number sn-military-superiority <= 2); test
	(unit-type-count-total bombard-cannon < 10)
	(up-compare-goal mangonel-set < 5)
	(unit-type-count-total scorpion-line < 15)
=>
	(set-goal trainscorpion yes))
;#end-if
;#end-if
;#end-if

#load-if-not-defined INCAN-CIV
#load-if-not-defined INDIAN-CIV
#load-if-not-defined ITALIAN-CIV
#load-if-not-defined MAGYAR-CIV
#load-if-not-defined BRITON-CIV
#load-if-not-defined BYZANTINE-CIV
#load-if-not-defined CHINESE-CIV
#load-if-not-defined FRANKISH-CIV
#load-if-not-defined GOTHIC-CIV
#load-if-not-defined HUN-CIV
#load-if-not-defined JAPANESE-CIV
#load-if-not-defined MAYAN-CIV
#load-if-not-defined PERSIAN-CIV
#load-if-not-defined SPANISH-CIV
#load-if-not-defined TURKISH-CIV ; Siege Onagers
#load-if-not-defined VIKING-CIV ; Aztecs, Celts, Koreans, Mongols, Saracens, Teutons, Slavs

#load-if-defined UP-MICHI-STYLE
(defrule
	(goal milunits yes)
;(or	(strategic-number skirmsarchers >= 15)
;	(players-unit-type-count focus-player scorpion-line >= 3))
	(strategic-number cavalry < 48)
;	(strategic-number husks < 60)
	(strategic-number eagles < 48)
	(players-unit-type-count focus-player woad-raider-line < 48)
	(strategic-number sn-military-superiority <= 3)
	(up-compare-goal mangonel-set < 12)
=>
	(set-goal trainmangonel yes))
#else
(defrule
	(goal milunits yes)
(or	(gold-amount >= 1800)
(or	(and	(gold-amount >= 650)
		(goal researchplan yes))
	(up-research-status c: ri-onager >= research-pending)))
	(strategic-number cavalry < 32)
;	(strategic-number husks < 48)
	(strategic-number eagles < 40)
	(players-unit-type-count focus-player woad-raider-line < 40)
	(strategic-number sn-military-superiority <= 0); 1
	(up-compare-goal mangonel-set < 5)
=>
	(set-goal trainmangonel yes))
(defrule
	(goal milunits yes)
(or	(strategic-number skirmsarchers >= 24)
	(players-unit-type-count focus-player scorpion-line >= 4))
	(strategic-number cavalry < 48)
;	(strategic-number husks < 60)
	(strategic-number eagles < 48)
	(players-unit-type-count focus-player woad-raider-line < 48)
(or	(strategic-number skirmsarchers >= 36); test
	(strategic-number sn-military-superiority <= 0)); 1
(or	(strategic-number skirmsarchers >= 60)
	(up-compare-goal mangonel-set < 5))
	(up-compare-goal mangonel-set < 9)
=>
	(set-goal trainmangonel yes))
#end-if

#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if

#load-if-defined UP-MICHI-STYLE
(defrule
	(goal milunits yes)
(or	(goal researchplan yes)
	(current-age-time >= 480)); 600
(or	(military-population >= 20); 25
(or	(population >= max-civ-pop)
	(strategic-number sn-military-superiority >= 0))); 1
	(unit-type-count-total bombard-cannon < 6); testing
=>
	(set-goal trainbombard yes))
#end-if

(defrule; arena test
(or	(wall-completed-percentage 2 >= 100)
	(wall-completed-percentage 1 >= 100))
	(goal islands no)
(or	(building-type-count stone-wall-line >= 4)
	(building-type-count gate >= 2))
	(goal siegereq yes)
	(strategic-number cavalry < 32)
; tl	(strategic-number husks < 48)
	(strategic-number eagles < 40)
	(players-unit-type-count focus-player woad-raider-line < 40)
	(strategic-number sn-current-age <= castlea)
	(strategic-number sn-military-superiority <= -1)
	(unit-type-count-total bombard-cannon < 1)
	(up-compare-goal mangonel-set < 1)
=>
	(set-goal trainmangonel yes))

#load-if-defined UP-GAME-WK
(defrule
(or	(goal trainscorpion yes)
(or	(up-research-status c: ri-heavy-scorpion <= research-unavailable)
	(up-research-status c: ri-siege-engineers <= research-unavailable)))
=>
	(up-jump-rule 2))
(defrule
(or	(up-compare-goal mangonel-set >= 12)
(or	(unit-type-count-total scorpion-line >= 24)
(or	(up-compare-goal milunits != yes)
(or	(strategic-number cavalry >= 7)
(or	(strategic-number eagles >= 9)
(or	(players-unit-type-count focus-player woad-raider-line >= 9)
(or	(players-unit-type-count focus-player mangonel-line >= 1)
	(players-unit-type-count focus-player bombard-cannon >= 1))))))))
=>
	(up-jump-rule 1))
(defrule
(or	(civ-selected khmer)
	(players-civ any-ally khmer))
(or	(up-research-status c: ri-furor-celtica >= research-pending)
(or	(up-research-status c: ri-drill >= research-pending)
(or	(up-research-status c: ri-torsion-engines >= research-pending)
(or	(up-research-status c: ri-double-crossbow >= research-pending)
(or	(up-research-status c: ri-ironclad >= research-pending)
	(up-research-status c: ri-rocketry >= research-pending))))))
=>
	(set-goal trainscorpion yes)); end jump
#end-if

(defrule
	(goal milunits yes)
	(up-research-status c: ri-siege-onager >= research-pending)
(or	(up-compare-goal excessGold >= 225)
	(goal siegereq yes)); test
	(strategic-number cavalry < 39)
	(strategic-number eagles < 45)
;	(strategic-number husks < 60)
	(players-unit-type-count focus-player woad-raider-line < 45)
(or	(strategic-number sn-military-superiority <= 1)
	(strategic-number skirmsarchers >= 16))
	(unit-type-count-total bombard-cannon < 16)
	(unit-type-count-total scorpion-line < 9)
	(up-compare-goal mangonel-set < 12); 18
=>
	(set-goal trainmangonel yes))
(defrule
	(goal milunits yes)
	(up-research-status c: ri-siege-onager < research-pending)
	(up-research-status c: ri-heavy-scorpion >= research-pending)
(or	(up-compare-goal excessGold >= 225)
	(goal siegereq yes)); test
	(players-unit-type-count focus-player mangonel-line < 3)
	(strategic-number skirmsarchers >= 36); 30
	(strategic-number cavalry < 18)
	(strategic-number eagles < 21)
	(players-unit-type-count focus-player woad-raider-line < 21)
	(strategic-number sn-military-superiority <= 2); test
	(unit-type-count-total bombard-cannon < 8)
	(up-compare-goal mangonel-set < 6)
	(unit-type-count-total scorpion-line < 12)
=>
	(set-goal trainscorpion yes))
;=========================================================
; Snow
;=========================================================
#load-if-not-defined INCAN-CIV
#load-if-not-defined INDIAN-CIV
#load-if-not-defined ITALIAN-CIV
#load-if-not-defined MAGYAR-CIV
#load-if-not-defined SLAVIC-CIV

#load-if-not-defined INCAN-CIV
#load-if-not-defined INDIAN-CIV
#load-if-not-defined ITALIAN-CIV
#load-if-not-defined BRITON-CIV
#load-if-not-defined CHINESE-CIV
#load-if-not-defined HUN-CIV
#load-if-not-defined MAYAN-CIV
#load-if-not-defined MONGOL-CIV
#load-if-not-defined KOREAN-CIV
#load-if-not-defined PERSIAN-CIV
(defrule
	(goal milunits yes)
(or	(food-amount >= unique-unit-food)
(or	(unit-type-count-total villager >= up-max-civ)
	(strategic-number sn-military-superiority <= -1)))
	(strategic-number moenche < 15)
	(strategic-number husks > 8)
	(unit-type-count-total my-unique-unit-line < 30)
=>
	(set-goal trainunique yes))
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if

#load-if-defined BYZANTINE-CIV
(defrule
	(goal milunits yes)
	(up-research-status c: my-unique-unit-upgrade >= research-pending)
	(strategic-number moenche < 15)
;	(players-unit-type-count focus-player spearman-line < 60)
;	(unit-type-count-total my-unique-unit-line < 80)
=>
	(set-goal trainunique yes))
#end-if

#load-if-defined FRANKISH-CIV
(defrule
	(goal milunits yes)
;(or
	(up-research-status c: my-unique-unit-upgrade >= research-pending)
;	(strategic-number cavalry >= 40))
	(strategic-number moenche < 15)
	(strategic-number cavalry >= 15); 25
	(strategic-number infantry <= 25); 15
	(strategic-number archers <= 12)
	(strategic-number gunpowder <= 12)
	(players-unit-type-count focus-player jaguar-man-line <= 12)
	(players-unit-type-count focus-player cataphract-line <= 12)
	(players-unit-type-count focus-player samurai-line <= 12)
	(unit-type-count-total my-unique-unit-line < 75); 70
=>
	(set-goal trainunique yes))
#end-if

#load-if-defined SARACEN-CIV
(defrule
	(goal milunits yes)
(or	(up-research-status c: my-unique-unit-upgrade >= research-pending)
(or	(up-research-status c: my-unique-research >= research-pending); makes them more valuable anyway
(or	(and	(strategic-number cavalry >= 25)
		(up-research-status c: my-unique-unit-upgrade >= research-available))
	(gold-amount >= 1200)))); test
	(strategic-number moenche < 15)
; test	(strategic-number cavalry >= 10)
;	(strategic-number infantry <= 25)
	(strategic-number archers <= 15)
; hmm	(strategic-number spears <= 65)
; hmm	(strategic-number skirms <= 50)
	(players-unit-type-count focus-player cataphract-line <= 15)
;	(unit-type-count-total my-unique-unit-line < 70)
=>
	(set-goal trainunique yes))
#end-if

#load-if-defined TEUTONIC-CIV
(defrule
	(goal palagoal yes)
	(strategic-number camels < 45)
	(strategic-number spears < 50)
=>
	(up-jump-rule 1))
(defrule
	(goal milunits yes)
;(or
	(up-research-status c: my-unique-unit-upgrade >= research-pending)
;	(strategic-number sn-military-superiority <= -2))
	(strategic-number moenche < 10)
	(players-unit-type-count focus-player cataphract-line < 15)
;	(players-unit-type-count focus-player war-elephant-line < 12)
	(strategic-number archers < 27)
;	(unit-type-count-total my-unique-unit-line < 80)
=>
	(set-goal trainunique yes))

#end-if

#load-if-defined PERSIAN-CIV
(defrule
	(goal milunits yes)
	(up-research-status c: my-unique-unit-upgrade >= research-pending)
	(up-research-status c: my-unique-research >= research-pending); test
	(strategic-number moenche < 7)
	(strategic-number camels < 50)
	(strategic-number spears < 60)
;	(unit-type-count-total my-unique-unit-line < 90)
=>
	(set-goal trainunique yes))
#end-if

#load-if-defined JAPANESE-CIV
(defrule
	(goal milunits yes)
	(strategic-number moenche < 15)
	(strategic-number archers < 50)
	(strategic-number gunpowder < 50)
(or	(strategic-number husks >= 8)
(or	(players-unit-type-count focus-player condottiero >= 8)
(or	(players-unit-type-count focus-player 882 >= 8)
(or	(players-unit-type-count focus-player woad-raider-line >= 8)
(or	(players-unit-type-count focus-player throwing-axeman-line >= 8)
	(players-unit-type-count focus-player berserk-line >= 8))))))
;	(unit-type-count-total my-unique-unit-line < 40)
=>
	(set-goal trainunique yes))
(defrule
	(goal milunits yes)
	(strategic-number moenche < 15)
	(strategic-number archers < 50)
	(strategic-number gunpowder < 50)
(or	(players-unit-type-count focus-player teutonic-knight-line >= 8)
	(up-research-status c: my-unique-unit-upgrade >= research-pending))
=>
	(set-goal trainunique yes))
#end-if

#load-if-not-defined AZTEC-CIV
#load-if-not-defined BRITON-CIV
#load-if-not-defined BYZANTINE-CIV
#load-if-not-defined CHINESE-CIV
#load-if-not-defined FRANKISH-CIV
#load-if-not-defined GOTHIC-CIV
#load-if-not-defined HUN-CIV
#load-if-not-defined JAPANESE-CIV
#load-if-not-defined KOREAN-CIV
#load-if-not-defined MONGOL-CIV
#load-if-not-defined MAYAN-CIV
#load-if-not-defined PERSIAN-CIV
#load-if-not-defined SARACEN-CIV
#load-if-not-defined SPANISH-CIV
#load-if-not-defined TEUTONIC-CIV
#load-if-not-defined TURKISH-CIV ; Celts, Vikings
(defrule
	(goal milunits yes)
	(up-research-status c: my-unique-unit-upgrade >= research-pending)
(or	(strategic-number moenche < 15)
	(civ-selected celtic))
(or	(strategic-number archers < 50)
(or	(up-compare-goal mangonel-set >= 6)
(or	(unit-type-count-total scorpion-line >= 12)
(or	(unit-type-count-total bombard-cannon >= 12)
	(up-compare-goal skirmisher-set >= 30)))))
;	(unit-type-count-total my-unique-unit-line < 90)
=>
	(set-goal trainunique yes))
#load-if-defined CELTIC-CIV
(defrule
	(goal trainunique yes)
(or	(players-unit-type-count focus-player jaguar-man-line >= 10)
(or	(players-unit-type-count focus-player teutonic-knight-line >= 10)
	(players-unit-type-count focus-player samurai-line >= 10)))
=>
	(set-goal trainunique no))
#end-if
#load-if-defined VIKING-CIV
(defrule
	(goal trainunique yes)
	(strategic-number moenche < 15)
(or	(players-unit-type-count focus-player jaguar-man-line >= 10)
(or	(players-unit-type-count focus-player teutonic-knight-line >= 10)
	(players-unit-type-count focus-player samurai-line >= 10)))
=>
	(set-goal trainunique no)
	(set-goal champgoal yes)
	(set-goal trainarcher yes))
#load-if-defined UP-GAME-WK
(defrule
	(goal milunits yes)
(or	(food-amount >= unique-unit-food)
(or	(unit-type-count-total villager >= up-max-civ)
	(strategic-number sn-military-superiority <= -1)))
	(strategic-number moenche < 15)
	(strategic-number archers < 25)
	(strategic-number cavalry >= 10)
	(gold-amount > 200)
	(players-unit-type-count focus-player jaguar-man-line < 20)
	(players-unit-type-count focus-player teutonic-knight-line < 20)
	(players-unit-type-count focus-player samurai-line < 20)
	(unit-type-count-total my-unique-unit-line < 30)
=>
	(set-goal trainunique yes))
#end-if
#end-if

#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if

;#load-if-not-defined AZTEC-CIV
;#load-if-not-defined BYZANTINE-CIV
;#load-if-not-defined CELTIC-CIV
;#load-if-not-defined FRANKISH-CIV
;#load-if-not-defined GOTHIC-CIV
;#load-if-not-defined HUN-CIV
;#load-if-not-defined JAPANESE-CIV
;#load-if-not-defined KOREAN-CIV
;#load-if-not-defined PERSIAN-CIV
;#load-if-not-defined SARACEN-CIV
;#load-if-not-defined SPANISH-CIV
;#load-if-not-defined TEUTONIC-CIV
;#load-if-not-defined TURKISH-CIV
;#load-if-not-defined VIKING-CIV ; Britons, Chinese, Mayan, Mongols
(defrule
;(or	(and	(goal position-goal pocket)
;		(and	(up-compare-goal targetdistance >= 60)
;			(and	(strategic-number sn-military-superiority >= -2)
;				(and	(goal defend no)
;					(goal underattack no)))))
	(and	(up-compare-const uu-type != archer-uu)
		(up-compare-const uu-type != powder-uu));)
=>
	(up-jump-rule 2))
(defrule
	(goal milunits yes)
(or	(up-research-status c: my-unique-unit-upgrade >= research-pending)
	(strategic-number infantry >= 15))
	(strategic-number siege < 20); 15
	(strategic-number skirms < 67)
	(strategic-number husks < 36)
;	(strategic-number cavalry < 50)
;	(unit-type-count-total my-unique-unit-line < 90)
=>
	(set-goal trainunique yes))
(defrule
	(goal milunits yes)
(or	(strategic-number sn-military-superiority <= -1)
	(strategic-number infantry >= 15))
	(strategic-number siege < 9); 7
	(strategic-number skirms < 36)
	(strategic-number husks < 27)
;	(strategic-number cavalry < 33)
(or	(unit-type-count-total my-unique-unit-line < 40)
	(strategic-number sn-military-superiority <= -2));
=>
	(set-goal trainunique yes)); end mini jump
;#end-if
;#end-if
;#end-if
;#end-if
;#end-if
;#end-if
;#end-if
;#end-if
;#end-if
;#end-if
;#end-if
;#end-if
;#end-if
;#end-if

#load-if-defined KOREAN-CIV
(defrule
	(goal milunits yes)
(or	(up-research-status c: my-unique-unit-upgrade >= research-pending)
(or	(strategic-number infantry >= 15)
	(strategic-number archers >= 15)))
	(strategic-number siege < 20); 15
	(strategic-number skirms < 67)
	(strategic-number husks < 36)
	(players-unit-type-count focus-player mameluke-line < 33)
;	(strategic-number cavalry < 67); 50
;	(unit-type-count-total my-unique-unit-line < 90)
=>
	(set-goal trainunique yes))
#end-if

#load-if-defined TURKISH-CIV
(defrule
	(goal milunits yes)
(or	(up-research-status c: my-unique-unit-upgrade >= research-pending)
(or	(players-unit-type-count focus-player mameluke-line >= 10); 15
	(strategic-number infantry >= 7)))
;	(strategic-number moenche < 25)
	(strategic-number siege < 20); 15
;	(strategic-number cavalry < 55); 50
	(strategic-number archers < 55); 50
;	(unit-type-count-total my-unique-unit-line < 80)
=>
	(set-goal trainunique yes))
#end-if

#load-if-not-defined AZTEC-CIV
#load-if-not-defined BRITON-CIV
#load-if-not-defined BYZANTINE-CIV
#load-if-not-defined CELTIC-CIV
#load-if-not-defined CHINESE-CIV
#load-if-not-defined FRANKISH-CIV
#load-if-not-defined GOTHIC-CIV
#load-if-not-defined HUN-CIV
#load-if-not-defined JAPANESE-CIV
#load-if-not-defined KOREAN-CIV
#load-if-not-defined MAYAN-CIV
#load-if-not-defined MONGOL-CIV
#load-if-not-defined PERSIAN-CIV
#load-if-not-defined SARACEN-CIV
#load-if-not-defined TEUTONIC-CIV
#load-if-not-defined VIKING-CIV ; Turks, Spanish
(defrule
	(goal milunits yes)
(or	(up-research-status c: my-unique-unit-upgrade >= research-pending)
	(strategic-number infantry >= 15))
;	(strategic-number moenche < 25)
(nor	(strategic-number siege >= 20); 15
;(or	(strategic-number cavalry >= 50)
	(strategic-number archers >= 50));)
;	(unit-type-count-total my-unique-unit-line < 80)
=>
	(set-goal trainunique yes))
(defrule
	(goal milunits yes)
(or	(food-amount >= unique-unit-food)
(or	(unit-type-count-total villager >= up-max-civ)
	(strategic-number sn-military-superiority <= -1)))
;	(strategic-number moenche < 25)
	(strategic-number siege < 10)
	(strategic-number cavalry < 15)
	(strategic-number archers < 25)
(or	(strategic-number infantry >= 15)
	(strategic-number sn-military-superiority <= -1))
	(unit-type-count-total my-unique-unit-line < 40)
=>
	(set-goal trainunique yes))
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if

#load-if-defined AZTEC-CIV
(defrule
	(goal milunits yes)
	(strategic-number infantry >= 24)
(or	(up-research-status c: my-unique-unit-upgrade >= research-pending)
	(and	(strategic-number cavalry < 24)
		(strategic-number archers < 12)))
	(strategic-number cavalry < 48)
	(strategic-number archers < 24)
	(strategic-number moenche < 15)
	(unit-type-count-total my-unique-unit-line < 60);
=>
	(set-goal trainunique yes))
#end-if
#load-if-defined GOTHIC-CIV
(defrule
	(true)
=>
	(up-modify-sn archers s:- gunpowder))
(defrule
	(goal milunits yes)
(or	(up-research-status c: my-unique-unit-upgrade >= research-pending)
(or	(players-civ focus-player mayan)
	(strategic-number archers >= 15)))
	(strategic-number moenche < 15)
=>
	(set-goal trainunique yes))
(defrule
	(true)
=>
	(up-modify-sn archers s:+ gunpowder))
(defrule
	(goal trainunique yes)
	(strategic-number moenche < 15)
(or	(players-unit-type-count focus-player militiaman-line >= 42)
(or	(players-unit-type-count focus-player jaguar-man-line >= 10)
(or	(players-unit-type-count focus-player teutonic-knight-line >= 10)
	(players-unit-type-count focus-player samurai-line >= 10))))
=>
	(set-goal trainunique no)
	(set-goal champgoal yes)
	(set-goal trainhandcannon yes))
#end-if

#end-if
#end-if
#end-if
#end-if
#end-if

#load-if-defined HUN-CIV; hue
(defrule
	(goal milunits yes)
	(strategic-number sn-current-age >= imperial)
	(goal escrowing no)
(or	(up-research-status c: my-unique-unit-upgrade >= research-pending)
	(players-military-population every-enemy < 10))
	(players-military-population every-enemy < 20)
	(strategic-number sn-military-superiority >= 2); 1
	(strategic-number teamsuperiority >= 2); 1
	(strategic-number moenche < 11); 15
	(strategic-number spears < 11)
	(strategic-number infantry < 22)
	(strategic-number cavalry < 22)
	(strategic-number archers < 44)
;	(unit-type-count-total my-unique-unit-line < 33)
=>
	(set-goal trainunique yes))
#end-if
;=========================================================
; Ships
;=========================================================
(defrule
(or	(up-compare-goal navycount g:>= maxnavy)
(or	(up-compare-goal fleet != yes)
(or	(up-compare-goal enemy-boats != yes)
(or	(and	(civilian-population < up-max-civ)	;(and	(civilian-population >= up-max-civ)
		(wood-amount < 175))			;(and	(strategic-number sn-current-age <= castlea)
							;(wood-amount < 175)))
	(and	(dropsite-min-distance wood >= 4); 5
		(wood-amount < 110))))))
=>
	(up-jump-rule 8))
(defrule
(or	(current-age <= castle-age)
	(up-research-status c: ri-heavy-demolition-ship >= research-pending))
	(players-unit-type-count every-enemy galley-line < 2)
	(players-unit-type-count every-enemy longboat-line < 2)
	(players-unit-type-count every-enemy caravel-line < 2)
	(players-unit-type-count every-enemy turtle-ship-line < 1)
	(players-unit-type-count any-enemy fire-ship-line >= 4)
(or	(players-unit-type-count any-enemy fire-ship-line >= 8)
	(unit-type-count-total demolition-ship-line < 3))
(or	(players-unit-type-count any-enemy fire-ship-line >= 12)
	(unit-type-count-total demolition-ship-line < 6))
	(unit-type-count-total demolition-ship-line < 9)
=>
	(set-goal traindemo yes))
(defrule
(or	(up-research-status c: ri-fast-fire-ship >= research-pending)
	(up-research-status c: ri-greek-fire >= research-pending))
	(players-unit-type-count every-enemy demolition-ship-line < 2)
	(players-unit-type-count every-enemy turtle-ship-line < 2)
(or	(players-unit-type-count focus-player galley-line >= 1)
(or	(players-unit-type-count focus-player caravel-line >= 1)
	(players-unit-type-count focus-player longboat-line >= 1)))
	(unit-type-count-total fire-ship-line < 12); 10
	(unit-type-count-total fire-ship-line g:< biggestenemynavy)
	(up-compare-goal biggestenemynavy < 20)
	(up-compare-goal navycount < 18); 15
=>
	(set-goal trainfire yes)
	(up-jump-rule 4))
(defrule
	(current-age <= castle-age)
(or	(goal position-goal flank)
	(up-compare-goal threat-source == warship-class))
	(players-unit-type-count every-enemy demolition-ship-line < 1)
	(players-unit-type-count every-enemy turtle-ship-line < 1)
	(players-unit-type-count focus-player galley-line >= 1)
(or	(unit-type-count-total galley-line < 1)
	(up-research-status c: ri-fast-fire-ship >= research-pending))
	(unit-type-count-total fire-ship-line < 12); 10
	(unit-type-count-total fire-ship-line g:< biggestenemynavy)
	(up-compare-goal biggestenemynavy < 20)
	(up-compare-goal navycount < 15)
=>
	(set-goal trainfire yes)
	(up-jump-rule 3))
(defrule
	(strategic-number sn-current-age == feudal)
	(up-compare-goal navycount < up-max-civ)
	(building-type-count-total blacksmith >= 1)
(or	(gold-amount >= 230)
	(strategic-number sn-current-age > feudal))
(or	(goal siegereq yes)
	(unit-type-count-total cannon-galleon-line >= 4))
=>
	(set-goal traingalley yes))
(defrule
(or	(goal islands yes)
	(population < max-civ-pop)); for now
	(strategic-number sn-current-age >= fcastlea)
	(gold-amount >= 130)
(or	(goal siegereq yes)
	(unit-type-count-total cannon-galleon-line >= 4))
=>
	(set-goal traingalley yes))
(defrule
(or	(goal dreitc yes)
	(wood-amount >= 295))
	(strategic-number sn-current-age >= castlea)
(or	(goal siegereq yes)
	(unit-type-count-total cannon-galleon-line >= 4))
=>
	(set-goal traingalley yes)); end mini jump
(defrule
	(up-research-status c: ri-elite-longboat >= research-pending); for now
=>
	(set-goal trainlongboat yes))
(defrule
(or	(up-research-status c: ri-elite-turtle-ship >= research-pending)
(or	(and	(population >= max-civ-pop)
		(up-compare-const wk-game == 1))
(or	(players-unit-type-count any-enemy demolition-ship-line >= 4)
	(players-unit-type-count any-enemy fire-ship-line >= 4))))
(or	(goal dreitc yes)
(or	(wood-amount >= 455)
	(unit-type-count-total turtle-ship-line < 3)))
=>
	(set-goal trainturtle yes)); end jump
(defrule
(or	(up-compare-goal navycount >= up-max-civ)
(or	(and	(dropsite-min-distance wood >= 5)
		(wood-amount < 110))
(or	(up-compare-goal fleet != yes)
	(and	(game-time < 180)
		(building-type-count dock < 5)))))
=>
	(up-jump-rule 1))
(defrule
(or	(up-compare-goal enemy-boats == yes)
	(and	(up-compare-goal navycount g:< maxnavy)
		(unit-type-count-total cannon-galleon-line < 1)))
(or	(civilian-population >= up-max-civ)
(or	(population >= max-civ-pop)
	(wood-amount >= 175)))
(or	(unit-type-count-total cannon-galleon-line < 6); 8?
	(population-cap >= 225))
	(unit-type-count-total cannon-galleon-line < minNavy)
=>
	(set-goal traincannon yes))

(defrule
(or	(and	(dropsite-min-distance wood >= 5)
		(wood-amount < 110))
(or	(and	(goal siegereq no)
		(unit-type-count-total cannon-galleon-line < 4))
(or	(up-compare-goal fishing != yes)
(or	(population >= max-civ-pop)
	(civilian-population >= up-max-civ)))))
=>
	(up-jump-rule 6)); 7
(defrule
	(building-type-count-total mill < 1)
	(wood-amount < 110)
(or	(unit-type-count-total villager >= 21); 22
(or	(unit-type-count villager-forager >= 1)
	(and	(dropsite-min-distance hunting >= 7)
		(up-compare-goal mysheep < 1))))
=>
	(up-jump-rule 5)); 6
(defrule
	(goal strategy grush)
	(game-time < 1800)
	(strategic-number sn-current-age <= dfeudal)
(or	(strategic-number sn-current-age == dark)
(or	(building-type-count-total dock >= 3)
(or	(and	(players-current-age target-player <= dark-age)
		(building-type-count-total dock >= 2))
	(and	(up-compare-goal navycount g:>= enemyfocusnavy)
		(unit-type-count-total fishing-ship < 4)))))
	(unit-type-count-total fishing-ship < 16)
=>
	(set-goal trainfish yes))
(defrule
; test	(goal fleet yes)
	(strategic-number sn-current-age <= dfeudal)
(or	(strategic-number sn-current-age <= dark)
	(wood-amount >= 480))
	(up-compare-goal biggestenemynavy <= 0)
(or	(unit-type-count-total fishing-ship < 8); 12
(or	(cc-players-unit-type-count 0 shore-fish-class >= shorefishreq)
	(cc-players-unit-type-count 0 ocean-fish-class >= deepfishreq)))
(or	(cc-players-unit-type-count 0 shore-fish-class >= shorefishreq2)
	(cc-players-unit-type-count 0 ocean-fish-class >= deepfishreq2))
	(unit-type-count-total fishing-ship < 12); 16
=>
	(set-goal trainfish yes))
;(defrule
;; test	(goal fleet yes)
;	(strategic-number sn-current-age <= dfeudal)
;(or	(cc-players-unit-type-count 0 shore-fish-class >= 3)
;	(cc-players-unit-type-count 0 ocean-fish-class >= 3))
;	(goal enemy-boats no)
;(or	(and	(up-compare-goal strategy-type >= castle-war)
;		(unit-type-count-total fishing-ship < 4)); 6
;	(unit-type-count-total fishing-ship < 3)); 4
;=>
;	(set-goal trainfish yes))
(defrule
; test	(goal fleet yes)
;	(goal researchplan no)
	(strategic-number sn-current-age <= feudal)
(or	(cc-players-unit-type-count 0 shore-fish-class >= 6); 3
	(cc-players-unit-type-count 0 ocean-fish-class >= 3))
(or	(goal enemy-boats no)
	(up-compare-goal navycount >= 5))
(or	(building-type-count-total blacksmith >= 1)
	(wood-amount >= 475))
	(unit-type-count-total fishing-ship < 4); 8
=>
	(set-goal trainfish yes))
(defrule
; test	(goal fleet yes)
	(goal researchplan no)
	(population < up-max-civ)
(or	(goal enemy-boats no)
(or	(up-compare-goal navycount g:>= biggestenemynavy)
(or	(up-compare-goal navycount g:>= maxnavy)
	(up-compare-goal navycount >= 40))))
	(food-amount < 300)
	(wood-amount >= 250); 350
	(unit-type-count-total fishing-ship < 8)
(or	(game-time < 900)
	(unit-type-count-total fishing-ship < 4))
=>
	(set-goal trainfish yes))
(defrule
; test	(goal fleet yes)
	(strategic-number sn-current-age == fcastlea)
(or	(cc-players-unit-type-count 0 shore-fish-class >= 1)
	(cc-players-unit-type-count 0 ocean-fish-class >= 1))
	(players-unit-type-count focus-player galley-line <= 0)
	(players-unit-type-count focus-player fire-ship-line <= 0)
	(players-unit-type-count focus-player longboat-line <= 0)
	(players-unit-type-count focus-player turtle-ship-line <= 0)
	(players-unit-type-count focus-player cannon-galleon-line <= 0)
	(unit-type-count-total fishing-ship <= 0)
	(wood-amount >= 250)
=>
	(set-goal trainfish yes)
	(disable-self)); end jump
;=========================================================

#load-if-defined POPULATION-CAP-EXTENDED
#load-if-not-defined POPULATION-CAP-225
#load-if-not-defined POPULATION-CAP-250
#load-if-not-defined AZTEC-CIV
#load-if-not-defined HUN-CIV
(defrule
	(goal milunits yes)
	(strategic-number sn-current-age >= imperial)
(or	(population > 225)
	(gold-amount > 4500))
	(goal researchplan yes)
	(unit-type-count-total my-unique-unit-line < 800)
=>
	(set-goal trainunique yes))
#else ; Huns
(defrule
	(goal milunits yes)
	(strategic-number sn-current-age >= imperial)
	(strategic-number moenche < 15)
(or	(population > 225)
	(gold-amount > 4500))
	(goal researchplan yes)
	(unit-type-count-total knight-line < 800)
=>
	(set-goal trainknight yes))
#end-if
#else ; Aztecs
(defrule
	(goal milunits yes)
	(strategic-number sn-current-age >= imperial)
	(strategic-number archers < 33)
	(strategic-number eagles < 25)
	(players-unit-type-count focus-player scout-cavalry-line < 22)
	(players-unit-type-count focus-player woad-raider-line < 33)
(or	(population > 225)
	(gold-amount > 4500))
	(gold-amount >= 200)
	(goal researchplan yes)
	(goal siegereq yes)
;	(unit-type-count-total monk-set < 800)
=>
	(set-goal trainmonk yes))
#end-if
#end-if
#end-if
#end-if


#load-if-not-defined INCAN-CIV
#load-if-not-defined INDIAN-CIV
#load-if-not-defined ITALIAN-CIV
#load-if-not-defined MAGYAR-CIV;
#load-if-not-defined SLAVIC-CIV

#load-if-not-defined BERBERS-CIV
#load-if-not-defined BURMESE-CIV
#load-if-not-defined ETHIOPIAN-CIV
#load-if-not-defined KHMER-CIV
#load-if-not-defined MALAY-CIV
#load-if-not-defined MALIAN-CIV
#load-if-not-defined PORTUGUESE-CIV
#load-if-not-defined VIETNAMESE-CIV

#load-if-not-defined AZTEC-CIV
#load-if-not-defined BRITON-CIV
#load-if-not-defined BYZANTINE-CIV
#load-if-not-defined CELTIC-CIV
#load-if-not-defined CHINESE-CIV
;#load-if-not-defined FRANKISH-CIV
#load-if-not-defined KOREAN-CIV
#load-if-not-defined GOTHIC-CIV
;#load-if-not-defined HUN-CIV
#load-if-not-defined JAPANESE-CIV
#load-if-not-defined MAYAN-CIV
#load-if-not-defined MONGOL-CIV
;#load-if-not-defined PERSIAN-CIV
#load-if-not-defined SARACEN-CIV
;#load-if-not-defined SPANISH-CIV
;#load-if-not-defined TEUTONIC-CIV
#load-if-not-defined TURKISH-CIV
#load-if-not-defined VIKING-CIV ; Huns, Franks, Spanish, Persians, Teutons
(defrule
	(up-compare-goal palagoal != no)
	(goal uugoal yes)
=>
	(set-goal palagoal no)
	(disable-self))
(defrule
	(up-compare-goal palagoal != no)
	(strategic-number sn-current-age < imperial)
	(goal uugoal yes)
(or	(up-compare-goal excessFood < 1300)
	(up-compare-goal excessGold < 700))
	(unit-type-count-total knight-line < 4)
=>
	(set-goal palagoal no))
(defrule
	(up-compare-goal palagoal != yes)
(or	(and	(strategic-number sn-current-age >= imperial)
		(building-type-count-total castle <= 0))
(or	(and	(goal strategy krush)
		(building-type-count-total stable >= 1))
(or	(up-research-status c: ri-cavalier >= research-pending)
(or	(up-research-status c: ri-chain-barding >= research-pending)
	(unit-type-count-total knight-line >= 6)))))
=>
	(set-goal palagoal yes))
(defrule
	(up-compare-goal palagoal != yes)
	(strategic-number sn-current-age >= imperial)
(or	(up-compare-goal excessFood >= 1000)
(or	(up-compare-goal excessGold >= 1000)
(or	(or	(civilian-population >= up-max-civ)
		(population >= max-civ-pop))
	(and	(goal champgoal no)
		(goal uugoal no)))))
=>
	(set-goal palagoal yes))
(defrule
	(up-compare-goal palagoal != yes)
	(strategic-number sn-current-age >= imperial)
	(current-age >= castle-age)
	(up-compare-goal strategy != castledrop)
	(goal uugoal no)
	(unit-type-count-total my-unique-unit-line < 4)
=>
	(set-goal palagoal yes))
;#end-if
;#end-if
;#end-if
;#end-if
;#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if

#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if

#end-if
#end-if
#end-if
#end-if
#end-if

(defrule
(or	(up-compare-goal palagoal != yes)
(or	(up-compare-goal milunits != yes)
(or	(strategic-number moenche >= 15)
(or	(strategic-number camels >= 50)
	(strategic-number spears >= 60)))))
=>
	(up-jump-rule 3))
(defrule
	(strategic-number sn-current-age >= imperial)
(or	(strategic-number sn-military-superiority <= -1)
(or	(up-research-status c: ri-paladin >= research-pending)
(or	(gold-amount >= 825)
	(and	(strategic-number sn-current-age >= imperial)
		(gold-amount >= 375)))))
=>
	(set-goal trainknight yes))
(defrule
	(strategic-number camels < 45)
	(strategic-number spears < 50)
(or	(strategic-number husks >= 7)
	(players-unit-type-count focus-player cataphract-line >= 9))
	(unit-type-count-total knight-line < 25)
=>
	(set-goal trainknight yes))
(defrule
	(strategic-number sn-military-superiority <= 0)
(or	(food-amount >= 110)
(or	(civilian-population >= up-max-civ)
(or	(population >= max-civ-pop)
	(strategic-number sn-military-superiority <= -1))))
(or	(goal attacking yes)
(or	(gold-amount > 100)
	(unit-type-count-total monk >= 1)))
	(unit-type-count-total knight-line < 25)
=>
	(set-goal trainknight yes)); end jump



(defrule
	(goal milunits yes)
	(up-research-status c: ri-paladin >= research-pending)
	(strategic-number moenche < 15)
	(strategic-number camels < 45)
	(strategic-number spears < 50)
(or	(gold-amount > 300)
(or	(up-research-status c: ri-blast-furnace >= research-pending)
	(up-research-status c: ri-plate-barding >= research-pending)))
(nand	(civ-selected byzantine)
	(up-research-status c: my-unique-unit-upgrade >= research-pending))
=>
	(set-goal trainknight yes))
;=========================================================
; Monks
;=========================================================
(defrule
	(unit-type-count-total monk-set < 1);	(unit-type-count-total monastery-class < 1)
=>
	(set-goal trainmonk yes))
(defrule
	(game-time < 1800); 2100
(or	(not	(player-in-game any-ally))
	(up-compare-goal strategy-type >= imperial-war))
	(unit-type-count-total monk-set < 4)
(or	(unit-type-count-total monk-set < 3)
	(up-gaia-type-count-total c: relic >= 4));(cc-players-unit-type-count 0 relic >= 4)); 3
(or	(unit-type-count-total monk-set < 2)
	(up-gaia-type-count-total c: relic >= 3));(cc-players-unit-type-count 0 relic >= 3)); 2
	(up-gaia-type-count-total c: relic >= 2);(cc-players-unit-type-count 0 relic >= 2); 1
	(up-compare-goal stopmonks != yes)
	(unit-type-count 134 < 2)
=>
	(set-goal trainmonk yes))
(defrule
	(cc-players-unit-type-count 0 tree-class < 200)
(or	(cc-players-unit-type-count 0 tree-class < 50)
	(dropsite-min-distance wood > 25))
	(strategic-number archers < 25)
	(players-unit-type-count focus-player eagle-warrior-line < 20)
	(players-unit-type-count focus-player scout-cavalry-line < 16)
	(up-compare-goal excessGold >= 250); 225 ; for now
(or	(up-compare-goal excessGold > 800)
(or	(up-compare-goal tradeunits >= 1)
	(up-compare-goal relic-count >= 1)))
;	(unit-type-count-total monastery-class < 20)
	(goal siegereq yes)
=>
	(set-goal trainmonk yes))
;=========================================================
(defrule
(or	(unit-type-count-total monastery-class >= 20)
(or	(military-population >= 11)
(or	(strategic-number archers >= 9)
(or	(players-unit-type-count focus-player eagle-warrior-line >= 7)
(or	(players-unit-type-count focus-player scout-cavalry-line >= 5)
(or	(population >= max-civ-pop)
	(and	(up-compare-goal milunits != no)
		(up-compare-goal milunits != yes))))))))
=>
	(up-jump-rule 2))
(defrule
;	(wood-amount < 300)
	(up-compare-goal excessFood < 110)
	(up-compare-goal excessGold >= 250);
(or	(up-compare-goal excessGold >= 400); 900?
(or	(up-compare-goal tradeunits >= 20)
	(up-compare-goal relic-count >= 3)))
	(strategic-number sn-military-superiority <= -1); 0?
	(unit-type-count-total monastery-class < 6); 20
=>
	(set-goal trainmonk yes))
(defrule
	(up-compare-goal excessWood < 200)
	(up-compare-goal excessFood < 200)
	(up-compare-goal excessGold >= 800)
	(strategic-number sn-current-age >= imperial)
(or	(up-compare-goal excessGold >= 1600)
(or	(up-compare-goal tradeunits >= 20)
	(up-compare-goal relic-count >= 3)))
	(strategic-number sn-military-superiority <= -1); 0?
	(unit-type-count-total monastery-class < 11); 20
=>
	(set-goal trainmonk yes))
;=========================================================
(defrule
;(or	(up-compare-goal milunits != no)
(or	(military-population >= 13); 15
(or	(and	(strategic-number target-military-superiority >= 0)
		(strategic-number ep-military-superiority >= -1))
(or	(unit-type-count-total monastery-class >= 10); 15
(or	(strategic-number sn-current-age > castlea)
(or	(and	(up-research-status c: imperial-age == research-available)
		(gold-amount < imperial-gs))
	(up-compare-goal escrowing == imperial-age))))));)
=>
	(up-jump-rule 1))
(defrule
(or	(goal position-goal pocket)
	(and	(strategic-number archers < 9)
		(and	(players-unit-type-count focus-player eagle-warrior-line < 7)
			(players-unit-type-count focus-player scout-cavalry-line < 5))))
	(population < up-max-civ); max-civ-pop
(or	(goal milunits no)
(or	(up-compare-goal excessGold >= 200); 900; 600; 300
(or	(up-enemy-units-in-town >= 5)
	(up-compare-goal relic-count >= 3))))
=>
	(set-goal trainmonk yes))
;=========================================================
(defrule
	(goal milunits yes)
	(strategic-number sn-military-superiority < 1); 2
	(strategic-number archers < 24)
	(players-unit-type-count focus-player eagle-warrior-line < 20)
	(players-unit-type-count focus-player scout-cavalry-line < 16)
(or	(players-unit-type-count focus-player war-elephant-line >= 6)
(or	(players-unit-type-count focus-player boyar >= 18)
(or	(players-unit-type-count focus-player elephant-archer >= 12)
	(players-unit-type-count focus-player teutonic-knight-line >= 6))))
	(unit-type-count-total monastery-class < 14); 18
	(up-compare-goal excessGold >= 225); 200
=>
	(set-goal trainmonk yes))
(defrule
	(goal milunits yes)
	(strategic-number sn-military-superiority < 1); 2
	(strategic-number archers < 24)
	(players-unit-type-count focus-player eagle-warrior-line < 20)
	(players-unit-type-count focus-player scout-cavalry-line < 16)
(or	(players-unit-type-count focus-player battle-elephant >= 12)
(or	(players-unit-type-count focus-player elite-battle-elephant >= 12)
(or	(players-unit-type-count focus-player knight-line >= 24)
	(strategic-number camels >= 30))))
	(unit-type-count-total monastery-class < 11); 15
	(up-compare-goal excessGold >= 225); 200
=>
	(set-goal trainmonk yes))
(defrule
	(goal milunits yes)
	(strategic-number sn-military-superiority < 3); 2
	(strategic-number archers < 26)
	(players-unit-type-count focus-player eagle-warrior-line < 22)
	(players-unit-type-count focus-player scout-cavalry-line < 18)
	(unit-type-count-total hand-cannoneer < 16)
	(unit-type-count archery-cannon-class < 16)
	(unit-type-count-total samurai-line < 16)
	(unit-type-count-total jaguar-man-line < 16)
(or	(strategic-number husks >= 6)
	(players-unit-type-count focus-player b-husk-line >= 6))
	(unit-type-count-total monastery-class < 14); 18
	(up-compare-goal excessGold >= 225); 200
=>
	(set-goal trainmonk yes))
(defrule
	(goal milunits yes)
	(goal enemy-goal rush)
	(strategic-number sn-military-superiority < 3)
	(strategic-number archers < 10)
	(players-unit-type-count focus-player eagle-warrior-line < 7)
	(players-unit-type-count focus-player scout-cavalry-line < 5)
(or	(players-building-type-count focus-player stable >= 1)
	(players-unit-type-count focus-player knight-line >= 3))
	(players-building-type-count focus-player archery-range <= 0)
	(unit-type-count-total monastery-class < 6); 15
(or	(strategic-number sn-military-superiority <= 0); -1
	(up-compare-goal excessGold >= 200))
=>
	(set-goal trainmonk yes))
;=========================================================
#load-if-defined AZTEC-CIV
(defrule
	(goal milunits yes)
	(up-compare-goal strategy != stonewall); test
	(strategic-number archers < 20)
	(players-unit-type-count focus-player eagle-warrior-line < 17)
	(players-unit-type-count focus-player scout-cavalry-line < 14)
(or	(up-compare-goal relic-count >= 3)
(or	(strategic-number sn-military-superiority <= -2)
(or	(gold-amount >= 1200)
	(and	(up-research-status c: ri-fervor >= research-pending)
		(up-research-status c: ri-herbal-medicine >= research-pending)))))
;	(unit-type-count-total monastery-class < 70)
	(up-compare-goal excessGold >= 300); 200
=>
	(set-goal trainmonk yes))
#end-if
;=========================================================
; Knights
;=========================================================
;(defrule
;	(goal milunits yes)
;	(strategic-number moenche < 10)
;(or	(strategic-number siege >= 3)
;(or	(players-unit-type-count focus-player battering-ram-line >= 3)
;(or	(players-unit-type-count focus-player archer-line >= 7)
;	(strategic-number skirms >= 7))))
;	(food-amount >= 160)
;	(gold-amount >= 210)
;	(unit-type-count-total knight-line <= 17)
;=>
;	(set-goal trainknight yes))
;=========================================================
(defrule
	(goal milunits yes)
	(strategic-number moenche < 10)
	(strategic-number spears < 10)
	(strategic-number sn-current-age <= castlea)
(or	(up-compare-goal mangonel-set <= 1)
(or	(players-unit-type-count focus-player mangonel-line >= 3)
	(players-unit-type-count focus-player bombard-cannon >= 1)))
	(strategic-number siege >= 3)
	(strategic-number sn-military-superiority <= -1)
(or	(food-amount >= 110)
	(civilian-population >= up-max-civ))
	(unit-type-count-total knight-line < 12)
=>
	(set-goal trainknight yes))
;=========================================================
(defrule
	(goal milunits yes)
	(goal attacking no)
	(strategic-number moenche < 10)
	(enemy-buildings-in-town)
	(players-building-type-count focus-player watch-tower-line > 0)
	(strategic-number spears < 10)
	(unit-type-count-total camel-line < 10)
	(unit-type-count-total scout-cavalry-line < 8)
	(unit-type-count-total knight-line < 6)
	(unit-type-count-total siege-weapon-class <= 0)
	(unit-type-count-total trebuchet-set <= 0)
;	(building-type-count castle == 0)
=>
	(set-goal trainknight yes))
;=========================================================
(defrule
	(goal milunits yes)
	(strategic-number moenche < 10)
	(strategic-number sn-current-age <= castlea)
	(strategic-number spears < 30)
	(strategic-number camels < 25)
(or	(players-unit-type-count focus-player scorpion-line >= 4)
	(players-unit-type-count focus-player mangonel-line >= 2))
	(unit-type-count-total knight-line < 8)
=>
	(set-goal trainknight yes))
;=========================================================
(defrule
	(goal milunits yes)
	(strategic-number moenche < 10)
	(strategic-number sn-current-age <= castlea)
	(strategic-number spears < 40)
	(strategic-number camels < 35)
(or	(players-unit-type-count focus-player scorpion-line >= 8)
	(players-unit-type-count focus-player mangonel-line >= 4))
	(unit-type-count-total knight-line < 14)
=>
	(set-goal trainknight yes))
;=========================================================
(defrule
	(goal milunits yes)
	(strategic-number moenche < 10)
	(strategic-number spears < 30)
	(strategic-number camels < 25)
	(goal enemy-goal rush)
	(building-type-count castle == 0)
	(strategic-number sn-military-superiority <= -1)
(or	(food-amount >= 110)
(or	(strategic-number sn-military-superiority <= -2)
	(goal defend yes)))
	(unit-type-count-total knight-line < 15)
=>
	(set-goal trainknight yes))
;=========================================================
;(defrule
;	(goal milunits yes)
;(nor	(strategic-number moenche >= 10)
;(or	(strategic-number spears >= 30)
;	(strategic-number camels >= 25)))
;(or	(research-available ri-cavalier)
;(or	(research-available ri-paladin)
;	(up-research-status c: ri-paladin >= research-pending)))
;	(players-unit-type-count focus-player cataphract-line > 11)
;	(unit-type-count-total knight-line <= 30)
;=>
;	(set-goal trainknight yes))
;=========================================================
(defrule
(or	(population >= max-civ-pop)
(or	(and	(up-research-status c: imperial-age >= research-pending)
		(and	(building-type-count castle >= 1)
			(goal uugoal yes)))
(or	(strategic-number teamsuperiority >= 2);(and	(up-research-status c: ri-forging < research-pending)
							;(up-research-status c: ri-scale-barding < research-pending))
	(and	(strategic-number sn-military-superiority >= 0)
		(military-population >= 30)))))
=>
	(up-jump-rule 2)); 3
(defrule
(or	(strategic-number sn-military-superiority >= 0); 1
(or	(current-age >= imperial-age)	;(and	(civ-selected saracen)
		;	(strategic-number sn-current-age >= imperial))
(or	(building-type-count stable < 1)
(or	(up-compare-goal milunits != yes)
(or	(strategic-number spears >= 25)
(or	(strategic-number camels >= 20)
	(strategic-number moenche >= 10)))))))
=>
	(up-jump-rule 1)); 2
(defrule
(or	(strategic-number sn-military-superiority <= -2)
(or	(food-amount >= 110)
(or	(civilian-population >= up-max-civ)
	(goal underattack yes))))
;(up-research-status c: imperial-age < research-pending);(nand	(building-type-count castle >= 1)
;	(strategic-number sn-current-age >= imperial))
(or	(strategic-number sn-military-superiority <= -1)
	(goal defend yes))
	(unit-type-count-total knight-line < 20); 16
=>
	(set-goal trainknight yes))
;(defrule
;(or	(players-unit-type-count focus-player militiaman-line > 5)
;(or	(players-unit-type-count focus-player archer-line > 7)
;(or	(players-unit-type-count focus-player eagle-warrior-line > 5)
;	(strategic-number skirms > 10))))
;	(building-type-count castle == 0)
;;tl	(food-amount >= 110)
;	(strategic-number sn-military-superiority <= -1)
;	(unit-type-count-total knight-line < 18)
;=>
;	(set-goal trainknight yes))
;=========================================================
(defrule
	(goal milunits yes)
	(gold-amount >= 100)
	(strategic-number moenche < 10)
	(strategic-number spears < 20)
	(strategic-number camels < 15)
	(goal enemy-goal flush)
	(building-type-count castle == 0)
	(food-amount >= 110)
	(strategic-number sn-military-superiority <= -1)
	(unit-type-count-total knight-line < 11)
=>
	(set-goal trainknight yes))
;=========================================================
(defrule
	(goal milunits yes)
	(strategic-number moenche < 10)
	(building-type-count castle == 0)
(or	(goal enemy-goal rush)
	(players-unit-type-count focus-player eagle-warrior-line > 10))
	(players-unit-type-count focus-player eagle-warrior-line > 4)
	(strategic-number spears < 25)
	(strategic-number sn-military-superiority <= -2)
	(unit-type-count-total knight-line < 12)
=>
	(set-goal trainknight yes))
;=========================================================
;(defrule
;	(goal milunits yes)
;	(strategic-number moenche < 10)
;	(strategic-number spears < 30)
;	(strategic-number camels < 25)
;	(research-completed ri-cavalier)
;	(players-unit-type-count focus-player knight-line > 34)
;	(unit-type-count-total knight-line < 18)
;=>
;	(set-goal trainknight yes))
;=========================================================
(defrule
	(goal milunits yes);
	(strategic-number sn-military-superiority <= 3)
	(strategic-number moenche < 10)
	(strategic-number spears < 45)
	(strategic-number camels < 35)
(or	(strategic-number sn-military-superiority <= -3)
;(or
	(goal underattack yes)
;	(goal attacking yes))
)
	(building-type-count castle == 0)
	(unit-type-count-total knight-line < 12)
=>
	(set-goal trainknight yes))
;=========================================================
; Pikes
;=========================================================
(defrule
;	(goal nomad yes)
	(up-compare-goal islands != yes)
(not	(players-building-count every-enemy >= 1)); want to scout everyone
	(military-population < 1)
	(unit-type-count-total spearman-line < 1)
=>
	(set-goal trainpike yes)
;	(disable-self) ; can-train may not be true ; it should be fine like it is as of now anyway ; + wolves
)
;=========================================================
(defrule
(nor	(civ-selected celtic)
	(civ-selected korean))
=>
	(up-jump-rule 1))
(defrule
	(goal milunits yes)
	(goal allowspears yes)
	(population < siege-pop)
	(food-amount >= pk-buffer-f)
	(strategic-number infantry < 36); 28
	(strategic-number archers < 33); 25
	(unit-type-count-total my-unique-unit-line < 7)
	(unit-type-count-total knight-line < 7)
(or	(unit-type-count-total scorpion-line >= 10); 11
	(up-compare-goal mangonel-set >= 8)); 9
;(or	(up-research-status c: ri-heavy-scorpion >= research-pending)
;	(up-research-status c: ri-siege-onager >= research-pending))
	(unit-type-count-total spearman-line < 16); 18
=>
	(set-goal trainpike yes))
;=========================================================
(defrule
	(enemy-buildings-in-town) ;
	(goal milunits yes)
	(goal allowspears yes)
	(goal attacking no)
	(strategic-number moenche < 15)
	(unit-type-count-total knight-line < 1)
	(unit-type-count-total eagle-warrior-line < 2)	
;	(building-type-count castle == 0)
	(unit-type-count battering-ram <= 0)
	(players-building-type-count focus-player watch-tower-line > 0)
	(unit-type-count-total spearman-line < 5)
=>
	(set-goal trainpike yes))
;=========================================================
(defrule
;	(goal milunits yes)
	(goal allowspears yes); hmm
	(current-age < castle-age)
	(goal attacking no)
(or	(up-building-type-in-town c: watch-tower >= 1)
	(and	(up-unit-type-in-town c: knight-line >= 2)
		(unit-type-count-total spearman-line < 3)))
	(unit-type-count-total spearman-line < 8)
=>
	(set-goal trainpike yes))
;=========================================================
(defrule
	(goal milunits yes)
	(goal allowspears yes)
	(strategic-number moenche < 15)
	(strategic-number sn-military-superiority <= -1)
(or	(strategic-number sn-current-age == fcastlea)
	(strategic-number sn-current-age == castlea))
	(food-amount >= pk-buffer-f)
	(wood-amount >= farm-cost)
	(players-building-type-count focus-player stable >= 1)
	(strategic-number archers < 5)
	(unit-type-count-total spearman-line < 6)
=>
	(set-goal trainpike yes))
;=========================================================
(defrule
	(goal milunits yes)
	(goal allowspears yes)
	(strategic-number moenche < 15)
	(strategic-number sn-military-superiority <= 0)
(or	(strategic-number sn-current-age == fcastlea)
	(strategic-number sn-current-age == castlea))
	(up-compare-goal enemy-goal == flush)
	(players-building-type-count focus-player archery-range < 1)
	(strategic-number archers < 3)
	(food-amount >= pk-buffer-f)
	(unit-type-count-total spearman-line < 3)
=>
	(set-goal trainpike yes))
;=========================================================
(defrule
	(goal milunits yes)
	(goal allowspears yes)
	(strategic-number moenche < 15)
	(strategic-number sn-military-superiority <= -1)
(or	(strategic-number sn-current-age == fcastlea)
	(strategic-number sn-current-age == castlea))
	(players-building-type-count focus-player stable >= 2)
	(strategic-number archers < 3)
	(food-amount >= pk-buffer-f)
	(unit-type-count-total spearman-line < 10)
=>
	(set-goal trainpike yes))
;=========================================================
(defrule
	(goal milunits yes)
	(goal allowspears yes)
	(goal enemy-goal rush)
	(strategic-number moenche < 3)
	(strategic-number infantry < 5)
;	(strategic-number cavalry < 5)
	(strategic-number archers < 3)
;	(strategic-number gunpowder < 3)
	(strategic-number siege < 3)
	(players-unit-type-count focus-player b-husk-line < 3)
;	(food-amount >= pk-buffer-f)
	(players-building-type-count focus-player siege-workshop <= 1)
	(players-building-type-count focus-player barracks <= 1)
	(players-building-type-count focus-player archery-range <= 0)
	(players-building-type-count focus-player castle <= 0)
	(strategic-number sn-military-superiority <= 0)
	(unit-type-count-total spearman-line < 8)
=>
	(set-goal trainpike yes))
;=========================================================

#load-if-not-defined TURKISH-CIV
#load-if-not-defined GOTHIC-CIV
#load-if-not-defined BYZANTINE-CIV
(defrule
	(goal milunits yes)
	(goal allowspears yes)
	(strategic-number moenche < 15)
	(strategic-number cavalry >= 3)
(or	(food-amount >= pk-buffer-f)
(or	(goal underattack yes)
	(strategic-number sn-military-superiority <= -2)))
(or	(unit-type-count-total spearman-line < 4); 5
	(and	(players-current-age focus-player >= castle-age)
		(unit-type-count-total spearman-line < 6))); 7
=>
	(set-goal trainpike yes))
;=========================================================
(defrule
	(goal milunits yes)
	(goal allowspears yes)
	(strategic-number moenche < 15)
	(strategic-number cavalry >= 5)
	(food-amount >= pk-buffer-f)
	(unit-type-count-total spearman-line < 8); 10
=>
	(set-goal trainpike yes))
;=========================================================
(defrule
	(goal milunits yes)
	(goal allowspears yes)
	(strategic-number cavalry >= 7)
	(food-amount >= pk-buffer-f)
	(unit-type-count-total spearman-line < 12); 14
=>
	(set-goal trainpike yes))
;=========================================================
(defrule
	(goal milunits yes)
	(goal allowspears yes)
	(strategic-number cavalry >= 10)
	(food-amount >= pk-buffer-f)
	(unit-type-count-total spearman-line < 16); 18
=>
	(set-goal trainpike yes))
;=========================================================
(defrule
	(goal milunits yes)
	(goal allowspears yes)
	(strategic-number cavalry >= 15)
	(food-amount >= pk-buffer-f)
	(unit-type-count-total spearman-line < 24); 25
=>
	(set-goal trainpike yes))
;=========================================================
(defrule
	(goal milunits yes)
	(goal allowspears yes)
	(strategic-number cavalry >= 25)
	(food-amount >= pk-buffer-f)
	(unit-type-count-total spearman-line < 40)
=>
	(set-goal trainpike yes))
;=========================================================
(defrule
	(goal milunits yes)
	(goal allowspears yes)
	(strategic-number cavalry >= 40)
	(food-amount >= pk-buffer-f)
	(unit-type-count-total spearman-line < 60)
=>
	(set-goal trainpike yes))

#end-if
#end-if

#load-if-not-defined AZTEC-CIV
#load-if-not-defined BRITON-CIV
#load-if-not-defined MONGOL-CIV
#load-if-not-defined CELTIC-CIV
#load-if-not-defined CHINESE-CIV
#load-if-not-defined FRANKISH-CIV
#load-if-not-defined KOREAN-CIV
#load-if-not-defined HUN-CIV
#load-if-not-defined JAPANESE-CIV
#load-if-not-defined MAYAN-CIV
#load-if-not-defined PERSIAN-CIV
#load-if-not-defined SARACEN-CIV
#load-if-not-defined SPANISH-CIV
#load-if-not-defined TEUTONIC-CIV
#load-if-not-defined VIKING-CIV ; Goths, Byz

(defrule
	(goal milunits yes)
	(goal allowspears yes)
	(strategic-number moenche < 15)
	(strategic-number cavalry >= 3)
	(food-amount >= pk-buffer-f)
(or	(unit-type-count-total spearman-line < 5); 6
	(and	(players-current-age focus-player >= castle-age)
		(unit-type-count-total spearman-line < 7))); 8
=>
	(set-goal trainpike yes))
;=========================================================
(defrule
	(goal milunits yes)
	(goal allowspears yes)
	(strategic-number moenche < 15)
	(strategic-number cavalry >= 5)
	(food-amount >= pk-buffer-f)
	(unit-type-count-total spearman-line < 9); 12
=>
	(set-goal trainpike yes))
;=========================================================
(defrule
	(goal milunits yes)
	(goal allowspears yes)
	(strategic-number cavalry >= 7)
	(food-amount >= pk-buffer-f)
	(unit-type-count-total spearman-line < 13); 16
=>
	(set-goal trainpike yes))
;=========================================================
(defrule
	(goal milunits yes)
	(goal allowspears yes)
	(strategic-number cavalry >= 10)
	(food-amount >= pk-buffer-f)
	(unit-type-count-total spearman-line < 18); 20
=>
	(set-goal trainpike yes))
;=========================================================
(defrule
	(goal milunits yes)
	(goal allowspears yes)
	(strategic-number cavalry >= 15)
	(food-amount >= pk-buffer-f)
	(unit-type-count-total spearman-line < 28); 30
=>
	(set-goal trainpike yes))
;=========================================================
(defrule
	(goal milunits yes)
	(goal allowspears yes)
	(strategic-number cavalry >= 25)
	(food-amount >= pk-buffer-f)
	(unit-type-count-total spearman-line < 46)
=>
	(set-goal trainpike yes))
;=========================================================
(defrule
	(goal milunits yes)
	(goal allowspears yes)
	(strategic-number cavalry >= 40)
	(food-amount >= pk-buffer-f)
	(unit-type-count-total spearman-line < 65)
=>
	(set-goal trainpike yes))
#load-if-defined POPULATION-CAP-EXTENDED
#load-if-not-defined POPULATION-CAP-225
#load-if-not-defined POPULATION-CAP-250
#load-if-not-defined POPULATION-CAP-275
#load-if-not-defined POPULATION-CAP-300
#load-if-not-defined POPULATION-CAP-325
#load-if-not-defined POPULATION-CAP-350
#load-if-not-defined POPULATION-CAP-375
#load-if-not-defined POPULATION-CAP-400
#load-if-not-defined POPULATION-CAP-425
(defrule
	(goal milunits yes)
	(goal allowspears yes)
	(strategic-number cavalry >= 40)
	(food-amount >= pk-buffer-f)
	(unit-type-count-total spearman-line < 100)
=>
	(set-goal trainpike yes))
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if

#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if

#else ; Turks

(defrule
	(goal milunits yes)
	(goal allowspears yes)
	(strategic-number moenche < 15)
	(strategic-number cavalry >= 3)
(or	(building-type-count stable < 1)
	(and	(goal enemy-goal rush)
		(gold-amount < 60)))
	(food-amount >= pk-buffer-f)
(or	(unit-type-count-total spearman-line < 3)
	(players-current-age focus-player >= castle-age))
	(unit-type-count-total spearman-line < 5); 6
=>
	(set-goal trainpike yes))
;=========================================================
(defrule
	(goal milunits yes)
	(goal allowspears yes)
	(strategic-number moenche < 15)
	(strategic-number cavalry >= 5)
(or	(building-type-count stable < 1)
	(and	(goal enemy-goal rush)
		(gold-amount < 60)))
	(food-amount >= pk-buffer-f)
	(unit-type-count-total spearman-line < 7); 9
=>
	(set-goal trainpike yes))
;=========================================================
(defrule
	(goal milunits yes)
	(goal allowspears yes)
	(strategic-number cavalry >= 7)
	(building-type-count stable < 1)
	(food-amount >= pk-buffer-f)
	(unit-type-count-total spearman-line < 9); 12
=>
	(set-goal trainpike yes))
;=========================================================
(defrule
	(goal milunits yes)
	(goal allowspears yes)
	(strategic-number cavalry >= 10)
	(building-type-count stable < 1)
	(food-amount >= pk-buffer-f)
	(unit-type-count-total spearman-line < 13); 15
=>
	(set-goal trainpike yes))
;=========================================================
(defrule
	(goal milunits yes)
	(goal allowspears yes)
	(strategic-number cavalry >= 15)
	(building-type-count stable < 1)
	(food-amount >= pk-buffer-f)
	(unit-type-count-total spearman-line < 19); 21
=>
	(set-goal trainpike yes))
;=========================================================
(defrule
	(goal milunits yes)
	(goal allowspears yes)
	(strategic-number cavalry >= 25)
	(building-type-count stable < 1)
	(food-amount >= pk-buffer-f)
	(unit-type-count-total spearman-line < 29); 31
=>
	(set-goal trainpike yes))
;=========================================================
(defrule
	(goal milunits yes)
	(goal allowspears yes)
	(strategic-number cavalry >= 40)
	(building-type-count stable < 1)
	(food-amount >= pk-buffer-f)
	(unit-type-count-total spearman-line < 44); 47
=>
	(set-goal trainpike yes))
;=========================================================
(defrule
	(goal milunits yes)
	(strategic-number moenche < 15)
(or	(strategic-number cavalry >= 3)
	(players-unit-type-count focus-player conquistador-line >= 3))
	(food-amount >= cm-buffer-f)
	(unit-type-count-total camel-line < 4); 5
=>
	(set-goal traincamel yes))
;=========================================================
(defrule
	(goal milunits yes)
	(strategic-number moenche < 15)
(or	(strategic-number cavalry >= 5)
	(players-unit-type-count focus-player conquistador-line >= 5))
	(food-amount >= cm-buffer-f)
	(unit-type-count-total camel-line < 7); 8
=>
	(set-goal traincamel yes))
;=========================================================
(defrule
	(goal milunits yes)
	(strategic-number moenche < 15)
(or	(strategic-number cavalry >= 7)
	(players-unit-type-count focus-player conquistador-line >= 7))
	(food-amount >= cm-buffer-f)
	(unit-type-count-total camel-line < 10); 12
=>
	(set-goal traincamel yes))
;=========================================================
(defrule
	(goal milunits yes)
(or	(strategic-number cavalry >= 10)
	(players-unit-type-count focus-player conquistador-line >= 10))
	(food-amount >= cm-buffer-f)
	(unit-type-count-total camel-line < 15); 18
=>
	(set-goal traincamel yes))
;=========================================================
(defrule
	(goal milunits yes)
(or	(strategic-number cavalry >= 15)
	(players-unit-type-count focus-player conquistador-line >= 15))
	(food-amount >= cm-buffer-f)
	(unit-type-count-total camel-line < 23); 27
=>
	(set-goal traincamel yes))
;=========================================================
(defrule
	(goal milunits yes)
(or	(strategic-number cavalry >= 25)
	(players-unit-type-count focus-player conquistador-line >= 25))
	(food-amount >= cm-buffer-f)
	(unit-type-count-total camel-line < 40); 42
=>
	(set-goal traincamel yes))
;=========================================================
(defrule
	(goal milunits yes)
(or	(strategic-number cavalry >= 40)
	(players-unit-type-count focus-player conquistador-line >= 40))
	(food-amount >= cm-buffer-f)
	(unit-type-count-total camel-line < 58); 60
=>
	(set-goal traincamel yes))

#end-if

(defrule
	(goal milunits yes)
	(goal allowspears yes)
	(goal enemy-goal flush)
	(food-amount >= pk-buffer-f)
(or	(goal underattack yes)
	(strategic-number sn-military-superiority <= 0))
	(players-current-age focus-player == feudal-age)
(or	(players-building-type-count focus-player archery-range <= 0)
	(players-building-type-count focus-player stable >= 1))
	(players-unit-type-count focus-player archer-line < 1)
	(players-unit-type-count focus-player militiaman-line < 1)
	(unit-type-count-total spearman-line < 4)
=>
	(set-goal trainpike yes))
;=========================================================
;(defrule
;	(goal milunits yes)
;	(goal allowspears yes)
;	(goal enemy-goal flush)
;	(food-amount >= pk-buffer-f)
;(or	(goal underattack yes)
;	(strategic-number sn-military-superiority <= 0))
;	(players-unit-type-count focus-player scout-cavalry-line > 1)
;	(players-current-age focus-player == feudal-age)
;	(unit-type-count-total spearman-line < 4)
;=>
;	(set-goal trainpike yes))
;=========================================================
(defrule
	(goal milunits yes)
	(goal allowspears yes)
	(goal enemy-goal flush)
	(food-amount >= pk-buffer-f)
(or	(players-building-type-count focus-player stable >= 1)
	(players-unit-type-count focus-player scout-cavalry-line >= 2))
(or	(goal underattack yes)
	(strategic-number sn-military-superiority <= 0))
	(players-current-age focus-player == feudal-age)
	(unit-type-count-total spearman-line < 4)
=>
	(set-goal trainpike yes))
;=========================================================
(defrule
	(goal milunits yes)
	(goal allowspears yes)
	(food-amount >= pk-buffer-f)
(or	(players-building-type-count focus-player stable >= 2)
	(strategic-number cavalry >= 3))
	(goal enemy-goal rush)
(or	(goal underattack yes)
	(strategic-number sn-military-superiority <= 0))
	(strategic-number sn-military-superiority <= 1)
	(unit-type-count-total spearman-line < 8); 9
=>
	(set-goal trainpike yes))
;=========================================================
#load-if-not-defined TURKISH-CIV
(defrule
	(goal milunits yes)
	(goal allowspears yes)
	(food-amount >= pk-buffer-f)
	(strategic-number moenche < 15)
	(strategic-number sn-military-superiority <= -1)
	(commodity-selling-price wood < 50)
	(commodity-selling-price food < 50)
	(unit-type-count-total spearman-line < 12)
	(strategic-number cavalry >= 5)
=>
	(set-goal trainpike yes))
#end-if

#load-if-not-defined INCAN-CIV
#load-if-not-defined INDIAN-CIV
#load-if-not-defined ITALIAN-CIV
#load-if-not-defined MAGYAR-CIV
#load-if-not-defined SLAVIC-CIV
#load-if-not-defined AZTEC-CIV
#load-if-not-defined BRITON-CIV
#load-if-not-defined TURKISH-CIV
#load-if-not-defined CELTIC-CIV
#load-if-not-defined CHINESE-CIV
#load-if-not-defined FRANKISH-CIV
#load-if-not-defined SPANISH-CIV
#load-if-not-defined HUN-CIV
#load-if-not-defined JAPANESE-CIV
#load-if-not-defined KOREAN-CIV
#load-if-not-defined MAYAN-CIV
#load-if-not-defined MONGOL-CIV
#load-if-not-defined PERSIAN-CIV
#load-if-not-defined SARACEN-CIV
#load-if-not-defined TEUTONIC-CIV
#load-if-not-defined VIKING-CIV ; Byzantines, Goths

(defrule
(or	(players-civ focus-player byzantine)
(or	(players-civ focus-player gothic)
(or	(players-civ focus-player japanese)
	(players-civ focus-player slavic))))
=>
	(up-jump-rule 1))
(defrule
	(goal milunits yes)
	(goal allowspears yes)
	(strategic-number moenche < 15)
	(up-research-status c: ri-pikeman != research-available); test
	(up-research-status c: ri-halberdier != research-available)
	(food-amount >= pk-buffer-f)
(or	(strategic-number cavalry >= 7)
	(strategic-number sn-military-superiority <= -1))
	(up-compare-goal excessGold < 225); test
	(population < siege-pop)
	(players-unit-type-count focus-player spearman-line >= 6)
	(strategic-number spears g:> spearcount)
	(unit-type-count-total spearman-line < 30)
=>
	(set-goal trainpike yes))

#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
;=========================================================
; Skirmishers
;=========================================================
#load-if-not-defined BYZANTINE-CIV
(defrule
	(goal milunits yes)
	(strategic-number moenche < 15)
(or	(players-unit-type-count focus-player mameluke-line >= 3)
	(strategic-number archers >= 3))
(or	(food-amount >= sk-buffer-f)
(or	(strategic-number sn-military-superiority <= -2); test
	(goal underattack yes)))
	(up-compare-goal skirmisher-set < 6); 8 
=>
	(set-goal trainskirm yes))
;=========================================================
(defrule
	(goal milunits yes)
	(strategic-number moenche < 15)
(or	(players-unit-type-count focus-player mameluke-line >= 5)
	(strategic-number archers >= 5))
	(food-amount >= sk-buffer-f)
	(up-compare-goal skirmisher-set < 10); 11
=>
	(set-goal trainskirm yes))
;=========================================================
(defrule
	(goal milunits yes)
	(strategic-number moenche < 15)
(or	(players-unit-type-count focus-player mameluke-line >= 7)
	(strategic-number archers >= 7))
(or	(food-amount >= sk-buffer-f)
	(goal underattack yes))
	(up-compare-goal skirmisher-set < 14); 16
=>
	(set-goal trainskirm yes))
;=========================================================
(defrule
	(goal milunits yes)
(or	(players-unit-type-count focus-player mameluke-line >= 10)
	(strategic-number archers >= 10))
	(food-amount >= sk-buffer-f)
	(up-compare-goal skirmisher-set < 20); 21
=>
	(set-goal trainskirm yes))
;=========================================================
(defrule
	(goal milunits yes)
(or	(players-unit-type-count focus-player mameluke-line >= 15)
	(strategic-number archers >= 15))
	(food-amount >= sk-buffer-f)
(or	(up-research-status c: ri-hand-cart >= research-pending)
(or	(goal defend yes)
	(strategic-number sn-military-superiority <= 0)))
	(up-compare-goal skirmisher-set < 30); 32
=>
	(set-goal trainskirm yes))
;=========================================================
(defrule
	(goal milunits yes)
(or	(players-unit-type-count focus-player mameluke-line >= 25)
	(strategic-number archers >= 25))
	(food-amount >= sk-buffer-f)
(or	(up-research-status c: ri-hand-cart >= research-pending)
(or	(goal defend yes)
	(strategic-number sn-military-superiority <= 0)))
	(up-compare-goal skirmisher-set < 48)
=>
	(set-goal trainskirm yes))
;=========================================================
(defrule
	(goal milunits yes)
(or	(players-unit-type-count focus-player mameluke-line >= 40)
	(strategic-number archers >= 40))
	(food-amount >= sk-buffer-f)
(or	(up-research-status c: ri-hand-cart >= research-pending)
(or	(goal defend yes)
	(strategic-number sn-military-superiority <= 0)))
	(up-compare-goal skirmisher-set < 60)
=>
	(set-goal trainskirm yes))
#load-if-defined POPULATION-CAP-EXTENDED
#load-if-not-defined POPULATION-CAP-225
#load-if-not-defined POPULATION-CAP-250
#load-if-not-defined POPULATION-CAP-275
#load-if-not-defined POPULATION-CAP-300
#load-if-not-defined POPULATION-CAP-325
#load-if-not-defined POPULATION-CAP-350
#load-if-not-defined POPULATION-CAP-375
#load-if-not-defined POPULATION-CAP-400
#load-if-not-defined POPULATION-CAP-425
(defrule
	(goal milunits yes)
(or	(players-unit-type-count focus-player mameluke-line >= 40)
	(strategic-number archers >= 40))
	(food-amount >= sk-buffer-f)
(or	(up-research-status c: ri-hand-cart >= research-pending)
(or	(goal defend yes)
	(strategic-number sn-military-superiority <= 0)))
	(up-compare-goal skirmisher-set < 200)
=>
	(set-goal trainskirm yes))
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if

#else ; byzantines

(defrule
	(goal milunits yes)
	(strategic-number moenche < 15)
(or	(players-unit-type-count focus-player mameluke-line >= 3)
	(strategic-number archers >= 3))
(or	(food-amount >= sk-buffer-f)
(or	(strategic-number sn-military-superiority <= -2); test
	(goal underattack yes)))
	(up-compare-goal skirmisher-set < 8); 9
=>
	(set-goal trainskirm yes))
;=========================================================
(defrule
	(goal milunits yes)
	(strategic-number moenche < 15)
(or	(players-unit-type-count focus-player mameluke-line >= 5)
	(strategic-number archers >= 5))
(or	(food-amount >= sk-buffer-f)
	(goal underattack yes))
	(up-compare-goal skirmisher-set < 13); 15
=>
	(set-goal trainskirm yes))
;=========================================================
(defrule
	(goal milunits yes)
(or	(players-unit-type-count focus-player mameluke-line >= 7)
	(strategic-number archers >= 7))
(or	(food-amount >= sk-buffer-f)
	(goal underattack yes))
	(up-compare-goal skirmisher-set < 18); 21
=>
	(set-goal trainskirm yes))
;=========================================================
(defrule
	(goal milunits yes)
(or	(players-unit-type-count focus-player mameluke-line >= 10)
	(strategic-number archers >= 10))
	(food-amount >= sk-buffer-f)
(or	(up-research-status c: ri-hand-cart >= research-pending)
(or	(goal defend yes)
	(strategic-number sn-military-superiority <= 0)))
	(up-compare-goal skirmisher-set < 25); 28
=>
	(set-goal trainskirm yes))
;=========================================================
(defrule
	(goal milunits yes)
(or	(players-unit-type-count focus-player mameluke-line >= 15)
	(strategic-number archers >= 15))
	(food-amount >= sk-buffer-f)
(or	(up-research-status c: ri-hand-cart >= research-pending)
(or	(goal defend yes)
	(strategic-number sn-military-superiority <= 0)))
	(up-compare-goal skirmisher-set < 35); 36
=>
	(set-goal trainskirm yes))
;=========================================================
(defrule
	(goal milunits yes)
(or	(players-unit-type-count focus-player mameluke-line >= 25)
	(strategic-number archers >= 25))
	(food-amount >= sk-buffer-f)
(or	(up-research-status c: ri-hand-cart >= research-pending)
(or	(goal defend yes)
	(strategic-number sn-military-superiority <= 0)))
	(up-compare-goal skirmisher-set < 50)
=>
	(set-goal trainskirm yes))
;=========================================================
(defrule
	(goal milunits yes)
(or	(players-unit-type-count focus-player mameluke-line >= 40)
	(strategic-number archers >= 40))
	(food-amount >= sk-buffer-f)
(or	(up-research-status c: ri-hand-cart >= research-pending)
(or	(goal defend yes)
	(strategic-number sn-military-superiority <= 0)))
	(up-compare-goal skirmisher-set < 65)
=>
	(set-goal trainskirm yes))
#load-if-defined POPULATION-CAP-EXTENDED
#load-if-not-defined POPULATION-CAP-225
#load-if-not-defined POPULATION-CAP-250
#load-if-not-defined POPULATION-CAP-275
#load-if-not-defined POPULATION-CAP-300
#load-if-not-defined POPULATION-CAP-325
#load-if-not-defined POPULATION-CAP-350
#load-if-not-defined POPULATION-CAP-375
#load-if-not-defined POPULATION-CAP-400
#load-if-not-defined POPULATION-CAP-425
(defrule
	(goal milunits yes)
(or	(players-unit-type-count focus-player mameluke-line >= 40)
	(strategic-number archers >= 40))
	(food-amount >= sk-buffer-f)
(or	(up-research-status c: ri-hand-cart >= research-pending)
(or	(goal defend yes)
	(strategic-number sn-military-superiority <= 0)))
	(up-compare-goal skirmisher-set < 250)
=>
	(set-goal trainskirm yes))
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if

#end-if; non-byz

#load-if-defined UP-GAME-WK
(defrule
	(up-compare-goal trainskirm != no)
	(up-research-status c: ri-elite-skirmisher <= research-unavailable)
(or	(and	(current-age >= castle-age)
		(strategic-number sn-current-age >= imperial))
(or	(unit-available genitour)
(or	(unit-available elite-genitour)
	(unit-available 732))))
=>
	(set-goal trainskirm no)
	(set-goal traingenitour yes))
(defrule
	(up-compare-goal traingenitour != no)
	(players-unit-type-count focus-player genoese-crossbowman >= 6)
	(up-research-status c: ri-elite-skirmisher >= research-available);
=>
	(set-goal traingenitour no)
	(set-goal trainskirm yes))
#end-if

(defrule
	(goal milunits yes)
	(strategic-number moenche < 15)
	(food-amount >= sk-buffer-f)
	(strategic-number infantry <= 5)
	(strategic-number cavalry < 3)
	(strategic-number eagles < 3)
	(strategic-number husks < 3)
(or	(strategic-number sn-military-superiority <= -2)
	(and	(goal enemy-goal flush)
		(strategic-number sn-military-superiority <= -1)))
	(current-age <= feudal-age)
	(up-compare-goal skirmisher-set < 12)
=>
	(set-goal trainskirm yes))
;=========================================================
(defrule
	(goal milunits yes)
	(strategic-number moenche < 15)
	(food-amount >= sk-buffer-f)
	(strategic-number infantry <= 5)
	(strategic-number cavalry < 3)
	(strategic-number eagles < 3)
	(strategic-number husks < 3)
(or	(strategic-number sn-military-superiority <= -2); -2
	(goal underattack yes))
	(building-type-count stable <= 0)
	(building-type-count castle <= 0)
	(current-age <= castle-age);
	(up-compare-goal skirmisher-set < 12)
=>
	(set-goal trainskirm yes))
;=========================================================
(defrule
	(goal milunits yes) ; feudal def
	(goal position-goal flank)
	(up-research-status c: castle-age <= research-pending); ==
(or	(strategic-number sn-military-superiority <= -2)
(or	(strategic-number skirmsarchers >= 10)
	(strategic-number archers >= 5)))
	(players-unit-type-count focus-player militiaman-line < 6)
	(strategic-number cavalry < 6)
	(strategic-number eagles < 3)
	(strategic-number husks < 3)
	(wood-amount >= sk-buffer-w);
	(food-amount >= sk-buffer-f)
	(strategic-number sn-military-superiority <= -1)
=>
	(set-goal trainskirm yes))
;=========================================================
(defrule
	(goal milunits yes)
	(goal enemy-goal flush)
	(up-research-status c: castle-age == research-pending);	(strategic-number sn-current-age == fcastlea)
	(players-unit-type-count focus-player militiaman-line < 6)
	(players-unit-type-count focus-player scout-cavalry-line < 6)
; tl	(strategic-number cavalry < 3)
	(strategic-number eagles < 3)
	(strategic-number husks < 3)
	(food-amount >= sk-buffer-f)
	(strategic-number sn-military-superiority <= 0)
(or	(strategic-number sn-military-superiority <= -1)
	(and	(up-research-status c: ri-double-bit-axe >= research-pending)
		(up-research-status c: ri-horse-collar >= research-pending)))
	(up-compare-goal skirmisher-set < 16)
=>
	(set-goal trainskirm yes))
;=========================================================
(defrule
	(goal milunits yes)
	(goal enemy-goal rush)
(or	(food-amount >= sk-buffer-f)
	(goal underattack yes));(strategic-number sn-military-superiority <= -2))
	(players-unit-type-count focus-player militiaman-line < 8)
	(strategic-number eagles < 3)
	(strategic-number husks < 3)
	(players-unit-type-count focus-player knight-line < 4)
	(players-unit-type-count focus-player scout-cavalry-line < 6)
	(strategic-number sn-military-superiority <= 0)
	(up-compare-goal skirmisher-set < 16)
=>
	(set-goal trainskirm yes))
;=========================================================
(defrule
	(goal milunits yes)
	(goal enemy-goal flush)
	(players-current-age focus-player == feudal-age)
(or	(players-building-type-count focus-player archery-range > 0)
	(strategic-number archers >= 3))
(or	(players-unit-type-count focus-player militiaman-line < 6)
	(players-unit-type-count focus-player archer-line >= 6))
	(strategic-number sn-military-superiority <= -1)
(or	(food-amount >= sk-buffer-f)
	(goal underattack yes));(strategic-number sn-military-superiority <= -2))
	(strategic-number eagles < 3)
	(strategic-number husks < 3)
;	(up-compare-goal skirmisher-set < 20)
=>
	(set-goal trainskirm yes))
;=========================================================
(defrule
	(goal milunits yes)
	(strategic-number moenche < 15)
	(strategic-number archers >= 5)
	(strategic-number sn-military-superiority <= -1)
	(commodity-selling-price wood < 50)
	(commodity-selling-price food < 50)
	(food-amount >= sk-buffer-f)
(or	(players-unit-type-count focus-player militiaman-line < 8)
	(strategic-number archers >= 10))
	(up-compare-goal skirmisher-set < 16)
=>
	(set-goal trainskirm yes))
;=========================================================
#load-if-defined BYZANTINE-CIV
(defrule
	(players-civ any-enemy vietnamese)
(not	(players-civ any-ally vietnamese))
	(up-research-status c: ri-imperial-skirmisher <= research-unavailable); test
=>
	(up-jump-rule 1))
(defrule
	(goal milunits yes)
	(up-research-status c: ri-elite-skirmisher != research-available); test
(not	(players-civ focus-player byzantine))
	(food-amount >= sk-buffer-f)
(or	(strategic-number archers >= 7)
	(strategic-number sn-military-superiority <= -1))
	(up-compare-goal excessGold < 225); test
	(population < siege-pop)
	(strategic-number skirms >= 6)
	(strategic-number skirms g:> skirmcount)
	(up-compare-goal skirmisher-set < 40)
=>
	(set-goal trainskirm yes))
#end-if
;=========================================================
; Arbs
;=========================================================
#load-if-not-defined SPANISH-CIV

(defrule ; anti-flush test
	(goal milunits yes)
	(strategic-number skirms < 9); 10
(or	(strategic-number sn-military-superiority <= -2); (gold-amount >= 245); test
(or	(players-building-type-count focus-player barracks >= 2)
(or	(players-unit-type-count focus-player spearman-line >= 7)
	(players-unit-type-count focus-player militiaman-line >= 4))))
	(goal enemy-goal flush)
	(strategic-number sn-military-superiority <= -1)
	(players-current-age focus-player == feudal-age)
	(unit-type-count-total archer-line < 20)
=>
	(set-goal trainarcher yes))

#load-if-not-defined HUN-CIV
(defrule
	(goal milunits yes) ; crossbow help
(or	(up-research-status c: ri-crossbow >= research-pending)
	(strategic-number sn-military-superiority <= -2))
	(population < up-max-civ)
	(current-age <= castle-age)
	(strategic-number sn-military-superiority <= -1)
	(wood-amount >= 100)
	(gold-amount >= 150)
	(strategic-number siege < 3)
	(strategic-number skirms < 12)
	(strategic-number husks < 4)
	(goal escrowing no)
	(unit-type-count-total archer-line < 40)
=>
	(set-goal trainarcher yes))
#else
(defrule
	(goal milunits yes)
	(population < up-max-civ)
	(current-age <= castle-age)
	(strategic-number sn-military-superiority <= -1)
	(wood-amount >= 100)
	(gold-amount >= 150)
	(strategic-number siege < 3)
	(strategic-number skirms < 12)
	(strategic-number husks < 4)
	(goal escrowing no)
	(unit-type-count-total cavalry-archer-line < 33)
=>
	(set-goal traincavarcher yes))
#end-if


#load-if-not-defined BERBERS-CIV
#load-if-not-defined BURMESE-CIV
#load-if-not-defined CELTIC-CIV
#load-if-not-defined FRANKISH-CIV
#load-if-not-defined GOTHIC-CIV
#load-if-not-defined HUN-CIV
#load-if-not-defined INDIAN-CIV
#load-if-not-defined KHMER-CIV
#load-if-not-defined PERSIAN-CIV
#load-if-not-defined SLAVIC-CIV
#load-if-not-defined TEUTONIC-CIV
#load-if-not-defined TURKISH-CIV ; arbalest civs
(defrule
	(goal milunits yes)
(not	(strategic-number husks >= 5))
	(strategic-number infantry >= 3)
	(unit-type-count-total scorpion-line < 4)
	(up-compare-goal mangonel-set < 4)
	(unit-type-count-total bombard-cannon < 4)
	(unit-type-count-total archer-line < 9)
=>
	(set-goal trainarcher yes))
;=========================================================
(defrule
	(goal milunits yes)
(not	(strategic-number husks >= 8))
	(strategic-number infantry >= 5)
	(unit-type-count-total scorpion-line < 8)
	(up-compare-goal mangonel-set < 8)
	(unit-type-count-total bombard-cannon < 8)
	(unit-type-count-total archer-line < 12)
=>
	(set-goal trainarcher yes))
;=========================================================
(defrule
	(goal milunits yes)
(not	(strategic-number husks >= 11))
	(strategic-number infantry >= 10)
	(unit-type-count-total scorpion-line < 13)
	(up-compare-goal mangonel-set < 13)
	(unit-type-count-total bombard-cannon < 13)
	(unit-type-count-total archer-line < 20)
=>
	(set-goal trainarcher yes))
;=========================================================
(defrule
	(goal milunits yes)
(not	(strategic-number husks >= 14))
	(strategic-number infantry >= 15)
	(unit-type-count-total scorpion-line < 19)
	(up-compare-goal mangonel-set < 19)
	(unit-type-count-total bombard-cannon < 19)
	(unit-type-count-total archer-line < 30)
=>
	(set-goal trainarcher yes))
;=========================================================
(defrule
	(goal milunits yes)
(not	(strategic-number husks >= 17))
	(strategic-number infantry >= 25)
	(unit-type-count-total scorpion-line < 26)
	(up-compare-goal mangonel-set < 26)
	(unit-type-count-total bombard-cannon < 26)
	(unit-type-count-total archer-line < 44)
=>
	(set-goal trainarcher yes))
;=========================================================
(defrule
	(goal milunits yes)
(not	(strategic-number husks >= 20))
	(strategic-number infantry >= 40)
	(unit-type-count-total scorpion-line < 34)
	(up-compare-goal mangonel-set < 34)
	(unit-type-count-total bombard-cannon < 34)
	(unit-type-count-total archer-line < 60)
=>
	(set-goal trainarcher yes))
;=========================================================
(defrule
	(goal milunits yes)
	(strategic-number sn-current-age >= fcastlea)
	(strategic-number husks < 5)
	(strategic-number skirms < 15)
	(strategic-number siege < 7)
	(players-unit-type-count focus-player eagle-warrior-line < 15)
	(strategic-number sn-military-superiority <= -1)
(or	(players-building-type-count focus-player barracks >= 2)
	(players-unit-type-count focus-player militiaman-line >= 2))
	(goal enemy-goal rush)
	(current-age <= castle-age)
	(unit-type-count-total archer-line < 20)
=>
	(set-goal trainarcher yes))
;=========================================================
(defrule
	(goal milunits yes)
	(strategic-number skirms < 20)
	(strategic-number husks < 5)
	(players-unit-type-count focus-player war-wagon-line < 5)
	(strategic-number archers < 15); else just go for skirms
	(strategic-number cavalry < 15)
(or	(civ-selected aztec)
	(civ-selected mayan))
	(strategic-number sn-military-superiority <= -1); -2
	(strategic-number sn-current-age < imperial)
	(unit-type-count-total archer-line < 25)
=>
	(set-goal trainarcher yes))

#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if

#end-if

#load-if-not-defined INCAN-CIV
#load-if-not-defined ITALIAN-CIV
#load-if-not-defined MAGYAR-CIV
#load-if-not-defined SLAVIC-CIV

#load-if-not-defined ETHIOPIAN-CIV
#load-if-not-defined MALAY-CIV
#load-if-not-defined MALIAN-CIV
#load-if-not-defined PORTUGUESE-CIV
#load-if-not-defined VIETNAMESE-CIV

#load-if-not-defined AZTEC-CIV
#load-if-not-defined BRITON-CIV
#load-if-not-defined MONGOL-CIV
#load-if-not-defined CELTIC-CIV
#load-if-not-defined CHINESE-CIV
#load-if-not-defined HUN-CIV
#load-if-not-defined KOREAN-CIV
#load-if-not-defined BYZANTINE-CIV
#load-if-not-defined JAPANESE-CIV
#load-if-not-defined MAYAN-CIV
#load-if-not-defined SARACEN-CIV
#load-if-not-defined VIKING-CIV ; Goths, Turks, Teutons, Persians, Franks, (Spanish), Berbers, Burmese, Khmer

#load-if-not-defined SPANISH-CIV
(defrule
	(goal milunits yes)
(not	(strategic-number husks >= 5))
	(strategic-number infantry >= 3)
(or	(up-research-status c: ri-chemistry < research-pending)
	(current-age < imperial-age))
	(unit-type-count-total scorpion-line < 4)
	(up-compare-goal mangonel-set < 4)
	(unit-type-count-total bombard-cannon < 4)
	(unit-type-count-total archer-line < 9)
=>
	(set-goal trainarcher yes))
;=========================================================
(defrule
	(goal milunits yes)
(not	(strategic-number husks >= 8))
	(strategic-number infantry >= 5)
(or	(up-research-status c: ri-chemistry < research-pending)
	(current-age < imperial-age))
	(unit-type-count-total scorpion-line < 8)
	(up-compare-goal mangonel-set < 8)
	(unit-type-count-total bombard-cannon < 8)
	(unit-type-count-total archer-line < 12)
=>
	(set-goal trainarcher yes))
;=========================================================
(defrule
	(goal milunits yes)
(not	(strategic-number husks >= 11))
	(strategic-number infantry >= 10)
(or	(up-research-status c: ri-chemistry < research-pending)
	(current-age < imperial-age))
	(unit-type-count-total scorpion-line < 13)
	(up-compare-goal mangonel-set < 13)
	(unit-type-count-total bombard-cannon < 13)
	(unit-type-count-total archer-line < 18)
=>
	(set-goal trainarcher yes))
;=========================================================
(defrule
	(goal milunits yes)
(not	(strategic-number husks >= 14))
	(strategic-number infantry >= 15)
(or	(up-research-status c: ri-chemistry < research-pending)
	(current-age < imperial-age))
	(unit-type-count-total scorpion-line < 19)
	(up-compare-goal mangonel-set < 19)
	(unit-type-count-total bombard-cannon < 19)
	(unit-type-count-total archer-line < 26)
=>
	(set-goal trainarcher yes))
;=========================================================
(defrule
	(goal milunits yes)
(not	(strategic-number husks >= 17))
	(strategic-number infantry >= 25)
(or	(up-research-status c: ri-chemistry < research-pending)
	(current-age < imperial-age))
	(unit-type-count-total scorpion-line < 26)
	(up-compare-goal mangonel-set < 26)
	(unit-type-count-total bombard-cannon < 26)
	(unit-type-count-total archer-line < 40)
=>
	(set-goal trainarcher yes))
;=========================================================
(defrule
	(goal milunits yes)
(not	(strategic-number husks >= 20))
	(strategic-number infantry >= 40)
(or	(up-research-status c: ri-chemistry < research-pending)
	(current-age < imperial-age))
	(unit-type-count-total scorpion-line < 34)
	(up-compare-goal mangonel-set < 34)
	(unit-type-count-total bombard-cannon < 34)
	(unit-type-count-total archer-line < 60)
=>
	(set-goal trainarcher yes))
;=========================================================
(defrule
	(goal milunits yes)
	(strategic-number husks < 5)
	(strategic-number skirms < 15)
	(strategic-number siege < 7)
	(players-unit-type-count focus-player eagle-warrior-line < 10)
	(strategic-number sn-military-superiority <= -1)
(or	(players-building-type-count focus-player barracks >= 2)
	(players-unit-type-count focus-player militiaman-line >= 2))
	(goal enemy-goal rush)
(or	(strategic-number sn-current-age == fcastlea)
	(strategic-number sn-current-age == castlea))
	(unit-type-count-total archer-line < 15)
=>
	(set-goal trainarcher yes))
;=========================================================
(defrule
	(goal milunits yes)
	(current-age != imperial-age)
	(strategic-number skirms < 10)
;	(players-unit-type-count focus-player scout-cavalry < 8)
(or	(players-building-type-count focus-player barracks >= 2)
(or	(players-unit-type-count focus-player spearman-line >= 6)
	(players-unit-type-count focus-player militiaman-line >= 2)))
	(goal enemy-goal flush)
	(strategic-number sn-military-superiority <= -1)
	(players-current-age focus-player == feudal-age)
	(unit-type-count-total archer-line < 10)
=>
	(set-goal trainarcher yes))
#end-if

;=========================================================
(defrule
	(goal milunits yes)
	(strategic-number infantry >= 3)
	(strategic-number sn-current-age >= imperial)
	(unit-type-count-total scorpion-line < 4)
	(up-compare-goal mangonel-set < 4)
	(unit-type-count-total bombard-cannon < 4)
	(unit-type-count-total hand-cannoneer < 9)
=>
	(set-goal trainhandcannon yes))
;=========================================================
(defrule
	(goal milunits yes)
	(strategic-number infantry >= 5)
	(strategic-number sn-current-age >= imperial)
	(unit-type-count-total scorpion-line < 8)
	(up-compare-goal mangonel-set < 8)
	(unit-type-count-total bombard-cannon < 8)
	(unit-type-count-total hand-cannoneer < 12)
=>
	(set-goal trainhandcannon yes))
;=========================================================
(defrule
	(goal milunits yes)
	(strategic-number infantry >= 10)
	(strategic-number sn-current-age >= imperial)
	(unit-type-count-total scorpion-line < 13)
	(up-compare-goal mangonel-set < 13)
	(unit-type-count-total bombard-cannon < 13)
	(unit-type-count-total hand-cannoneer < 18)
=>
	(set-goal trainhandcannon yes))
;=========================================================
(defrule
	(goal milunits yes)
	(strategic-number infantry >= 15)
	(strategic-number sn-current-age >= imperial)
	(unit-type-count-total scorpion-line < 19)
	(up-compare-goal mangonel-set < 19)
	(unit-type-count-total bombard-cannon < 19)
	(unit-type-count-total hand-cannoneer < 26)
=>
	(set-goal trainhandcannon yes))
;=========================================================
(defrule
	(goal milunits yes)
	(strategic-number infantry >= 25)
	(strategic-number sn-current-age >= imperial)
	(unit-type-count-total scorpion-line < 26)
	(up-compare-goal mangonel-set < 26)
	(unit-type-count-total bombard-cannon < 26)
	(unit-type-count-total hand-cannoneer < 40)
=>
	(set-goal trainhandcannon yes))
;=========================================================
(defrule
	(goal milunits yes)
	(strategic-number infantry >= 40)
	(strategic-number sn-current-age >= imperial)
	(unit-type-count-total scorpion-line < 34)
	(up-compare-goal mangonel-set < 34)
	(unit-type-count-total bombard-cannon < 34)
	(unit-type-count-total hand-cannoneer < 60)
=>
	(set-goal trainhandcannon yes))

#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if

#end-if
#end-if
#end-if
#end-if
#end-if

#end-if
#end-if
#end-if
#end-if
#end-if

#load-if-defined SARACEN-CIV
(defrule
	(goal milunits yes)
	(strategic-number skirms < 35)
	(strategic-number cavalry < 33)
(or	(strategic-number sn-current-age >= imperial)
	(strategic-number sn-military-superiority <= -2))
	(strategic-number sn-military-superiority <= 0)
(or	(goal trainunique no);(nand	(goal uugoal yes)
	(building-type-count castle <= 0));	(building-type-count castle >= 1))
	(population < siege-pop); test
	(unit-type-count-total archer-line < 75)
=>
	(set-goal trainarcher yes))
#end-if

#load-if-defined HUN-CIV
(defrule
	(goal milunits yes)
(nor	(strategic-number skirms > 34)
(or	(strategic-number camels > 24)
(or	(strategic-number husks >= 20)
	(strategic-number archers >= 25))))
(or	(players-unit-type-count focus-player teutonic-knight-line >= 10)
	(players-unit-type-count focus-player war-elephant-line >= 6))
	(unit-type-count-total cavalry-archer-line < 40)
=>
	(set-goal traincavarcher yes))
;=========================================================
(defrule
	(goal milunits yes)
(nor	(strategic-number skirms > 24)
(or	(strategic-number camels > 14)
(or	(strategic-number husks >= 8)
	(strategic-number archers >= 10))))
	(strategic-number infantry >= 3)
	(unit-type-count-total cavalry-archer-line < 7)
=>
	(set-goal traincavarcher yes))
;=========================================================
(defrule
	(goal milunits yes)
(nor	(strategic-number skirms > 32)
(or	(strategic-number camels > 19)
(or	(strategic-number husks >= 11)
	(strategic-number archers >= 15))))
	(strategic-number infantry >= 5)
	(unit-type-count-total cavalry-archer-line < 11)
=>
	(set-goal traincavarcher yes))
;=========================================================
(defrule
	(goal milunits yes)
(nor	(strategic-number skirms > 40)
(or	(strategic-number husks >= 14)
(or	(strategic-number camels > 24)
	(strategic-number archers >= 15))))
	(strategic-number infantry >= 7)
	(unit-type-count-total cavalry-archer-line < 15)
=>
	(set-goal traincavarcher yes))
;=========================================================
(defrule
	(goal milunits yes)
(nor	(strategic-number skirms > 48)
(or	(strategic-number husks >= 17)
(or	(strategic-number camels > 29)
	(strategic-number archers >= 25))))
	(strategic-number infantry >= 10)
	(unit-type-count-total cavalry-archer-line < 20)
=>
	(set-goal traincavarcher yes))
;=========================================================
(defrule
	(goal milunits yes)
(nor	(strategic-number skirms > 56)
(or	(strategic-number husks >= 20)
(or	(strategic-number camels > 34)
	(strategic-number archers >= 25))))
	(strategic-number infantry >= 15)
	(unit-type-count-total cavalry-archer-line < 28)
=>
	(set-goal traincavarcher yes))
;=========================================================
(defrule
	(goal milunits yes)
(nor	(strategic-number skirms > 64)
(or	(strategic-number husks >= 20)
(or	(strategic-number camels > 39)
	(strategic-number archers >= 40))))
	(strategic-number infantry >= 25)
	(unit-type-count-total cavalry-archer-line < 40)
=>
	(set-goal traincavarcher yes))
;=========================================================
(defrule
	(goal milunits yes)
(not	(strategic-number husks >= 30))
	(strategic-number infantry >= 40)
	(unit-type-count-total cavalry-archer-line < 55)
=>
	(set-goal traincavarcher yes))
;=========================================================
(defrule
	(goal milunits yes)
(nor	(strategic-number skirms > 39)
(or	(strategic-number husks >= 30)
(or	(strategic-number camels > 29)
(or	(strategic-number siege >= 10)
	(strategic-number archers >= 40)))))
	(gold-amount >= 800)
	(unit-type-count-total cavalry-archer-line < 60)
=>
	(set-goal traincavarcher yes))
;=========================================================
;(defrule
;	(goal milunits yes)
;(nor	(strategic-number skirms > 29)
;(or	(strategic-number camels > 24)
;	(strategic-number archers >= 25)))
;(or	(players-unit-type-count focus-player cavalry-archer-line >= 6)
;	(gold-amount > 200))
;	(gold-amount > 100)
;	(unit-type-count-total cavalry-archer-line < 20)
;=>
;	(set-goal traincavarcher yes))
#end-if
;=========================================================
(defrule
(or	(up-research-status c: ri-heavy-cavalry-archer < research-pending)
(or	(up-research-status c: ri-parthian-tactics <= research-unavailable)
(or	(up-research-status c: ri-bracer <= research-unavailable)
	(up-research-status c: ri-thumb-ring <= research-unavailable))))
	(up-research-status c: ri-sipahi < research-pending)
	(up-research-status c: ri-recurve-bow < research-pending)
=>
	(up-jump-rule 1))
(defrule
(or	(up-compare-const wk-game == 1)
	(civ-selected hun))
	(strategic-number husks < 12)
	(strategic-number camels < 24)
	(strategic-number skirms < 30)
	(strategic-number archers < 36)
;;	(up-compare-const ca-rush-affinity > a-rush-affinity)
;	(up-research-status c: ri-parthian-tactics >= research-pending)
;;	(up-research-status c: ri-bracer >= research-available)
;;	(up-research-status c: ri-leather-archer-armor >= research-available)
;;	(up-research-status c: ri-thumb-ring >= research-available)
	(up-compare-goal excessGold >= 500)
(or	(goal researchplan yes)
	(up-compare-goal excessGold >= 800))
=>
	(set-goal traincavarcher yes))
;=========================================================
(defrule
	(goal milunits yes)
	(strategic-number sn-military-superiority <= 1); 0
(or	(strategic-number sn-military-superiority <= -1); -2
	(gold-amount >= 200)); 100
	(strategic-number husks >= 10)
	(unit-type-count-total hand-cannoneer < 60)
(or	(strategic-number husks >= 20)
	(unit-type-count-total hand-cannoneer < 20))
(or	(strategic-number husks >= 30)
	(unit-type-count-total hand-cannoneer < 40))
=>
	(set-goal trainhandcannon yes))
;=========================================================
; Hussars
;=========================================================
(defrule
	(up-compare-goal milunits != no)
	(up-compare-goal strategy != krush)
	(goal enemy-goal rush)
	(strategic-number siege >= 3)
	(up-compare-goal mangonel-set < 4)
	(unit-type-count-total bombard-cannon < 4)
	(unit-type-count-total cavalry-class < 8)
	(unit-type-count-total magyar-huszar < 8)
	(unit-type-count-total boyar < 8)
	(unit-type-count-total scout-cavalry-line < 12)
=>
	(set-goal trainhussar yes))
;=========================================================
(defrule
(or	(unit-type-count-total scout-cavalry-line >= 50)
(or	(and	(strategic-number moenche < 11); 10
		(strategic-number moenchesiege < 15)); 14
(or	(or	(strategic-number spears >= 67)
		(strategic-number camels >= 67))
	(up-compare-goal milunits != yes))))
=>
	(up-jump-rule 3))
(defrule
	(strategic-number moenche < 10)
;(or	(up-compare-goal mangonel-set >= 6)
;(or	(unit-type-count-total bombard-cannon >= 9)
(or	(unit-type-count-total cavalry-class >= 15)
(or	(unit-type-count-total magyar-huszar >= 15)
(or	(unit-type-count-total boyar >= 15)
	(and	(up-compare-const uu-type == cavalry-uu)
		(unit-type-count-total my-unique-unit-line >= 15)))));))
=>
	(up-jump-rule 2))
(defrule
(or	(and	(unit-type-count-total scout-cavalry-line < 20)
		(and	(strategic-number camels < 40)
			(strategic-number spears < 40)))
	(and	(or	(strategic-number moenche >= 18)
			(strategic-number moenchesiege >= 22))
		(and	(unit-type-count-total scout-cavalry-line < 30)
			(and	(strategic-number camels < 48)
				(strategic-number spears < 48)))))
=>
	(set-goal trainhussar yes))
(defrule
(or	(and	(or	(strategic-number moenche >= 25); 26
			(strategic-number moenchesiege >= 29)); 30
		(and	(unit-type-count-total scout-cavalry-line < 40)
			(and	(strategic-number camels < 59)
				(strategic-number spears < 59))))
	(or	(strategic-number moenche >= 34)
		(strategic-number moenchesiege >= 38)))
=>
	(set-goal trainhussar yes)); end jump

#load-if-not-defined INCAN-CIV
;#load-if-not-defined INDIAN-CIV
#load-if-not-defined ITALIAN-CIV
;#load-if-not-defined MAGYAR-CIV
;#load-if-not-defined SLAVIC-CIV

;#load-if-not-defined BERBERS-CIV
;#load-if-not-defined BURMESE-CIV
#load-if-not-defined ETHIOPIAN-CIV;
#load-if-not-defined KHMER-CIV
#load-if-not-defined MALAY-CIV
#load-if-not-defined MALIAN-CIV
#load-if-not-defined PORTUGUESE-CIV
#load-if-not-defined VIETNAMESE-CIV

#load-if-not-defined AZTEC-CIV
#load-if-not-defined BRITON-CIV
#load-if-not-defined BYZANTINE-CIV
#load-if-not-defined CELTIC-CIV
#load-if-not-defined CHINESE-CIV
#load-if-not-defined FRANKISH-CIV
#load-if-not-defined GOTHIC-CIV
;#load-if-not-defined HUN-CIV
#load-if-not-defined JAPANESE-CIV
#load-if-not-defined KOREAN-CIV
#load-if-not-defined MAYAN-CIV
;#load-if-not-defined PERSIAN-CIV
;#load-if-not-defined SARACEN-CIV
;#load-if-not-defined SPANISH-CIV
#load-if-not-defined TEUTONIC-CIV
#load-if-not-defined VIKING-CIV ; Mongol, Turks, Saracens, Persians, Huns, Indians, Magyars, Slavs, Spanish, Berbers, Burmese

(defrule
(or	(up-compare-goal milunits != yes)
(or	(strategic-number sn-current-age <= castlea);	(strategic-number sn-current-age <= feudal)
(or	(strategic-number spears >= 40)
(or	;(and	(goal palagoal yes)
		(up-compare-goal excessGold >= 200);)
	(and	(unit-type-count-total scout-cavalry-line >= 60)
		(population-cap <= 224))))))
=>
	(up-jump-rule 2))
(defrule
(or	(up-compare-goal excessGold < 200); 225
	(population < max-civ-pop))
(or	(up-compare-goal excessGold < 100)
(or	(and	(or	(goal attacking yes)
			(goal underattack yes))
		(or	(up-compare-goal excessGold < 200)
			(strategic-number sn-military-superiority <= -2)))
	(strategic-number skirms >= 20)))
;(or
	(up-compare-goal excessFood >= 130)
;	(strategic-number sn-military-superiority <= -1))
=>
	(set-goal trainhussar yes))
(defrule
	(strategic-number spears < 15)
	(strategic-number camels < 12)
(or	(up-compare-goal excessGold < 200); 225
	(population < max-civ-pop))
	(population < siege-pop)
(or	(goal attacking yes)
(or	(and	(up-compare-goal excessFood >= 1200)
		(up-compare-goal excessGold < 800))
	(strategic-number sn-military-superiority <= -1)))
;(or
	(up-compare-goal excessFood >= 130)
;	(strategic-number sn-military-superiority <= -1))
	(unit-type-count-total scout-cavalry-line < 15)
=>
	(set-goal trainhussar yes))

;#end-if
;#end-if
;#end-if
;#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if

;#end-if
;#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if

;#end-if
;#end-if
;#end-if
#end-if
#end-if

;=========================================================
; Eagles
;=========================================================
(defrule
	(up-compare-goal milunits != no)
	(goal enemy-goal rush)
	(strategic-number siege >= 3)
	(up-compare-goal mangonel-set < 4)
	(unit-type-count-total bombard-cannon < 4)
	(unit-type-count-total cavalry-class < 8)
	(unit-type-count-total magyar-huszar < 8)
	(unit-type-count-total boyar < 8)
	(unit-type-count-total eagle-warrior-line < 18)
=>
	(set-goal traineagle yes))
;=========================================================
(defrule
	(goal milunits yes)
	(goal attacking no)
	(enemy-buildings-in-town)
	(up-compare-goal enemy-goal2 != klew)
	(goal allowspears yes); non meso enemy
	(unit-type-count-total battering-ram-line <= 0); total should be fine
	(unit-type-count-total trebuchet-set <= 0)
	(unit-type-count-total bombard-cannon <= 0)
	(players-building-type-count focus-player watch-tower-line > 0)
	(unit-type-count-total spearman-line < 8)
	(unit-type-count-total militiaman-line < 4)
	(unit-type-count-total eagle-warrior-line < 5)
=>
	(set-goal traineagle yes))
;=========================================================
;(defrule
;	(goal milunits yes)
;	(goal enemy-goal rush)
;	(up-compare-goal enemy-goal2 != klew)
;	(goal allowspears yes); non meso enemy
;	(strategic-number sn-military-superiority <= -1)
;	(unit-type-count-total militiaman-line < 10)
;	(unit-type-count-total eagle-warrior-line < 14)
;=>
;	(set-goal traineagle yes))
;=========================================================
;(defrule
;	(goal milunits yes)
;	(food-amount > 70)
;	(up-compare-goal enemy-goal2 != klew)
;	(goal allowspears yes); non meso enemy
;(or	(strategic-number sn-military-superiority <= -1)
;	(goal underattack yes))
;	(unit-type-count-total eagle-warrior-line < 13)
;	(unit-type-count-total militiaman-line < 8)
;	(strategic-number sn-current-age == castlea)
;=>
;	(set-goal traineagle yes))
;=========================================================
(defrule
	(goal milunits yes)
	(goal enemy-goal flush)
	(strategic-number sn-military-superiority <= -1)
	(unit-type-count-total eagle-warrior-line < 10)
	(players-unit-type-count focus-player militiaman-line < 6)
=>
	(set-goal traineagle yes))
;=========================================================
;(defrule
;	(goal milunits yes)
;	(up-compare-goal enemy-goal2 != klew)
;;tl	(goal allowspears yes); non meso enemy
;(or	(players-unit-type-count focus-player spearman-line > 6)
;(or	(players-unit-type-count focus-player archer-line > 7)
;(or	(players-unit-type-count focus-player eagle-warrior-line > 5)
;	(strategic-number skirms > 8))))
;	(food-amount > 70)
;(or	(goal enemy-goal rush)
;	(strategic-number sn-military-superiority <= -2))
;	(unit-type-count-total militiaman-line < 12)
;	(unit-type-count-total eagle-warrior-line < 15)
;=>
;	(set-goal traineagle yes))
;=========================================================
;(defrule
;	(goal milunits yes)
;	(up-compare-goal enemy-goal2 != klew)
;;tl	(goal allowspears yes); non meso enemy
;(nor	(players-unit-type-count focus-player militiaman-line > 25)
;(or	(players-unit-type-count focus-player cataphract-line > 25)
;(or	(players-unit-type-count focus-player knight-line > 25)
;(or	(players-unit-type-count focus-player war-elephant-line > 25)
;	(players-unit-type-count focus-player mameluke-line > 25)))))
;	(strategic-number sn-military-superiority <= -2)
;	(unit-type-count-total militiaman-line < 11)
;	(unit-type-count-total eagle-warrior-line < 16)
;=>
;	(set-goal traineagle yes))
;=========================================================
;(defrule
;	(goal milunits yes)
;	(up-compare-goal enemy-goal2 != klew)
;	(goal allowspears yes); non meso enemy
;(or	(goal enemy-goal rush)
;	(players-unit-type-count focus-player eagle-warrior-line > 15))
;	(players-unit-type-count focus-player eagle-warrior-line > 5)
;	(strategic-number sn-military-superiority <= -2)
;	(unit-type-count-total eagle-warrior-line < 12)
;	(unit-type-count-total militiaman-line < 10)
;=>
;	(set-goal traineagle yes))
;=========================================================
;(defrule
;;	(goal milunits yes)
;	(up-compare-goal enemy-goal2 != klew)
;	(goal allowspears yes); non meso enemy
;	(strategic-number sn-military-superiority <= 3)
;;(or
;	(goal underattack yes)
;;	(goal attacking yes))
;	(players-unit-type-count focus-player militiaman-line < 30)
;	(players-unit-type-count focus-player cataphract-line < 30)
;	(players-unit-type-count focus-player knight-line < 30)
;	(players-unit-type-count focus-player war-elephant-line < 30)
;	(players-unit-type-count focus-player mameluke-line < 30)
;	(unit-type-count-total militiaman-line < 10)
;	(unit-type-count-total eagle-warrior-line < 20)
;=>
;	(set-goal traineagle yes))
;=========================================================
(defrule
	(strategic-number moenche < 10)
(or	(up-compare-goal mangonel-set >= 6)
(or	(unit-type-count-total bombard-cannon >= 9)
(or	(unit-type-count-total cavalry-class >= 15)
(or	(unit-type-count-total magyar-huszar >= 15)
(or	(unit-type-count-total boyar >= 15)
	(and	(up-compare-const uu-type == cavalry-uu)
		(unit-type-count-total my-unique-unit-line >= 15)))))))
=>
	(up-jump-rule 3))
(defrule
(or	(unit-type-count-total eagle-warrior-line >= 60)
(or	(and	(strategic-number moenche < 10)
		(strategic-number moenchesiege < 14))
(or	(or	(players-unit-type-count focus-player militiaman-line >= 70)
		(players-unit-type-count focus-player jaguar-man-line >= 70))
	(up-compare-goal milunits != yes))))
=>
	(up-jump-rule 2))
(defrule
(or	(and	(unit-type-count-total eagle-warrior-line < 18)
		(and	(players-unit-type-count focus-player militiaman-line < 40)
			(players-unit-type-count focus-player jaguar-man-line < 40)))
	(and	(or	(strategic-number moenche >= 18)
			(strategic-number moenchesiege >= 22))
		(and	(unit-type-count-total eagle-warrior-line < 32)
			(and	(players-unit-type-count focus-player militiaman-line < 50)
				(players-unit-type-count focus-player jaguar-man-line < 50)))))
=>
	(set-goal traineagle yes))
(defrule
(or	(and	(or	(strategic-number moenche >= 26)
			(strategic-number moenchesiege >= 30))
		(and	(unit-type-count-total eagle-warrior-line < 46)
			(and	(players-unit-type-count focus-player militiaman-line < 60)
				(players-unit-type-count focus-player jaguar-man-line < 60))))
	(or	(strategic-number moenche >= 34)
		(strategic-number moenchesiege >= 38)))
=>
	(set-goal traineagle yes)); end jump
;=========================================================
;#load-if-defined AZTEC-CIV
;(defrule
;	(goal milunits yes)
;	(goal researchplan yes)
;	(strategic-number sn-military-superiority >= 0)
;	(strategic-number archers == 0)
;	(strategic-number cavalry == 0)
;	(strategic-number infantry == 0)
;	(unit-type-count-total militiaman-line < 20)
;	(unit-type-count-total eagle-warrior-line < 60)
;=>
;	(set-goal traineagle yes))
;#end-if
;=========================================================
#load-if-defined INCAN-CIV
(defrule
	(goal uugoal no)
	(goal trainslinger no)
	(up-compare-goal excessGold >= 250); 225
	(strategic-number sn-current-age >= imperial)
	(players-unit-type-count focus-player slinger < 10)
	(players-unit-type-count focus-player militiaman-line < 10)
	(players-unit-type-count focus-player samurai-line < 10)
	(players-unit-type-count focus-player teutonic-knight-line < 10)
	(players-unit-type-count focus-player throwing-axeman-line < 10)
	(players-unit-type-count focus-player berserk-line < 10)
	(players-unit-type-count focus-player jaguar-man-line < 10)
	(strategic-number husks < 10)
	(players-unit-type-count focus-player cataphract-line < 10)
	(players-unit-type-count focus-player war-elephant-line < 10)
	(players-unit-type-count focus-player mameluke-line < 10)
=>
	(set-goal traineagle yes))
#end-if
;=========================================================
(defrule
	(up-research-status c: ri-elite-eagle-warrior >= research-pending)
	(up-compare-goal excessGold >= 500); 900
(or	(up-research-status c: my-unique-research >= research-pending)
	(up-compare-goal excessGold >= 800))
	(players-unit-type-count focus-player militiaman-line < 7)
	(players-unit-type-count focus-player samurai-line < 7)
	(players-unit-type-count focus-player teutonic-knight-line < 7)
	(players-unit-type-count focus-player throwing-axeman-line < 7)
	(players-unit-type-count focus-player berserk-line < 7)
	(players-unit-type-count focus-player jaguar-man-line < 7)
	(strategic-number husks < 7)
	(players-unit-type-count focus-player cataphract-line < 7)
	(players-unit-type-count focus-player war-elephant-line < 7)
	(players-unit-type-count focus-player mameluke-line < 7)
=>
	(set-goal traineagle yes))
;=========================================================
(defrule
(or	(population >= max-civ-pop)
(or	(and	(up-research-status c: imperial-age >= research-pending)
		(and	(building-type-count castle >= 1)
			(goal uugoal yes)))
(or	(strategic-number teamsuperiority >= 2);(and	(up-research-status c: ri-forging < research-pending)
							;(up-research-status c: ri-scale-mail < research-pending))
	(and	(strategic-number sn-military-superiority >= 0)
		(military-population >= 33)))))
=>
	(up-jump-rule 2)); 3
(defrule
(or	(strategic-number sn-military-superiority >= 0); 1
(or	(current-age >= imperial-age)	;(and	(civ-selected saracen)
		;	(strategic-number sn-current-age >= imperial))
(or	(building-type-count barracks < 1)
(or	(up-compare-goal milunits != yes)
(or	(strategic-number archers >= 25)
(or	(strategic-number husks < 12)
(or	(players-unit-type-count focus-player samurai-line < 10)
	(players-unit-type-count focus-player militiaman-line < 10))))))))
=>
	(up-jump-rule 1)); 2
(defrule
(or	(strategic-number sn-military-superiority <= -2)
(or	(food-amount >= 70)
(or	(civilian-population >= up-max-civ)
	(goal underattack yes))))
;(up-research-status c: imperial-age < research-pending);(nand	(building-type-count castle >= 1)
;	(strategic-number sn-current-age >= imperial))
(or	(strategic-number sn-military-superiority <= -1)
	(goal defend yes))
	(unit-type-count-total eagle-warrior-line < 24); 20
=>
	(set-goal traineagle yes))
;=========================================================
; Camels
;=========================================================
(defrule
	(goal milunits yes)
	(strategic-number sn-military-superiority <= -2)
	(strategic-number spears < 10)
	(strategic-number moenche < 10)
	(current-age != imperial-age)
(or	(players-unit-type-count focus-player war-wagon-line >= 10)
(or	(players-unit-type-count focus-player mangudai-line >= 10)
(or	(players-unit-type-count focus-player conquistador-line >= 10)
	(players-unit-type-count focus-player cavalry-archer-line >= 10))))
	(unit-type-count-total camel-line < 15)
=>
	(set-goal traincamel yes))
;=========================================================
(defrule
	(goal milunits yes)
	(strategic-number sn-military-superiority <= -2)
	(strategic-number spears < 15)
	(strategic-number moenche < 10)
	(current-age != imperial-age)
(or	(players-unit-type-count focus-player war-wagon-line >= 15)
(or	(players-unit-type-count focus-player conquistador-line >= 15)
(or	(players-unit-type-count focus-player mangudai-line >= 15)
	(players-unit-type-count focus-player cavalry-archer-line >= 15))))
	(unit-type-count-total camel-line < 20)
=>
	(set-goal traincamel yes))
;=========================================================
(defrule
	(goal milunits yes)
	(strategic-number sn-military-superiority <= -2)
	(strategic-number spears < 25)
	(strategic-number moenche < 10)
	(current-age != imperial-age)
(or	(players-unit-type-count focus-player war-wagon-line >= 25)
(or	(players-unit-type-count focus-player conquistador-line >= 25)
(or	(players-unit-type-count focus-player mangudai-line >= 25)
	(players-unit-type-count focus-player cavalry-archer-line >= 25))))
	(unit-type-count-total camel-line < 30)
=>
	(set-goal traincamel yes))
;=========================================================
(defrule
	(goal milunits yes)
	(strategic-number sn-military-superiority <= -2)
	(strategic-number spears < 35)
	(strategic-number moenche < 10)
	(current-age != imperial-age)
(or	(players-unit-type-count focus-player war-wagon-line >= 35)
(or	(players-unit-type-count focus-player conquistador-line >= 35)
(or	(players-unit-type-count focus-player mangudai-line >= 35)
	(players-unit-type-count focus-player cavalry-archer-line >= 35))))
	(unit-type-count-total camel-line < 40)
=>
	(set-goal traincamel yes))

#load-if-not-defined INCAN-CIV
#load-if-not-defined ITALIAN-CIV
#load-if-not-defined MAGYAR-CIV
#load-if-not-defined SLAVIC-CIV
#load-if-not-defined AZTEC-CIV
#load-if-not-defined BRITON-CIV
#load-if-not-defined BYZANTINE-CIV
#load-if-not-defined CELTIC-CIV
#load-if-not-defined CHINESE-CIV
#load-if-not-defined FRANKISH-CIV
#load-if-not-defined GOTHIC-CIV
#load-if-not-defined HUN-CIV
#load-if-not-defined JAPANESE-CIV
#load-if-not-defined KOREAN-CIV
#load-if-not-defined MONGOL-CIV
#load-if-not-defined MAYAN-CIV
#load-if-not-defined PERSIAN-CIV
#load-if-not-defined SPANISH-CIV
#load-if-not-defined TEUTONIC-CIV
#load-if-not-defined TURKISH-CIV
#load-if-not-defined VIKING-CIV ; Saracens, Indians
(defrule
	(goal milunits yes)
	(strategic-number infantry < 25)
	(strategic-number archers < 25)
	(strategic-number spears < 15)
	(strategic-number moenche < 10)
(or	(strategic-number cavalry >= 3)
(or	(players-unit-type-count focus-player mangudai-line >= 3)
(or	(players-unit-type-count focus-player conquistador-line >= 3)
	(players-unit-type-count focus-player cavalry-archer-line >= 3))))
	(unit-type-count-total camel-line < 10)
	(unit-type-count-total imperial-camel < 10)
=>
	(set-goal traincamel yes))
;=========================================================
(defrule
	(goal milunits yes)
	(strategic-number infantry < 40)
	(strategic-number archers < 40)
	(strategic-number spears < 25)
	(strategic-number moenche < 10)
(or	(strategic-number cavalry >= 7)
(or	(players-unit-type-count focus-player mangudai-line >= 7)
(or	(players-unit-type-count focus-player conquistador-line >= 7)
	(players-unit-type-count focus-player cavalry-archer-line >= 7))))
	(unit-type-count-total camel-line < 20)
	(unit-type-count-total imperial-camel < 20)
=>
	(set-goal traincamel yes))
;=========================================================
(defrule
	(goal milunits yes)
	(strategic-number infantry < 40)
	(strategic-number archers < 40)
	(strategic-number spears < 40)
	(strategic-number moenche < 10)
(or	(strategic-number cavalry >= 15)
(or	(players-unit-type-count focus-player mangudai-line >= 15)
(or	(players-unit-type-count focus-player conquistador-line >= 15)
	(players-unit-type-count focus-player cavalry-archer-line >= 15))))
	(unit-type-count-total camel-line < 40)
	(unit-type-count-total imperial-camel < 40)
=>
	(set-goal traincamel yes))
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
(defrule
(or	(up-compare-goal milunits != yes)
(or	(unit-type-count-total camel-line >= 39)
(or	(unit-type-count-total imperial-camel >= 39)
(or	(strategic-number infantry >= 36)
(or	(strategic-number archers >= 48)
(or	(strategic-number spears >= 30)
	(strategic-number moenche >= 10)))))))
=>
	(up-jump-rule 2))
(defrule
	(strategic-number cavalry < 18)
	(players-unit-type-count focus-player genitour < 18)
	(players-unit-type-count focus-player elite-genitour < 18)
	(players-unit-type-count focus-player 732 < 18)
	(players-unit-type-count focus-player mangudai-line < 18)
	(players-unit-type-count focus-player conquistador-line < 18)
	(players-unit-type-count focus-player cavalry-archer-line < 18)
=>
	(up-jump-rule 1))
(defrule
(or	(up-research-status c: ri-heavy-camel >= research-pending)
(or	(and	(up-research-status c: my-unique-unit-upgrade <= research-available)
		(up-research-status c: ri-maghrabi-camels >= research-pending))
	(up-research-status c: ri-imperial-camel >= research-pending)))
=>
	(set-goal traincamel yes))
;=========================================================
; Champs
;=========================================================
(defrule
;test	(goal milunits yes)
(or	(goal strategy drush)
	(goal drushmicro yes))
(or	(food-amount >= 110)
(or	(unit-type-count-total militiaman-line == 4); just one left for 5 - sanic
	(up-pending-objects c: villager >= 2)))
	(players-current-age focus-player <= dark-age)
	(strategic-number sn-current-age < feudal)
	(unit-type-count-total 152 < 1); dead militias
	(unit-type-count-total militiaman-line < drush-militias)
=>
	(set-goal trainchamp yes))


#load-if-not-defined BERBERS-CIV
#load-if-not-defined BRITON-CIV
#load-if-not-defined BYZANTINE-CIV
#load-if-not-defined CELTIC-CIV
#load-if-not-defined CHINESE-CIV
#load-if-not-defined ETHIOPIAN-CIV
#load-if-not-defined FRANKISH-CIV
#load-if-not-defined HUN-CIV
#load-if-not-defined INCAN-CIV
#load-if-not-defined INDIAN-CIV
#load-if-not-defined ITALIAN-CIV
#load-if-not-defined KHMER-CIV
#load-if-not-defined KOREAN-CIV
#load-if-not-defined MAGYAR-CIV
#load-if-not-defined MAYAN-CIV
#load-if-not-defined MONGOL-CIV
#load-if-not-defined PERSIAN-CIV
#load-if-not-defined PORTUGUESE-CIV
#load-if-not-defined SARACEN-CIV
#load-if-not-defined SPANISH-CIV
#load-if-not-defined TEUTONIC-CIV
#load-if-not-defined TURKISH-CIV
#load-if-not-defined VIETNAMESE-CIV ; Aztecs, Goths, Vikings, Japanese, Malay, Malians, Burmese, Slavic

(defrule
(or	(up-compare-goal champgoal != yes)
(or	(up-compare-goal milunits != yes)
(or	(strategic-number sn-current-age < imperial)
	(nor	(up-research-status c: ri-champion >= research-pending)
		(and	(up-research-status c: ri-forced-levy >= research-pending)
			(up-research-status c: ri-two-handed-swordsman >= research-pending))))))
=>
	(up-jump-rule 1))
(defrule
	(strategic-number archers <= 32)
	(strategic-number cavalry <= 64)
	(strategic-number moenche <= 10)
	(strategic-number gunpowder <= 32)
	(players-unit-type-count focus-player teutonic-knight-line < 12)
	(players-unit-type-count focus-player jaguar-man-line < 12)
;	(strategic-number sn-current-age >= imperial)
;	(unit-type-count-total my-unique-unit-line < 30)
;	(unit-type-count-total militiaman-line < 90)
=>
	(set-goal trainchamp yes))
;=========================================================
;(defrule
;	(goal milunits yes)
;(nor	(strategic-number archers >= 15)
;(or	(strategic-number cavalry >= 25)
;(or	(strategic-number moenche >= 10)
;(or	(strategic-number gunpowder >= 15)
;	(players-unit-type-count focus-player teutonic-knight-line > 5)))))
;	(goal enemy-goal flush)
;	(game-time < 1110)
;	(strategic-number sn-military-superiority <= 0)
;	(unit-type-count-total militiaman-line < 18)
;=>
;	(set-goal trainchamp yes))

(defrule
(or	(goal champgoal yes)
(or	(players-unit-type-count focus-player teutonic-knight-line >= 15); 13
(or	(strategic-number archers >= 40); 26
(or	(strategic-number moenche >= 15); 11
(or	(up-compare-goal strategy == stonewall)
	(strategic-number sn-current-age < imperial))))))
=>
	(up-jump-rule 7))
(defrule
(or	(civ-selected malian)
(or	(civ-selected aztec)
	(civ-selected viking)))
(or	(up-compare-goal uugoal != yes)
	(and	(current-age >= imperial-age)
		(building-type-count-total castle <= 0)))
=>
	(set-goal champgoal yes))
(defrule
	(civ-selected japanese)
	(up-research-status c: imperial-age >= research-pending); (strategic-number sn-current-age >= imperial)
(or	(up-compare-goal uugoal != yes)
	(and	(current-age >= imperial-age)
		(current-age-time >= 180))); test
	(building-type-count-total castle <= 0)
	(stone-amount < castle-stone)
=>
	(set-goal champgoal yes))
(defrule
	(civ-selected gothic)
	(strategic-number sn-current-age >= imperial)
(or	(up-research-status c: my-unique-unit-upgrade >= research-pending)
(or	(strategic-number archers <= 5); test
(or	(and	(current-age >= imperial-age);(strategic-number sn-current-age >= imperial)
		(and	(building-type-count-total castle <= 0)
			(stone-amount < castle-stone)))
	(goal uugoal no))))
=>
	(set-goal temporary-goal7 57375))
(defrule
	(civ-selected gothic)
	(strategic-number sn-current-age >= imperial)
(or	(players-unit-type-count focus-player militiaman-line >= 15)
(or	(strategic-number husks >= 15)
	(players-unit-type-count focus-player eagle-warrior-line >= 20)))
=>
	(set-goal temporary-goal7 57375))
(defrule
	(goal temporary-goal7 57375)
=>
	(set-goal champgoal yes))
(defrule
	(civ-selected malay)
(or	(up-research-status c: ri-forced-levy >= research-pending)
(or	(goal trainchamp yes)
(or	(up-research-status c: ri-two-handed-swordsman >= research-pending)
	(unit-type-count-total militiaman-line >= 7))))
=>
	(set-goal champgoal yes))
(defrule
	(civ-selected malian)
	(goal uugoal yes)
(or	(population >= max-pop)
	(strategic-number skirmsarchers >= 1))
=>
	(set-goal champgoal yes)); end jump

(defrule
	(civ-selected japanese)
	(goal champgoal yes)
	(current-age <= castle-age)
(or	(goal uugoal yes)
(or	(building-type-count-total castle >= 1)
	(stone-amount >= castle-stone)))
=>
	(set-goal champgoal no))

#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if

;;#load-if-not-defined INCAN-CIV
;;#load-if-not-defined INDIAN-CIV
;;#load-if-not-defined ITALIAN-CIV
;#load-if-not-defined MAGYAR-CIV
;#load-if-not-defined SLAVIC-CIV
;;#load-if-not-defined AZTEC-CIV
;#load-if-not-defined BRITON-CIV
;#load-if-not-defined BYZANTINE-CIV
;#load-if-not-defined CELTIC-CIV
;#load-if-not-defined CHINESE-CIV
;#load-if-not-defined FRANKISH-CIV
;;#load-if-not-defined GOTH-CIV
;#load-if-not-defined HUN-CIV
;#load-if-not-defined JAPANESE-CIV
;;#load-if-not-defined KOREAN-CIV
;#load-if-not-defined MONGOL-CIV
;;#load-if-not-defined MAYAN-CIV
;#load-if-not-defined PERSIAN-CIV
;;#load-if-not-defined SARACEN-CIV
;#load-if-not-defined SPANISH-CIV
;#load-if-not-defined TEUTONIC-CIV
;#load-if-not-defined TURKISH-CIV; others krush or flush
;#load-if-not-defined VIKING-CIV; Incan, Mayan, Aztec, Indian, Italian, Korean, Gothic, Saracen
(defrule
(or	(up-compare-goal enemy-goal2 != klew)
;(or	(up-compare-goal milunits != yes)
	(goal strategy krush));)
=>
	(up-jump-rule 1))
(defrule
	(strategic-number sn-military-superiority <= 0)
(or	(unit-type-count-total militiaman-line < 7)
	(strategic-number sn-military-superiority <= -1))
(or	(strategic-number sn-current-age >= fcastlea)
	(food-amount < castle-f2))
=>
; bmbr	(up-modify-goal maa-var c:max yes)
	(set-goal trainchamp yes))
;#end-if
;#end-if
;#end-if
;#end-if
;#end-if
;#end-if
;#end-if
;#end-if
;#end-if
;#end-if
;#end-if
;#end-if
;#end-if
;#end-if
;#end-if
;#end-if
;#end-if
;#end-if
;#end-if
;#end-if
;#end-if
;#end-if
;#end-if

;#load-if-not-defined INCAN-CIV
#load-if-not-defined INDIAN-CIV
;#load-if-not-defined ITALIAN-CIV
#load-if-not-defined MAGYAR-CIV
#load-if-not-defined SLAVIC-CIV
;#load-if-not-defined AZTEC-CIV
;#load-if-not-defined BRITON-CIV
#load-if-not-defined BYZANTINE-CIV
;#load-if-not-defined CELTIC-CIV
;#load-if-not-defined CHINESE-CIV
#load-if-not-defined FRANKISH-CIV
;#load-if-not-defined GOTH-CIV
#load-if-not-defined HUN-CIV
;#load-if-not-defined JAPANESE-CIV
;#load-if-not-defined KOREAN-CIV
#load-if-not-defined MONGOL-CIV
#load-if-not-defined MAYAN-CIV
#load-if-not-defined PERSIAN-CIV
;#load-if-not-defined SARACEN-CIV
#load-if-not-defined SPANISH-CIV
;#load-if-not-defined TEUTONIC-CIV
;#load-if-not-defined TURKISH-CIV
;#load-if-not-defined VIKING-CIV; Incas, Italians, Aztecs, Britons, Celts, Chinese, Goths, Japanese, Koreans, Saracens, Teutons, Turks, Vikings

(defrule
(or	(unit-type-count-total janissary-line >= 7)
(or	(unit-type-count-total samurai-line >= 7)
(or	(unit-type-count-total teutonic-knight-line >= 5)
(or	(unit-type-count-total woad-raider-line >= 7)
(or	(unit-type-count-total throwing-axeman-line >= 7)
(or	(unit-type-count-total berserk-line >= 7)
(or	(unit-type-count-total jaguar-man-line >= 5)
	(unit-type-count-total mameluke-line >= 6))))))))
=>
	(up-jump-rule 1))
(defrule; eagle counters for the ones who may need it
	(goal milunits yes)
	(goal palagoal no)
	(strategic-number sn-current-age >= imperial)
	(players-current-age focus-player >= imperial-age)
	(players-unit-type-count focus-player eagle-warrior-line >= 10)
	(up-research-status c: ri-two-handed-swordsman >= research-pending)
	(strategic-number sn-military-superiority <= 0)
	(players-unit-type-count focus-player eagle-warrior-line g:> champcount)
	(strategic-number archers < 30)
	(players-unit-type-count focus-player jaguar-man-line < 6)
=>
	(set-goal trainchamp yes))

#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
;#end-if
;#end-if
;#end-if
;#end-if
;#end-if
;#end-if
;#end-if
;#end-if
;#end-if
;#end-if
;#end-if
;#end-if
;#end-if

(defrule
	(goal milunits yes)
	(goal enemy-goal drush)
	(strategic-number sn-current-age == dark)
	(players-military-population focus-player >= 3)
(or	(food-amount >= 560)
	(and	(strategic-number sn-current-age >= dfeudal)
		(building-type-count archery-range <= 0)))
	(unit-type-count-total militiaman-line < 3); 5
=>
	(set-goal trainchamp yes))
;=========================================================
;(defrule; early nomad scout
;(or	(up-compare-goal nomad != no)
;	(up-compare-goal landnomad != no))
;	(goal underattack no)
;	(goal defend no)
;	(military-population <= 0)
;(or	(food-amount >= 560)
;	(strategic-number sn-current-age >= dfeudal))
;=>
;	(set-goal trainchamp yes)
;	(disable-self))
;=========================================================
#load-if-defined DEATH-MATCH
#load-if-defined DARK-AGE-START
(defrule
	(strategic-number sn-current-age < castlea)
	(strategic-number sn-military-superiority <= 0)
=>
	(set-goal trainchamp yes))
#end-if
#end-if
;=========================================================
; No gold left ; Trash war
;=========================================================
;(defrule
;	(goal milunits yes)
;	(cc-players-unit-type-count 0 gold-mine < 3)
;	(buildint-type-count-total blacksmith >= 1)
;	(gold-amount < 200)
;(or	(research-completed ri-champion)
;	(food-amount > 750))
;(or	(food-amount > 500)
;(or	(strategic-number sn-military-superiority <= -2)
;	(strategic-number spears < 30)))
;=>
;	(set-goal trainhussar yes))
;(defrule
;	(goal milunits yes)
;	(cc-players-unit-type-count 0 gold-mine < 3)
;	(buildint-type-count-total blacksmith >= 1)
;	(gold-amount < 200)
;	(wood-amount < 200)
;	(food-amount > 1000)
;	(strategic-number spears < 45)
;=>
;	(set-goal trainhussar yes))
(defrule
	(goal milunits yes)
(or	(up-compare-goal tradeunits < 19)
	(cc-players-unit-type-count 0 tree-class < 125))
(or	(cc-players-unit-type-count 0 gold-mine < 4)
	(cc-players-unit-type-count 0 tree-class < 125))
	(strategic-number sn-current-age >= imperial);	(building-type-count-total blacksmith >= 1)
	(gold-amount < 150)
	(wood-amount < 100)
	(food-amount >= 130)
	(strategic-number spears < 45)
	(strategic-number camels < 42)
=>
	(set-goal trainhussar yes))
(defrule
	(goal milunits yes)
	(up-compare-goal tradeunits < 9)
(not	(player-in-game any-ally))
	(cc-players-unit-type-count 0 gold-mine < 8)
	(up-gaia-type-count c: gold <= 4)
	(strategic-number sn-current-age >= imperial);	(building-type-count-total blacksmith >= 1)
	(food-amount >= 600)
	(commodity-selling-price food < 30)
	(gold-amount < 200)
	(strategic-number spears < 33)
	(strategic-number camels < 30)
=>
	(set-goal trainhussar yes))
(defrule
	(goal milunits yes)
	(up-compare-goal tradeunits < 19)
	(cc-players-unit-type-count 0 gold-mine < 4)
	(strategic-number sn-current-age >= imperial);	(building-type-count-total blacksmith >= 1)
	(wood-amount > 100)
	(food-amount >= sk-buffer-f)
	(gold-amount < 200)
=>
	(set-goal trainskirm yes))
(defrule
	(goal milunits yes)
	(up-compare-goal tradeunits < 9)
(not	(player-in-game any-ally))
	(cc-players-unit-type-count 0 gold-mine < 8)
	(up-gaia-type-count c: gold <= 4)
	(strategic-number sn-current-age >= imperial);	(building-type-count-total blacksmith >= 1)
	(wood-amount >= 600)
	(food-amount >= 600)
(or	(commodity-selling-price wood < 30)
	(commodity-selling-price food < 30))
	(gold-amount < 200)
=>
	(set-goal trainskirm yes))
(defrule
	(goal milunits yes)
	(up-compare-goal tradeunits < 19)
	(cc-players-unit-type-count 0 gold-mine < 4)
	(strategic-number sn-current-age >= imperial);	(building-type-count-total blacksmith >= 1)
	(wood-amount > 100)
	(food-amount >= pk-buffer-f)
	(gold-amount < 200)
=>
	(set-goal trainpike yes))
(defrule
	(goal milunits yes)
	(up-compare-goal tradeunits < 9)
(not	(player-in-game any-ally))
	(cc-players-unit-type-count 0 gold-mine < 8)
	(up-gaia-type-count c: gold <= 4)
	(strategic-number sn-current-age >= imperial);	(building-type-count-total blacksmith >= 1)
	(wood-amount >= 600)
	(food-amount >= 600)
(or	(commodity-selling-price wood < 30)
	(commodity-selling-price food < 30))
	(gold-amount < 200)
=>
	(set-goal trainpike yes))
(defrule
	(goal milunits yes)
(or	(players-unit-type-count focus-player spearman-line > 39)
	(strategic-number skirms > 39))
	(strategic-number archers < 25)
	(cc-players-unit-type-count 0 gold-mine < 4)
(or	(up-compare-goal tradeunits < 19)
	(cc-players-unit-type-count 0 tree-class < 125))
;(or	(unit-type-count-total militiaman-line < 6)
	(up-research-status c: ri-champion >= research-pending);)
=>
	(set-goal trainchamp yes))
;=========================================================
; Wololo
;=========================================================
#load-if-defined UP-GAME-WK
(defrule
(or	(players-unit-type-count focus-player teutonic-knight-line >= 12)
	(players-unit-type-count focus-player samurai-line >= 12))
=>
	(up-jump-rule 2))
(defrule
	(strategic-number gunpowder >= 7);(players-unit-type-count focus-player hand-cannoneer >= 7)
	(up-compare-goal excessGold >= 225)
(or	(goal champgoal yes)
(or	(civ-selected aztec)
(or	(civ-selected incan)
(or	(civ-selected japanese)
(or	(civ-selected viking)
	(civ-selected malay))))))
	(unit-type-count-total condottiero < 36)
	(unit-type-count-total 882 < 36)
=>
	(set-goal traincondo yes))
(defrule
	(strategic-number gunpowder >= 7);(players-unit-type-count focus-player hand-cannoneer >= 7)
	(up-compare-goal excessGold >= 225)
(or	(civ-selected malian)
(or	(civ-selected malay)
;(or	(unit-type-count-total karambit-warrior >= 5)
;(or	(unit-type-count-total elite-karambit-warrior >= 5)
(or	(unit-type-count-total shotel-warrior >= 5)
(or	(unit-type-count-total elite-shotel-warrior >= 5)
(or	(unit-type-count-total teutonic-knight-line >= 5)
	(civ-selected gothic))))));))
	(unit-type-count-total condottiero < 36)
	(unit-type-count-total 882 < 36)
=>
	(set-goal traincondo yes)); end jump
;=========================================================
(defrule
(or	(up-compare-goal battle-elephant-set >= Promi)
(or	(strategic-number moenche >= 10)
(or	(strategic-number spears >= 24)
(or	(players-unit-type-count focus-player genoese-crossbowman >= 24)
(or	(players-unit-type-count focus-player elite-genoese-crossbowman >= 24)
(or	(strategic-number sn-military-superiority >= 2)
	(strategic-number sn-current-age < imperial)))))))
=>
	(up-jump-rule 1))
(defrule
(or	(and	(goal uugoal no)
		(and	(goal palagoal no)
			(goal champgoal no)))
(or	(strategic-number sn-military-superiority <= -2)
(or	(up-research-status c: ri-elite-battle-elephant >= research-pending)
(or	(up-research-status c: ri-howdah >= research-pending)
(or	(up-research-status c: ri-tusk-swords >= research-pending)
	(up-research-status c: ri-chatras >= research-pending))))))
=>
	(set-goal trainbattle yes))
;=========================================================
(defrule
(or	(and	(up-research-status c: ri-imperial-skirmisher >= research-pending)
		(or	(up-research-status c: ri-elite-genitour < research-pending)
			(or	(up-research-status c: ri-bloodlines < research-pending)
				(up-research-status c: ri-husbandry < research-pending))))
(or	(up-research-status c: ri-yeomen >= research-pending)
(or	(strategic-number camels >= 12)
(or	(players-unit-type-count focus-player genoese-crossbowman >= 8)
	(strategic-number spears >= 24)))))
=>
	(up-jump-rule 1))
(defrule
	(goal trainskirm yes)
	(current-age >= castle-age)
(or	(up-research-status c: ri-elite-genitour >= research-pending)
(or	(up-research-status c: ri-sipahi >= research-available)
(or	(up-research-status c: ri-elite-skirmisher <= research-unavailable)
	(and	(up-research-status c: ri-elite-genitour >= research-available)
		(and	(up-research-status c: ri-bloodlines >= research-available)
			(up-research-status c: ri-husbandry >= research-available))))))
	(unit-available genitour)
=>
	(set-goal trainskirm no)
	(set-goal traingenitour yes)); end jump
;=========================================================
#load-if-defined PORTUGUESE-CIV
(defrule
	(goal fleet yes)
	(goal enemy-boats yes)
(or	(dropsite-min-distance wood < 5)
	(wood-amount >= 110))
;(or	(civilian-population >= up-max-civ)
(or	(population >= max-civ-pop)
	(wood-amount >= farmcamp-cost));)
(or	(goal dreitc yes)
	(wood-amount >= 295))
(or	(goal siegereq yes)
	(unit-type-count-total cannon-galleon-line >= 4))
	(up-compare-goal navycount g:< maxnavy)
=>
	(set-goal traincaravel yes))
#end-if
;=========================================================
#load-if-defined ETHIOPIAN-CIV
(defrule
	(goal milunits yes)
	(goal uugoal no)
	(strategic-number skirms < 40)
	(strategic-number siege < 15)
	(up-compare-goal excessGold >= 250)
=>
	(set-goal trainarcher yes))
#end-if
;=========================================================
#load-if-defined INCAN-CIV
(defrule
	(unit-available slinger)
(or	(goal trainarcher yes)
(or	(strategic-number husks >= 10)
	(strategic-number eagles >= 10)))
	(up-compare-goal strategy != a-rush)
(or	(strategic-number infantry >= 10)
(or	(strategic-number husks >= 10)
	(strategic-number eagles >= 10)))
	(current-age >= castle-age)
=>
	(set-goal trainarcher no)
	(set-goal trainslinger yes))
#end-if
;=========================================================
#load-if-defined INDIAN-CIV
(defrule
	(goal milunits yes)
	(goal uugoal no)
	(strategic-number spears < 40)
	(strategic-number moenche < 15)
	(food-amount >= cm-buffer-f)
	(up-compare-goal excessGold >= 250)
=>
	(set-goal traincamel yes))
#end-if
;=========================================================
#load-if-defined KHMER-CIV
(defrule
	(unit-available scorpion-line)
(or	(goal trainmangonel yes)
	(and	(up-compare-goal excessGold >= 250)
		(and	(goal uugoal no)
			(goal milunits yes))))
(or	(up-compare-goal mangonel-set >= 2)
	(up-research-status c: imperial-age >= research-pending))
	(up-compare-goal mangonel-set < 12)
	(unit-type-count-total scorpion-line < 24)
	(current-age >= castle-age)
=>
	(set-goal trainmangonel no)
	(set-goal trainscorpion yes))
#end-if
#end-if
;=========================================================
; Age Ends
;=========================================================
#load-if-defined DARK-AGE-END
(defrule
	(goal milunits yes)
(nor	(strategic-number archers >= 25)
(or	(strategic-number cavalry >= 40)
(or	(strategic-number moenche >= 10)
(or	(strategic-number gunpowder >= 25)
	(players-unit-type-count focus-player teutonic-knight-line > 13)))))
	(strategic-number sn-current-age >= imperial)
	(unit-type-count-total my-unique-unit-line < 30)
;	(unit-type-count-total militiaman-line < 90)
=>
	(set-goal trainchamp yes))
#end-if
#load-if-defined FEUDAL-AGE-END
(defrule
	(goal milunits yes)
(nor	(strategic-number archers >= 25)
(or	(strategic-number cavalry >= 40)
(or	(strategic-number moenche >= 10)
(or	(strategic-number gunpowder >= 25)
	(players-unit-type-count focus-player teutonic-knight-line > 13)))))
	(strategic-number sn-current-age >= imperial)
	(unit-type-count-total my-unique-unit-line < 30)
;	(unit-type-count-total militiaman-line < 90)
=>
	(set-goal trainchamp yes))
#end-if
#load-if-defined CASTLE-AGE-END
(defrule
	(goal milunits yes)
(or	(population < max-civ-pop)
	(strategic-number sn-military-superiority <= -1))
	(strategic-number sn-current-age >= imperial)
=>
	(set-goal trainknight yes)
	(set-goal traineagle yes))
#end-if
;=========================================================
; M@a-var.
;=========================================================
(defrule
	(up-compare-goal maa-var != yes)
=>
	(up-jump-rule 2))
(defrule
(or	(up-research-status c: castle-age >= research-pending)
(or	(up-research-status c: feudal-age < research-pending)
(or	(up-compare-goal strategy-type != feudal-war)
(or	(and	(up-research-status c: feudal-age == research-pending)
		(food-amount < maa-buffer-f2))
;	(and
	(food-amount < maa-buffer-f)
;		(up-research-status c: ri-wheelbarrow != research-pending))
))))
=>
	(up-jump-rule 1))
(defrule
(or	(current-age >= feudal-age)
	(not	(civ-selected gothic)))
(or	(up-research-status c: ri-man-at-arms != research-available)
(or	(and	(food-amount >= maa-buffer-f2)
		(gold-amount >= maa-buffer-g))
	(unit-type-count-total militiaman-line < 0))); 3
	(unit-type-count-total militiaman-line < 12)
	(can-train militiaman-line)
=>
	(train militiaman-line))
;=========================================================
; R-Flush.
;=========================================================
(defrule
	(up-compare-goal milunits != r-flush)
=>
	(up-jump-rule 33))
(defrule; this rule is pretty pointless 11
(or	(and	(dropsite-min-distance wood > 4); 5
		(wood-amount < 120)); 100
	(and	(current-age >= castle-age)
		(and	(wood-amount < 200)
			(building-type-count-total siege-workshop <= 0))))
=>
	(up-jump-rule 2))
;=========================================================
(defrule
;	(goal milunits r-flush)
(or	(military-population >= 25); 26
(or	(strategic-number sn-military-superiority >= 1)
(or	(goal attacking yes)
	(goal researchplan yes))))
(or	(goal underattack no)
	(strategic-number sn-military-superiority >= 0))
	(strategic-number sn-military-superiority >= -1)
	(unit-type-count-total battering-ram-line < 4)
=>
	(set-goal trainram yes))
;=========================================================
(defrule
;	(goal milunits r-flush)
(or	(strategic-number skirmsarchers >= 10)
(or	(players-unit-type-count focus-player battering-ram-line >= 1)
(or	(players-unit-type-count focus-player scorpion-line >= 1)
	(players-unit-type-count focus-player mangonel-line >= 1))))
	(up-compare-goal mangonel-set < 2)
=>
	(set-goal trainmangonel yes))
;=========================================================
(defrule ; not very likely to fire (either no res or no stable) but better than nothing
;	(goal milunits r-flush)
	(strategic-number moenche < 10)
(or	(players-unit-type-count focus-player scorpion-line >= 1)
	(players-unit-type-count focus-player mangonel-line >= 1))
	(unit-type-count-total knight-line < 4)
=>
	(set-goal trainknight yes))
;=========================================================
(defrule
(or	(and	(up-pending-objects c: lumber-camp <= 0)
		(and	(dropsite-min-distance wood > 4); 5
			(wood-amount < pk-buffer-wc)))
	(and	(current-age >= castle-age)
		(and	(wood-amount < 225)
			(building-type-count-total siege-workshop <= 0))))
=>
	(up-jump-rule 9))
(defrule
(or	(goal allowspears no)
	(and	(building-type-count-total mining-camp <= 0)
		(and	(unit-type-count villager-gold >= 1)
			(and	(dropsite-min-distance gold > 5)
				(wood-amount < pk-buffer-wc)))))
=>
	(up-jump-rule 8))
(defrule
	(building-type-count-total farm g:< maxfarms)
	(wood-amount < pk-buffer-w)
(or	(and	(strategic-number sn-military-superiority >= 0); JUST TESTING
		(and	(military-population >= 5)
			(up-compare-sn sn-current-age g:<= enemyState))); <
(or	(and	(unit-type-count villager-food < 7)
		(building-type-count-total farm < 7))
	(and	(idle-farm-count <= 0)
		(strategic-number sn-military-superiority >= 2))))
=>
	(up-jump-rule 7)); one less
(defrule
;	(goal milunits r-flush)
	(strategic-number sn-military-superiority < 4)
;(or	(food-amount >= pk-buffer-fl)
;	(up-research-status c: ri-fletching >= research-pending))
(or	(food-amount >= pk-buffer-f); 70
	(up-pending-objects c: villager >= 2))
(or	(and	(strategic-number cavalry >= 3)
		(unit-type-count-total spearman-line < 4)); 6
	(and	(players-building-type-count focus-player stable >= 1)
		(unit-type-count-total spearman-line < 3)))
=>
	(set-goal trainpike yes))
(defrule
;	(goal milunits r-flush)
	(strategic-number sn-military-superiority < 4)
;(or	(food-amount >= pk-buffer-fl)
;	(up-research-status c: ri-fletching >= research-pending))
(or	(food-amount >= pk-buffer-f); 70
	(up-pending-objects c: villager >= 2))
(or	(and	(strategic-number cavalry >= 5)
		(unit-type-count-total spearman-line < 6)); 9
	(and	(strategic-number cavalry >= 7)
		(unit-type-count-total spearman-line < 8))); 12
=>
	(set-goal trainpike yes))
(defrule
;	(goal milunits r-flush)
	(strategic-number sn-military-superiority < 4)
;(or	(food-amount >= pk-buffer-fl)
;	(up-research-status c: ri-fletching >= research-pending))
(or	(food-amount >= pk-buffer-f); 70
	(up-pending-objects c: villager >= 2))
(or	(and	(strategic-number cavalry >= 10)
		(unit-type-count-total spearman-line < 12)); 15
	(and	(strategic-number cavalry >= 14)
		(unit-type-count-total spearman-line < 16)))
=>
	(set-goal trainpike yes))
(defrule
;	(goal milunits r-flush)
	(up-building-type-in-town c: watch-tower >= 1)
(or	(strategic-number sn-maximum-town-size <= 33)
	(and	(strategic-number archers < 3)
		(up-building-type-in-town c: watch-tower >= 1)))
	(unit-type-count-total spearman-line < 4)
=>
	(set-goal trainpike yes))
(defrule
;	(goal milunits r-flush)
(or	(up-unit-type-in-town c: knight-line >= 1)
(or	(strategic-number cavalry >= 2)
	(and	(up-compare-goal ep-stables >= 1);	(players-building-type-count any-enemy stable >= 1); test
		(up-compare-goal ep-mpop >= 2))))
;(or	(up-unit-type-in-town c: knight-line >= 1)
;(or	(players-unit-type-count focus-player scout-cavalry-line >= 2)
;(or	(players-unit-type-count any-enemy camel-line >= 1)
;	(players-unit-type-count any-enemy knight-line >= 1)))); 2
;(or	(food-amount >= pk-buffer-fl)
;	(up-research-status c: ri-fletching >= research-pending))
(or	(food-amount >= pk-buffer-f)
(or	(up-research-status c: ri-wheel-barrow == research-pending)
	(up-pending-objects c: villager >= 2)))
	(unit-type-count-total spearman-line < 6); 3
=>
	(set-goal trainpike yes))
(defrule
;	(goal milunits r-flush)
	(goal sk-var yes)
;(or	(food-amount >= pk-buffer-fl)
;	(up-research-status c: ri-fletching >= research-pending))
(or	(food-amount >= pk-buffer-f)
(or	(up-research-status c: ri-wheel-barrow == research-pending)
	(up-pending-objects c: villager >= 2)))
	(unit-type-count-total spearman-line < 6); 3
(or	(and	(up-compare-goal ep-stables >= 1);	(players-building-type-count any-enemy stable >= 1); test
		(up-compare-goal ep-mpop >= 2))
;(or	(players-current-age any-enemy >= castle-age)
	(military-population >= 18));); 14
=>
	(set-goal trainpike yes))
(defrule
;	(goal milunits r-flush)
	(goal sk-var yes)
;(or	(food-amount >= pk-buffer-fl)
;	(up-research-status c: ri-fletching >= research-pending))
(or	(food-amount >= pk-buffer-f)
(or	(up-research-status c: ri-wheel-barrow == research-pending)
	(up-pending-objects c: villager >= 2)))
	(unit-type-count-total spearman-line < 9); 6
(or	(players-building-type-count focus-player stable >= 1); target
(or	(strategic-number cavalry >= 2)
	(military-population >= 30))); for now
=>
	(set-goal trainpike yes))
;=========================================================
(defrule
	(up-research-status c: castle-age == research-pending)
	(strategic-number sn-military-superiority >= 0); 1
	(gold-amount < 380)
(or	(unit-type-count-total skirmisher-line >= 9)
	(gold-amount < 220))
=>
	(up-jump-rule 7))
(defrule
	(building-available siege-workshop)
(or	(and	(wood-amount < 225)
		(building-type-count-total siege-workshop <= 0))
	(and	(building-type-count-total siege-workshop >= 1)
		(and	(strategic-number sn-military-superiority >= 1)
			(and	(unit-type-count-total battering-ram-line <= 1); 0
				(and	(wood-amount < 180)
					(gold-amount < 120))))))
=>
	(up-jump-rule 6))
(defrule
(or	(goal sk-var yes)
(or	(and	(up-pending-objects c: lumber-camp <= 0)
		(and	(dropsite-min-distance wood > 4); 5
			(wood-amount < ar-buffer-wc)))
	(and	(current-age >= castle-age)
		(and	(wood-amount < 225)
			(building-type-count-total siege-workshop <= 0)))))
=>
	(up-jump-rule 5))
(defrule
(or	(and	(research-available castle-age)
		(and	(up-compare-goal total-food-amount >= 450)
			(gold-amount < ar-buffer-g2)))
	(and	(building-type-count-total mining-camp <= 0)
		(and	(unit-type-count villager-gold >= 1)
			(and	(dropsite-min-distance gold > 5)
				(wood-amount < ar-buffer-wc)))))
=>
	(up-jump-rule 4))
(defrule
	(building-type-count-total farm g:< maxfarms)
	(wood-amount < ar-buffer-w)
(or	(and	(strategic-number sn-military-superiority >= 0); JUST TESTING
		(and	(military-population >= 5)
			(up-compare-sn sn-current-age g:<= enemyState))); <
(or	(and	(unit-type-count villager-food < 7)
		(building-type-count-total farm < 7))
	(and	(idle-farm-count <= 0)
		(strategic-number sn-military-superiority >= 2))))
=>
	(up-jump-rule 3))
(defrule
	(unit-available monk)
	(building-type-count monastery >= 1)
	(strategic-number sn-military-superiority >= 2)
	(unit-type-count-total monk <= 0)
	(unit-type-count 134 <= 0); dead monk
	(gold-amount < 100)
	(housing-headroom >= 1)
=>
	(up-jump-rule 2))
(defrule
;	(goal milunits r-flush)
	(strategic-number sn-military-superiority < 3); 4
(or	(and	(and	(unit-type-count-total archery-class < 3)
			(unit-type-count-total cavalry-archer-class < 3));	(military-population < 3); 5
		(up-research-status c: ri-loom >= research-pending))
(or	(building-type-count-total blacksmith <= 0);(military-population < 5)
(or	(gold-amount >= ar-buffer-g)
	(up-research-status c: ri-fletching >= research-pending))))
(or	(up-research-status c: castle-age < research-pending);(current-age < castle-age)
	(strategic-number sn-military-superiority < 0)); 3
=>
	(set-goal trainarcher yes))
(defrule
;	(goal milunits r-flush)
	(strategic-number sn-military-superiority < 3); 4
(or	(and	(or	(building-type-count-total blacksmith <= 0);(military-population < 5)
			(up-research-status c: ri-bodkin-arrow >= research-pending))
		(gold-amount >= 120))
(or	(gold-amount >= 220)
(or	(strategic-number sn-military-superiority < 0)
	(and	(up-research-status c: ri-bodkin-arrow >= research-pending)
		(up-research-status c: ri-crossbow >= research-pending)))))
	(up-research-status c: castle-age >= research-pending);(current-age >= castle-age)
=>
	(set-goal trainarcher yes))
;=========================================================
(defrule
	(up-research-status c: castle-age == research-pending)
	(strategic-number sn-military-superiority >= 1)
	(wood-amount < 285)
=>
	(up-jump-rule 9))
(defrule
(or	(and	(up-pending-objects c: lumber-camp <= 0)
		(and	(dropsite-min-distance wood > 4); 5
			(wood-amount < sk-buffer-wc)))
	(and	(current-age >= castle-age)
		(and	(wood-amount < 235)
			(building-type-count-total siege-workshop <= 0))))
=>
	(up-jump-rule 8))
(defrule
	(and	(building-type-count-total mining-camp <= 0)
		(and	(unit-type-count villager-gold >= 1)
			(and	(dropsite-min-distance gold > 5)
				(wood-amount < sk-buffer-wc))))
=>
	(up-jump-rule 7))
(defrule
	(building-type-count-total farm g:< maxfarms)
	(wood-amount < sk-buffer-w)
(or	(and	(strategic-number sn-military-superiority >= 0); JUST TESTING
		(and	(military-population >= 5)
			(up-compare-sn sn-current-age g:<= enemyState))); <
(or	(and	(unit-type-count villager-food < 7)
		(building-type-count-total farm < 7))
	(and	(idle-farm-count <= 0)
		(strategic-number sn-military-superiority >= 2))))
=>
	(up-jump-rule 6))
(defrule
	(up-research-status c: ri-fletching >= research-complete)
	(unit-type-count-total archery-class >= 9)
(or	(goal attacking yes)
	(strategic-number sn-military-superiority >= 0)); 1
	(food-amount < sk-buffer-f)
	(up-research-status c: ri-padded-archer-armor == research-available)
=>
	(up-jump-rule 5))
(defrule
;	(goal milunits r-flush)
	(strategic-number sn-military-superiority < 2); 4; 3
(or	(building-type-count-total blacksmith <= 0);(military-population < 5)
(or	(food-amount >= sk-buffer-f)
	(up-research-status c: ri-fletching >= research-pending)))
(or	(food-amount >= sk-buffer-f)
	(up-pending-objects c: villager >= 2))
	(gold-amount < archer-g)
(or	(up-research-status c: castle-age < research-pending);(current-age < castle-age)
	(strategic-number sn-military-superiority < 2))
=>
	(set-goal trainskirm yes))
(defrule
;	(goal milunits r-flush)
	(strategic-number sn-military-superiority < 2); 4; 3
	(up-research-status c: ri-fletching < research-pending)
	(gold-amount < ar-buffer-g)
	(food-amount >= sk-buffer-f)
	(building-type-count-total blacksmith >= 1)
;	(up-research-status c: ri-padded-archer-armor >= research-pending)
(or	(food-amount >= sk-buffer-f)
	(up-pending-objects c: villager >= 2))
(or	(current-age < castle-age)
	(strategic-number sn-military-superiority < 0)); 2
=>
	(set-goal trainskirm yes))
(defrule
;	(goal milunits r-flush)
	(strategic-number sn-military-superiority < 3); 4
(or	(strategic-number sn-military-superiority < 0)
(or	(building-type-count-total siege-workshop <= 0)
(or	(unit-type-count-total battering-ram-line >= 2)
	(wood-amount >= 205))))
(or	(food-amount >= sk-buffer-f)
	(up-pending-objects c: villager >= 6)); 2
(or	(food-amount >= 225)
	(up-research-status c: ri-bodkin-arrow >= research-pending))
	(up-research-status c: castle-age >= research-pending);(current-age >= castle-age)
=>
	(set-goal trainskirm yes))
(defrule
(or	(strategic-number sn-military-superiority >= 3); 4
	(and	(strategic-number sn-gold-gatherer-percentage >= 1)
		(and	(building-type-count-total mining-camp <= 0)
			(and	(dropsite-min-distance gold > 5)
				(wood-amount < sk-buffer-wc)))))
=>
	(up-jump-rule 1))
(defrule
;	(goal milunits r-flush)
	(goal sk-var yes)
(or	(military-population < 5); 3
(or	(strategic-number sn-military-superiority <= -1); test
(or	(food-amount >= sk-buffer-f)
(or	(building-type-count-total blacksmith <= 0)
	(up-research-status c: ri-fletching >= research-pending)))))
(or	(food-amount >= sk-buffer-f)
(or	(up-research-status c: ri-wheel-barrow == research-pending)
	(up-pending-objects c: villager >= 2)))
=>
	(set-goal trainskirm yes))
;=========================================================
; S-Flush.
;=========================================================
(defrule
	(goal scoutmicro yes)
(or	(goal milunits s-flush)
	(and	(current-age <= feudal-age)
		(current-age-time < 320)))
	(military-population <= 5)
	(unit-type-count-total scout-cavalry-line < 5)
(or	(unit-type-count-total 449 < 1); dead scouts
	(current-age-time < 160))
=>
	(set-goal trainhussar yes))
;=========================================================
; A-Rush.
;=========================================================
(defrule
(or	(up-research-status c: castle-age < research-pending)
(or	(up-compare-goal milunits != a-rush)
(or	(and	(strategic-number sn-military-superiority >= 3); 2
		(and	(current-age >= castle-age)
			(and	(wood-amount < 200)
				(building-type-count-total siege-workshop <= 0))))
	(and	(dropsite-min-distance wood > 4); 5
		(wood-amount < 100)))))
=>
	(up-jump-rule 20))
;=========================================================
(defrule
(or	(military-population >= 25)
(or	(strategic-number sn-military-superiority >= 1)
(or	(goal attacking yes)
	(goal researchplan yes))))
(or	(goal underattack no)
	(strategic-number sn-military-superiority >= 0))
	(strategic-number sn-military-superiority >= -1)
	(unit-type-count-total battering-ram-line < 4)
=>
	(set-goal trainram yes))
;=========================================================
(defrule
(or	(strategic-number skirmsarchers >= 10)
(or	(players-unit-type-count focus-player battering-ram-line >= 1)
(or	(players-unit-type-count focus-player scorpion-line >= 1)
	(players-unit-type-count focus-player mangonel-line >= 1))))
	(up-compare-goal mangonel-set < 2)
=>
	(set-goal trainmangonel yes))
;=========================================================
(defrule ; not very likely to fire (either no res or no stable) but hey
	(strategic-number moenche < 10)
(or	(players-unit-type-count focus-player scorpion-line >= 1)
	(players-unit-type-count focus-player mangonel-line >= 1))
	(unit-type-count-total knight-line < 4)
=>
	(set-goal trainknight yes))
;=========================================================
(defrule
	(goal allowspears no)
=>
	(up-jump-rule 6))
(defrule
	(building-type-count-total farm g:< maxfarms)
	(wood-amount < pk-buffer-w)
(or	(and	(strategic-number sn-military-superiority >= 0); JUST TESTING
		(and	(military-population >= 5)
			(up-compare-sn sn-current-age g:< enemyState)))
(or	(and	(unit-type-count villager-food < 7)
		(building-type-count-total farm < 7))
	(and	(idle-farm-count <= 0)
		(strategic-number sn-military-superiority >= 2))))
=>
	(up-jump-rule 5))
(defrule
	(strategic-number sn-military-superiority < 4)
(or	(food-amount >= 235)
	(up-research-status c: ri-bodkin-arrow >= research-pending))
(or	(food-amount >= pk-buffer-f)
	(up-pending-objects c: villager >= 2))
(or	(strategic-number cavalry >= 3)
	(players-building-type-count target-player stable >= 2))
	(unit-type-count-total spearman-line < 6); 4
=>
	(set-goal trainpike yes))
(defrule
	(strategic-number sn-military-superiority < 4)
(or	(food-amount >= 235)
	(up-research-status c: ri-bodkin-arrow >= research-pending))
(or	(food-amount >= pk-buffer-f)
	(up-pending-objects c: villager >= 2))
(or	(and	(strategic-number cavalry >= 5)
		(unit-type-count-total spearman-line < 8)); 9
	(and	(strategic-number cavalry >= 7)
		(unit-type-count-total spearman-line < 10))); 12
=>
	(set-goal trainpike yes))
(defrule
	(strategic-number sn-military-superiority < 4)
(or	(food-amount >= 235)
	(up-research-status c: ri-bodkin-arrow >= research-pending))
(or	(food-amount >= pk-buffer-f)
	(up-pending-objects c: villager >= 2))
(or	(and	(strategic-number cavalry >= 9)
		(unit-type-count-total spearman-line < 12)); 15
	(and	(strategic-number cavalry >= 13)
		(unit-type-count-total spearman-line < 17)))
=>
	(set-goal trainpike yes))
(defrule
	(up-building-type-in-town c: watch-tower >= 1)
(or	(strategic-number sn-maximum-town-size <= 33)
	(and	(strategic-number archers < 3)
		(up-building-type-in-town c: watch-tower >= 1)))
	(unit-type-count-total spearman-line < 6); 4
=>
	(set-goal trainpike yes))
(defrule
(or	(up-unit-type-in-town c: knight-line >= 1)
	(players-unit-type-count any-enemy knight-line >= 2))
(or	(food-amount >= 135)
	(up-research-status c: ri-fletching >= research-pending))
(or	(food-amount >= pk-buffer-f)
	(up-pending-objects c: villager >= 2))
	(unit-type-count-total spearman-line < 6); 4
=>
	(set-goal trainpike yes))
;=========================================================
(defrule
	(building-type-count-total farm g:< maxfarms)
	(wood-amount < ar-buffer-w)
(or	(and	(strategic-number sn-military-superiority >= 0); JUST TESTING
		(and	(military-population >= 5)
			(up-compare-sn sn-current-age g:< enemyState)))
(or	(and	(unit-type-count villager-food < 7)
		(building-type-count-total farm < 7))
	(and	(idle-farm-count <= 0)
		(strategic-number sn-military-superiority >= 2))))
=>
	(up-jump-rule 3))
(defrule
	(strategic-number sn-military-superiority >= 2)
(or	(and	(wood-amount < 200)
		(building-type-count-total siege-workshop < 1))
	(and	(wood-amount < 185)
		(and	(gold-amount < 120)
			(unit-type-count-total battering-ram-line < 2))))
	(current-age >= castle-age)
=>
	(up-jump-rule 2))
(defrule
	(building-type-count monastery >= 1)
	(strategic-number sn-military-superiority >= 2)
	(unit-type-count-total monk <= 0)
	(unit-type-count 134 <= 0); dead monk
	(gold-amount < 100)
	(housing-headroom >= 1)
=>
	(up-jump-rule 1))
(defrule
	(strategic-number sn-military-superiority < 3); 4
(or	(gold-amount >= 145)
	(and	(building-type-count siege-workshop <= 0)
		(current-age >= castle-age)))
;(or	(gold-amount >= 145); 220
;	(and	(up-research-status c: ri-crossbow < research-pending)
;		(up-research-status c: ri-bodkin-arrow >= research-pending)))
=>
	(set-goal trainarcher yes))
;=========================================================
(defrule
(or	(food-amount < 185)
(or	(and	(or	(food-amount < 360)
			(current-age <= feudal-age))
		(or	(up-research-status c: ri-bodkin-arrow < research-pending)
			(up-research-status c: ri-crossbow < research-pending)))
	(and	(strategic-number archers < 10)
		(food-amount < 300))))
=>
	(up-jump-rule 5))
(defrule
	(building-type-count-total farm g:< maxfarms)
	(wood-amount < sk-buffer-w)
(or	(and	(strategic-number sn-military-superiority >= 0); JUST TESTING
		(and	(military-population >= 5)
			(up-compare-sn sn-current-age g:< enemyState)))
(or	(and	(unit-type-count villager-food < 7)
		(building-type-count-total farm < 7))
	(and	(idle-farm-count <= 0)
		(strategic-number sn-military-superiority >= 2))))
=>
	(up-jump-rule 4))
(defrule
(or	(goal attacking yes)
	(strategic-number sn-military-superiority >= 1))
	(food-amount < 125)
	(research-available ri-padded-archer-armor)
	(up-research-status c: ri-padded-archer-armor < research-pending)
=>
	(up-jump-rule 3))
(defrule
	(strategic-number sn-military-superiority < 2); 4
(or	(food-amount >= 225)
	(up-research-status c: ri-bodkin-arrow >= research-pending))
(or	(food-amount >= sk-buffer-f)
	(up-pending-objects c: villager >= 2))
	(gold-amount < 45)
(or	(current-age < castle-age)
	(strategic-number sn-military-superiority <= 2))
=>
	(set-goal trainskirm yes))
(defrule
	(strategic-number sn-military-superiority < 2); 4
	(up-research-status c: ri-bodkin-arrow < research-pending)
	(gold-amount < 145)
	(food-amount >= 225)
	(building-type-count-total blacksmith >= 1)
;	(up-research-status c: ri-padded-archer-armor >= research-pending)
(or	(food-amount >= sk-buffer-f)
	(up-pending-objects c: villager >= 2))
(or	(current-age < castle-age)
	(strategic-number sn-military-superiority <= 2))
=>
	(set-goal trainskirm yes))
(defrule
	(strategic-number sn-military-superiority < 2); 4
(or	(wood-amount >= 235)
	(building-type-count-total siege-workshop >= 1))
(or	(food-amount >= sk-buffer-f)
	(up-pending-objects c: villager >= 2))
(or	(unit-type-count-total battering-ram-line >= 2)
	(wood-amount >= 195))
(or	(food-amount >= 225)
	(up-research-status c: ri-bodkin-arrow >= research-pending))
	(current-age >= castle-age)
=>
	(set-goal trainskirm yes))
;=========================================================
; Krush.
;=========================================================
(defrule
	(up-compare-goal strategy != krush)
=>
	(up-jump-rule 2))
(defrule
	(strategic-number sn-military-superiority < 3); 4
	(strategic-number cavalry >= 4)
	(unit-type-count-total camel-line < 15)
(or	(unit-type-count-total camel-line < 4)
(or	(and	(strategic-number cavalry >= 7)
		(unit-type-count-total camel-line < 7))
(or	(and	(strategic-number cavalry >= 10)
		(unit-type-count-total camel-line < 10))
	(strategic-number cavalry >= 15))))
=>
	(set-goal traincamel yes))
(defrule
	(strategic-number sn-military-superiority < 3); 4
;hm	(strategic-number teamsuperiority >= 0)
=>
	(set-goal trainknight yes))
;=========================================================
; CA-Rush.
;=========================================================
(defrule
(or	(up-compare-goal strategy != ca-rush)
	(and	(building-type-count-total mining-camp <= 0)
		(and	(unit-type-count villager-gold >= 1)
			(and	(dropsite-min-distance gold > 5)
				(wood-amount < ca-buffer-w)))))
=>
	(up-jump-rule 5))
(defrule
	(building-available siege-workshop)
(or	(and	(wood-amount < 225)
		(building-type-count-total siege-workshop <= 0))
	(and	(building-type-count-total siege-workshop >= 1)
		(and	(strategic-number sn-military-superiority >= 1)
			(and	(unit-type-count-total battering-ram-line <= 1); 0
				(and	(wood-amount < 190)
					(gold-amount < 128))))))
=>
	(up-jump-rule 4))
(defrule
(or	(and	(up-pending-objects c: lumber-camp <= 0)
		(and	(dropsite-min-distance wood > 4); 5
			(wood-amount < ca-buffer-w)))
	(and	(current-age >= castle-age)
		(and	(wood-amount < 225)
			(building-type-count-total siege-workshop <= 0))))
=>
	(up-jump-rule 3))
(defrule
	(building-type-count-total farm g:< maxfarms)
	(wood-amount < ca-buffer-w)
(or	(and	(strategic-number sn-military-superiority >= 0); JUST TESTING
		(and	(military-population >= 5)
			(up-compare-sn sn-current-age g:<= enemyState))); <
(or	(and	(unit-type-count villager-food < 7)
		(building-type-count-total farm < 7))
	(and	(idle-farm-count <= 0)
		(strategic-number sn-military-superiority >= 2))))
=>
	(up-jump-rule 2))
(defrule
	(unit-available monk)
	(building-type-count monastery >= 1)
	(strategic-number sn-military-superiority >= 2)
	(unit-type-count-total monk <= 0)
	(unit-type-count 134 <= 0); dead monk
	(gold-amount < 100)
	(housing-headroom >= 1)
=>
	(up-jump-rule 1))
(defrule
	(strategic-number sn-military-superiority < 3); 4
(or	(and	(and	(unit-type-count-total archery-class < 3)
			(unit-type-count-total cavalry-archer-class < 3));	(military-population < 3); 5
		(up-research-status c: ri-loom >= research-pending))
(or	(building-type-count-total blacksmith <= 0);(military-population < 5)
(or	(gold-amount >= ca-buffer-g)
	(up-research-status c: ri-fletching >= research-pending))))
=>
	(set-goal traincavarcher yes)); end jump
;=========================================================
; Castledrop.
;=========================================================
(defrule
	(up-compare-goal strategy == castledrop)
(or	(strategic-number sn-military-superiority < 3); 4
(or	(goal attacking yes)
	(up-compare-goal strategy-type <= castle-war)))
(or	(goal dreitc yes)
(or	(stone-amount < 100)
	(wood-amount >= uu-w-dtc))); 500
	(wood-amount >= unique-unit-wood)
	(food-amount >= unique-unit-food)
=>
	(set-goal trainunique yes))
;=========================================================
; Stonewall.
;=========================================================
(defrule
	(up-compare-goal strategy != stonewall)
=>
	(up-jump-rule 5)); 6
(defrule
	(strategic-number sn-current-age >= imperial)
(or	(wood-amount >= 400)
	(building-type-count-total barracks >= 6))
(or	(up-research-status c: ri-elite-eagle-warrior >= research-pending)
	(gold-amount >= 700))
	(unit-type-count-total trebuchet-set < 3)
=>
	(set-goal traintrebuchet yes))
;=========================================================
(defrule
	(strategic-number sn-current-age >= imperial)
(or	(wood-amount >= 350)
	(building-type-count-total barracks >= 6))
(or	(up-research-status c: ri-elite-eagle-warrior >= research-pending)
	(gold-amount >= 575))
	(strategic-number sn-military-superiority >= -2);
	(unit-type-count-total battering-ram-line < 6)
=>
	(set-goal trainram yes))
;=========================================================
(defrule
	(strategic-number sn-current-age >= imperial)
(or	(up-research-status c: ri-elite-eagle-warrior >= research-pending)
	(and	(food-amount >= 820)
		(gold-amount >= 550)))
(or	(gold-amount >= 75)
(or	(unit-type-count-total battering-ram-line >= 4)
	(unit-type-count-total trebuchet-set >= 2)))
=>
	(set-goal traineagle yes))
;=========================================================
(defrule; test
	(strategic-number sn-current-age >= imperial)
	(goal allowspears yes)
	(strategic-number moenche < 18)
(or	(up-research-status c: ri-elite-eagle-warrior >= research-pending)
	(food-amount >= 835))
	(strategic-number cavalry g:> spearcount)
	(population < del-civ-pop); higher priority on eew
	(unit-type-count-total spearman-line < 40)
=>
	(set-goal trainpike yes))
;=========================================================
;(defrule; similar working rule in monk section already
;	(up-research-status c: ri-elite-eagle-warrior < research-pending)
;	(strategic-number sn-current-age <= castlea)
;	(strategic-number archers < 22)
;	(players-unit-type-count every-enemy eagle-warrior-line < 15)
;	(players-unit-type-count every-enemy scout-cavalry-line < 12)
;(or	(gold-amount >= 200); 900; 600; 300
;	(up-compare-goal relic-count >= 4))
;	(up-compare-goal escrowing != imperial-age)
;	(players-military-population any-enemy >= 2)
;	(soldier-count < 16)
;	(unit-type-count-total monastery-class < 15)
;=>
;	(set-goal trainmonk yes))
;=========================================================
(defrule
(or	(goal trainmangonel yes)
	(goal trainscorpion yes))
(or	(up-compare-goal excessGold < 225)
(or	(population < max-civ-pop)
	(strategic-number sn-current-age < imperial)))
	(strategic-number archers < 48)
	(strategic-number gunpowder < 16)
	(strategic-number siege < 16)
=>
	(set-goal trainmangonel no)
	(set-goal trainscorpion no))
;=========================================================
; Grush.
;=========================================================
(defrule
(or	(up-compare-goal strategy != grush)
(or	(and	(dropsite-min-distance wood >= 4); 5
		(wood-amount < 110))
(or	(up-compare-goal navycount >= up-max-civ)
(or	(population >= max-civ-pop)
	(up-compare-goal navycount g:>= maxnavy)))))
=>
	(up-jump-rule 1))
(defrule
(nand	(up-research-status c: ri-fletching == research-available)
	(and	(up-compare-goal navycount >= 3)
		(and	(food-amount >= 100)
			(gold-amount < 80))))
(nand	(up-research-status c: ri-careening == research-available)
	(and	(up-compare-goal navycount >= 5)
		(and	(food-amount >= 250)
			(gold-amount < 150))))
=>
	(set-goal traingalley yes))
;=========================================================
; Deleting units.
;=========================================================
(defrule
	(game-time > 3600)
	(unit-type-count-total villager > min-number-vills)
(or	(unit-type-count-total villager > 70)
	(unit-type-count-total villager > up-max-civ))
(or	(dropsite-min-distance wood >= 255)
(or	(dropsite-min-distance wood <= -1)
	(and	(or	(building-type-count town-center >= 1)
			(building-type-count lumber-camp >= 1))
		(dropsite-min-distance wood >= 30))))
	(population >= del-civ-pop)
=>
	(delete-unit villager))
;=========================================================
(defrule
	(unit-type-count-total villager > min-number-vills); test
	(strategic-number sn-current-age >= imperial)
	(players-building-count target-player >= 1); test
;	(goal escrowing no); test
	(population >= del-civ-pop)
(or	(population >= max-pop)
(or	(up-compare-goal excessWood >= 6200)
(or	(up-compare-goal excessFood >= 6200)
	(up-compare-goal excessGold >= 6200))))
	(up-compare-goal excessWood >= 4600)
	(up-compare-goal excessFood >= 4600)
	(up-compare-goal excessGold >= 4600)
=>
	(delete-unit villager))
;=========================================================
(defrule
	(unit-type-count-total villager > res-vills-d)
	(strategic-number sn-current-age >= imperial)
	(players-building-count target-player >= 1); test
;	(goal escrowing no); test
	(population >= del-civ-pop)
	(up-compare-goal excessWood >= 4200)
	(up-compare-goal excessFood >= 4200)
	(up-compare-goal excessGold >= 4200)
=>
	(delete-unit villager))
(defrule
	(unit-type-count-total villager > res-vills-c)
	(strategic-number sn-current-age >= imperial)
	(players-building-count target-player >= 1); test
;	(goal escrowing no); test
	(population >= del-civ-pop)
	(up-compare-goal excessWood >= 3400)
	(up-compare-goal excessFood >= 3400)
	(up-compare-goal excessGold >= 3400)
=>
	(delete-unit villager))
(defrule
	(unit-type-count-total villager > res-vills-b)
	(strategic-number sn-current-age >= imperial)
	(players-building-count target-player >= 1); test
;	(goal escrowing no); test
	(population >= del-civ-pop)
	(up-compare-goal excessWood >= 2600)
	(up-compare-goal excessFood >= 2600)
	(up-compare-goal excessGold >= 2600)
=>
	(delete-unit villager))
(defrule
	(unit-type-count-total villager > res-vills-a)
	(strategic-number sn-current-age >= imperial)
	(players-building-count target-player >= 1); test
;	(goal escrowing no); test
	(population >= del-civ-pop)
	(up-compare-goal excessWood >= 1800)
	(up-compare-goal excessFood >= 1800)
	(up-compare-goal excessGold >= 1800)
=>
	(delete-unit villager))
;=========================================================
;(defrule
;	(unit-type-count-total villager > res-vills-c); res-vills-d
;	(unit-type-count-total villager > 70); test1
;	(strategic-number sn-current-age >= imperial)
;	(population >= del-civ-pop)
;	(goal escrowing no); test
;(or	(unit-type-count-total villager > up-max-civ)
;	(and	(or	(players-building-type-count any-ally market >= 1)
;			(players-building-type-count any-ally dock >= 1))
;		(up-compare-goal tradeunits >= 30)))
;	(up-compare-goal excessWood >= 500)
;	(up-compare-goal excessFood >= 500)
;	(up-compare-goal excessGold >= 500)
;=>
;	(delete-unit villager))
;=========================================================
(defrule
	(unit-type-count-total villager > up-max-civ)
	(strategic-number sn-current-age >= imperial)
	(players-building-count target-player >= 1); test
	(goal escrowing no); test ; maybe add +underattack/attacking
	(population >= del-civ-pop)
	(up-compare-goal excessFood >= 400)
	(up-compare-goal excessWood >= 400)
	(up-compare-goal excessGold >= 400)
=>
	(delete-unit villager))
(defrule
	(up-compare-goal custom-civ-pop > up-max-civ);	(civilian-population > up-max-civ)
	(unit-type-count-total villager > min-number-vills)
	(strategic-number sn-current-age >= imperial)
	(players-building-count target-player >= 1); test
	(goal escrowing no); test ; maybe add +underattack/attacking
	(population >= del-civ-pop)
(or	(up-compare-goal excessFood >= 800)
(or	(up-compare-goal excessWood >= 800)
	(up-compare-goal excessGold >= 800)))
=>
	(delete-unit villager))
;=========================================================
(defrule
(or	(up-compare-goal siegereq != no)
(or	(unit-type-count-total bombard-cannon >= 8)
(or	(unit-type-count-total trebuchet-set >= 3)
(or	(unit-type-count-total battering-ram-line >= 5)
(or	(up-research-status c: imperial-age == research-pending)
(or	(up-compare-goal excessWood < 200)
(or	(up-compare-goal excessFood < 200)
	(up-compare-goal excessGold < 200))))))))
=>
	(up-jump-rule 1))
(defrule
	(timer-triggered MSuperiority); twentysec
	(unit-type-count villager > min-number-vills)
	(population >= max-pop)
	(goal attacking no)
	(goal underattack no)
	(strategic-number sn-current-age >= imperial)
	(goal researchplan yes)
	(players-building-count target-player >= 1); test
	(goal escrowing no); test
(or	(building-type-count castle >= 1)
	(building-type-count siege-workshop >= 1))
;(or
;	(civilian-population > res-vills-d))
=>
	(delete-unit villager)
	(chat-local-to-self "Deleting villager for siege.")
)
;=========================================================
(defrule
	(timer-triggered MSuperiority)
	(goal islands yes)
	(goal attacking yes)
	(unit-type-count-total fishing-ship < 2)
	(unit-type-count-total transport-ship < 1)
	(can-afford-unit transport-ship)
	(unit-type-count-total villager > 10)
(or	(unit-type-count-total villager > min-number-vills)
	(up-compare-goal excessFood >= 800))
	(population >= del-civ-pop)
	(can-train transport-ship); unit-available?
=>
	(delete-unit villager))
;=========================================================
(defrule
	(players-building-type-count every-ally market == 0)
(or	(players-population every-ally < up-max-civ)
	(not	(player-in-game any-ally)))
	(population >= del-civ-pop)
(or	(unit-type-count-total villager >= 1)
	(building-type-count-total town-center >= 1))
	(unit-type-count-total trade-cart > 0)
=>
	(delete-unit trade-cart))
;=========================================================
(defrule
; tl :<	(up-compare-goal excessGold > 200)
	(population >= del-civ-pop)
(or	(up-compare-goal excessGold > 5000)
(or	(up-compare-goal tradeunits > maxcartspop); depending on popcap and difficulty
	(up-compare-goal tradeunits > maxcartssize))); depending on map size
(or	(unit-type-count-total villager >= 1)
	(building-type-count-total town-center >= 1))
;	(up-compare-goal tradeunits > 75)
(or	(up-compare-goal tradeunits > 100)
(or	(up-compare-goal tradeunits > maxcartspop)
	(up-compare-goal tradeunits > maxcartssize)))
	(unit-type-count-total trade-cart > 0)
=>
	(delete-unit trade-cart))
;=========================================================
(defrule
	(players-building-type-count every-ally dock <= 0)
(or	(players-population every-ally < up-max-civ)
	(not	(player-in-game any-ally)))
	(population >= del-civ-pop)
(or	(unit-type-count-total villager >= 1)
	(building-type-count-total town-center >= 1))
	(unit-type-count-total trade-cog > 0)
=>
	(delete-unit trade-cog))
;=========================================================
(defrule
; tl :<	(up-compare-goal excessGold > 200)
	(population >= del-civ-pop)
(or	(up-compare-goal excessGold > 5000)
(or	(up-compare-goal tradeunits > maxcartspop); depending on popcap and difficulty
	(up-compare-goal tradeunits > maxcartssize))); depending on map size
(or	(unit-type-count-total villager >= 1)
	(building-type-count-total town-center >= 1))
;	(up-compare-goal tradeunits > 75)
(or	(up-compare-goal tradeunits > 100)
(or	(up-compare-goal tradeunits > maxcartspop)
	(up-compare-goal tradeunits > maxcartssize)))
	(unit-type-count-total trade-cog > 0)
=>
	(delete-unit trade-cog))
;=========================================================
(defrule
	(game-time >= 3300)
	(goal enemy-boats no)
	(goal islands no)
	(players-building-count any-enemy >= 1)
	(population >= del-civ-pop)
	(up-compare-goal excessWood >= 1800)
	(up-compare-goal excessFood >= 1800)
	(up-compare-goal excessGold >= 1800)
(or	(unit-type-count-total fire-ship-line >= 1)
	(unit-type-count-total galley-line >= 1))
=>
	(delete-unit demolition-ship-line)
	(delete-unit fire-ship-line)
	(delete-unit galley-line))
;=========================================================
(defrule
	(game-time >= 4500)
	(goal enemy-boats no)
	(goal islands no)
	(players-building-count any-enemy >= 1)
	(population >= del-civ-pop)
(or	(up-compare-goal excessWood >= 1800)
(or	(up-compare-goal excessFood >= 1800)
	(up-compare-goal excessGold >= 1800)))
(or	(unit-type-count-total fire-ship-line >= 1)
	(unit-type-count-total galley-line >= 1))
=>
	(delete-unit demolition-ship-line)
	(delete-unit fire-ship-line)
	(delete-unit galley-line))
;=========================================================
(defrule
	(game-time >= 3300)
	(goal fleet no)
	(goal islands no)
	(players-building-count any-enemy >= 1)
;	(population >= del-civ-pop)
	(up-compare-goal excessWood >= 1800)
	(up-compare-goal excessFood >= 1800)
	(up-compare-goal excessGold >= 1800)
(or	(unit-type-count-total fire-ship-line >= 1)
	(unit-type-count-total galley-line >= 1))
=>
	(delete-unit demolition-ship-line)
	(delete-unit fire-ship-line)
	(delete-unit galley-line))
;=========================================================
(defrule
	(game-time >= 4500)
;	(goal enemy-boats no)
	(up-compare-goal navycount g:> maxnavy)
	(soldier-count < 20)
	(players-building-count any-enemy >= 1)
	(population >= del-civ-pop)
(or	(up-compare-goal excessWood >= 1800)
(or	(up-compare-goal excessFood >= 1800)
	(up-compare-goal excessGold >= 1800)))
(or	(unit-type-count-total fire-ship-line >= 1)
	(unit-type-count-total galley-line >= 1))
=>
	(delete-unit demolition-ship-line)
	(delete-unit fire-ship-line)
	(delete-unit galley-line))
;=========================================================
(defrule
	(game-time >= 4500)
	(up-compare-goal navycount g:> maxnavy)
	(players-building-count any-enemy >= 1)
	(population >= del-civ-pop)
(or	(up-compare-goal excessWood >= 5000)
(or	(up-compare-goal excessFood >= 5000)
	(up-compare-goal excessGold >= 5000)))
(or	(unit-type-count-total fire-ship-line >= 1)
	(unit-type-count-total galley-line >= 1))
=>
	(delete-unit demolition-ship-line)
	(delete-unit fire-ship-line)
	(delete-unit galley-line))
;=========================================================
(defrule
(or	(up-compare-goal tradeunits >= 32)
(or	(up-compare-goal excessFood >= 1600)
	(and	(up-compare-goal excessWood >= 800)
		(up-compare-goal excessGold >= 800))))
	(up-compare-goal excessFood >= 800)
	(strategic-number sn-current-age >= imperial)
	(population >= del-civ-pop)
	(unit-type-count-total fishing-ship >= 1)
=>
	(delete-unit fishing-ship))
;=========================================================
(defrule
	(cc-players-unit-type-count 0 shore-fish-class <= 0)
	(cc-players-unit-type-count 0 ocean-fish-class <= 0)
(or	(population >= max-civ-pop); siege-pop
	(housing-headroom < 10))
	(unit-type-count-total fishing-ship >= 1)
=>
	(delete-unit fishing-ship))
;=========================================================
(defrule
	(goal attacking yes)
	(goal islands yes)
	(unit-type-count-total fishing-ship >= 1)
	(unit-type-count-total transport-ship < 1)
	(population >= del-civ-pop)
	(can-train transport-ship); unit-available?
=>
	(delete-unit fishing-ship))
#end-if


(defrule
	(goal traincart yes)
	(game-time < 2400)
(or	(unit-type-count-total 178 >= 3)
	(unit-type-count-total 205 >= 3))
	(strategic-number sn-current-age < imperial)
	(up-compare-goal strategy != sling)
	(up-compare-goal relic-count < 5)
	(gold-amount < imperial-gs)
	(gold-amount < 850)
	(dropsite-min-distance gold < 40)
	(dropsite-min-distance gold >= 0)
	(strategic-number sn-military-superiority < 0)
=>
	(set-goal traincart no))
(defrule
	(goal strategy stonewall)
	(up-compare-goal excessWood < 275)
	(building-type-count-total barracks < 6)
;	(up-research-status c: imperial-age >= research-pending)
(or	(goal traincart yes)
	(goal traincog yes))
=>
	(set-goal traincart no)
	(set-goal traincog no))

(defrule
	(goal traingalley yes)
	(up-research-status c: ri-galleon < research-available)
(or	(civ-selected aztec)
	(up-research-status c: ri-fast-fire-ship >= research-available))
	(up-research-status c: imperial-age >= research-pending)
=>
	(set-goal traingalley no)
	(set-goal trainfire yes))
#load-if-defined MAGYAR-CIV
(defrule
	(goal trainhussar yes)
	(up-research-status c: my-unique-unit-upgrade >= research-complete)
(or	(up-research-status c: ri-mercenaries >= research-pending)
	(up-compare-goal excessGold >= 10))
=>
	(set-goal trainhussar no)
	(set-goal trainunique yes))
#end-if
(defrule
(nor	(civ-selected saracen)
	(civ-selected indian))
=>
	(up-jump-rule 1))
(defrule
	(goal trainpike yes)
	(up-research-status c: imperial-age >= research-pending)
(or	(up-compare-goal excessGold >= 260)
(or	(unit-type-count villager-gold >= 12); 8
(or	(up-compare-goal tradeunits >= 30); 24
	(up-compare-goal relic-count >= 5)))); 4
	(building-type-count stable >= 3)
=>
	(set-goal trainpike no)
	(set-goal traincamel yes))
(defrule
	(civ-selected indian)
(or	(goal trainknight yes)
	(and	(strategic-number sn-current-age >= imperial)
		(and	(population < siege-pop)
			(and	(up-compare-goal excessGold >= 225)
				(strategic-number spears < 25)))))
=>
	(set-goal trainknight no)
	(set-goal traincamel yes))
#load-if-defined TURKISH-CIV
(defrule
; tl	(goal trainskirm yes)
(or	(up-compare-goal mangonel-set >= 2); 3
(or	(unit-type-count-total scorpion-line >= 3)
(or	(and	(or	(goal trainhussar yes)
			(goal trainknight yes))
		(up-research-status c: ri-chain-barding >= research-pending))
(or	(and	(goal trainunique yes)
		(up-research-status c: ri-leather-archer-armor >= research-pending))
	(up-research-status c: imperial-age >= research-pending)))))
=>
	(set-goal trainskirm no))
(defrule
	(goal trainpike yes)
	(current-age >= castle-age)
(or	(up-research-status c: imperial-age >= research-pending); disable here anyway
(or	(gold-amount >= 60)
(or	(unit-type-count villager-gold >= 3)
(or	(up-compare-goal tradeunits >= 8)
	(up-compare-goal relic-count >= 2)))))
;testpi	(building-type-count stable >= 1)
=>
	(set-goal trainpike no)
	(set-goal traincamel yes))
#end-if
#load-if-not-defined INDIAN-CIV
(defrule
	(goal traincamel yes)
	(unit-type-count-total camel-line >= 40)
	(up-research-status c: ri-imperial-camel <= research-unavailable)
	(population >= max-civ-pop)
	(population-cap <= 224)
=>
	(set-goal traincamel no))
#else
(defrule
	(goal trainpike yes)
	(up-research-status c: ri-imperial-camel >= research-pending); disable here anyway
	(up-compare-goal excessGold >= 260);	(up-compare-goal excessGold >= 60)
	(building-type-count stable >= 1)
=>
	(set-goal trainpike no)
	(set-goal traincamel yes))
#end-if
(defrule; testing
	(goal trainhussar yes)
	(up-research-status c: castle-age == research-available)
	(strategic-number sn-military-superiority >= 0); 1
(or	(players-current-age any-enemy >= castle-age)
	(strategic-number sn-military-superiority >= 1)); 2
(or	(current-age-time >= 270); 240
	(up-compare-goal strategy-type >= imperial-war))
(nand	(current-age-time < 420); 360 ; test
	(goal s-flush yes))
	(food-amount < 880)
	(goal attacking no); hmm
	(goal underattack no)
=>
	(set-goal trainhussar no))

#load-if-not-defined AZTEC-CIV
#load-if-not-defined CELTIC-CIV
#load-if-not-defined ETHIOPIAN-CIV
#load-if-not-defined KOREAN-CIV
#load-if-not-defined MALIAN-CIV
#load-if-not-defined MONGOL-CIV
#load-if-not-defined SARACEN-CIV
#load-if-not-defined SLAVIC-CIV
#load-if-not-defined TEUTONIC-CIV; non-SO civs
(defrule
	(goal trainmangonel yes)
	(up-research-status c: ri-heavy-scorpion >= research-pending)
;(or	(players-civ any-ally khmer)
	(up-research-status c: ri-onager < research-pending);)
;	(up-research-status c: ri-siege-onager < research-available)
=>
	(set-goal trainmangonel no)
	(set-goal trainscorpion yes))
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
(defrule
	(goal trainmangonel yes)
(not	(unit-available mangonel-line))
	(unit-available scorpion-line)
=>
	(set-goal trainmangonel no)
	(set-goal trainscorpion yes))
(defrule
	(goal trainscorpion yes)
(not	(unit-available scorpion-line))
	(unit-available mangonel-line)
=>
	(set-goal trainscorpion no)
	(set-goal trainmangonel yes))
(defrule
	(goal trainscorpion yes)
	(up-research-status c: ri-onager >= research-pending); siege
;	(wood-amount >= 160)
;	(gold-amount >= 135)
(or	(up-research-status c: ri-siege-onager >= research-pending)
	(up-research-status c: ri-heavy-scorpion < research-pending))
=>
	(set-goal trainscorpion no)
	(set-goal trainmangonel yes))
(defrule
	(goal trainscorpion yes)
	(up-research-status c: ri-onager >= research-available)
;	(wood-amount >= 160)
;	(gold-amount >= 135)
(or	(up-research-status c: ri-siege-onager >= research-pending)
	(up-research-status c: ri-heavy-scorpion < research-available))
=>
	(set-goal trainscorpion no)
	(set-goal trainmangonel yes))

#load-if-not-defined BERBERS-CIV
#load-if-not-defined BRITON-CIV
#load-if-not-defined BURMESE-CIV
#load-if-not-defined BYZANTINE-CIV
#load-if-not-defined CHINESE-CIV
#load-if-not-defined FRANKISH-CIV
#load-if-not-defined GOTHIC-CIV
#load-if-not-defined HUN-CIV
#load-if-not-defined INCAN-CIV
#load-if-not-defined INDIAN-CIV
#load-if-not-defined ITALIAN-CIV
#load-if-not-defined JAPANESE-CIV
#load-if-not-defined KHMER-CIV
#load-if-not-defined MAGYAR-CIV
#load-if-not-defined MALAY-CIV
#load-if-not-defined MAYAN-CIV
#load-if-not-defined PERSIAN-CIV
#load-if-not-defined PORTUGUESE-CIV
#load-if-not-defined SPANISH-CIV
#load-if-not-defined TURKISH-CIV
#load-if-not-defined VIETNAMESE-CIV ; Siege Onagers
#load-if-not-defined VIKING-CIV ; Aztecs, Celts, Koreans, Mongols, Saracens, Teutons, Slavs, Ethiopians, Malians
(defrule
	(goal trainscorpion yes)
; test	(up-research-status c: ri-onager >= research-available)
;	(wood-amount >= 160)
;	(gold-amount >= 135)
;(or
	(up-research-status c: ri-heavy-scorpion < research-pending)
;(or	(not	(players-civ any-ally khmer))
;	(up-research-status c: ri-heavy-scorpion < research-available))
;	(and	(food-amount >= 800)
;		(gold-amount >= 500)))
=>
	(set-goal trainscorpion no)
	(set-goal trainmangonel yes))
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if

(defrule
(or	(not	(unit-available bombard-cannon))
(or	(and	(goal trainmangonel yes)
		(up-research-status c: ri-onager >= research-available))
(or	(and	(goal trainscorpion yes)
		(up-research-status c: ri-heavy-scorpion >= research-available)); pending))
	(and	(up-compare-goal trainmangonel != yes)
		(up-compare-goal trainscorpion != yes)))))
=>
	(up-jump-rule 2))
(defrule
	(building-type-count siege-workshop >= 1)
	(current-age >= imperial-age)
	(unit-type-count-total bombard-cannon < 12)
=>
	(set-goal trainbombard yes))
(defrule
	(building-type-count siege-workshop >= 1)
	(current-age >= imperial-age)
(or	(goal trainbombard yes)
	(unit-type-count-total bombard-cannon >= 12))
=>
	(set-goal trainscorpion no)
	(set-goal trainmangonel no)); end jump

#load-if-defined HUN-CIV
#end-if
#load-if-defined TURKISH-CIV
#end-if
(defrule
	(goal trainmangonel yes)
(or	(civ-selected turkish)
	(civ-selected hun))
;	(players-current-age focus-player >= imperial-age)
	(strategic-number sn-current-age >= imperial)
	(up-research-status c: imperial-age >= research-available);
=>
	(set-goal trainmangonel no))
(defrule
	(goal trainram yes)
	(up-research-status c: ri-siege-ram <= research-available); un
(or	(players-building-type-count focus-player castle > 0)
(or	(players-building-type-count focus-player bombard-tower > 0)
	(players-building-type-count focus-player watch-tower > 1)))
	(unit-type-count-total trebuchet-set < 2)
	(unit-type-count-total bombard-cannon < 10)
	(unit-available trebuchet)
=>
	(set-goal traintrebuchet yes)
	(set-goal trainram no))
(defrule
	(goal trainram yes)
	(up-compare-goal traintrebuchet != yes)
	(up-compare-goal mangonel-set >= 9); 7; -total?
	(unit-type-count-total trebuchet-set < 5)
	(unit-type-count-total bombard-cannon < 10); 12
	(unit-available trebuchet)
=>
	(set-goal traintrebuchet yes))
(defrule
	(goal trainram yes)
	(up-compare-goal mangonel-set >= 9); 7; -total?
(or	(unit-type-count-total trebuchet-set >= 4)
	(unit-type-count-total bombard-cannon >= 10))
=>
	(set-goal siegereq yes)
	(set-goal trainram no))


#load-if-not-defined INCAN-CIV
;#load-if-not-defined INDIAN-CIV ; exception
#load-if-not-defined ITALIAN-CIV
#load-if-not-defined MAGYAR-CIV
#load-if-not-defined AZTEC-CIV
#load-if-not-defined BRITON-CIV
#load-if-not-defined BYZANTINE-CIV
#load-if-not-defined CHINESE-CIV
#load-if-not-defined ETHIOPIAN-CIV
#load-if-not-defined JAPANESE-CIV
#load-if-not-defined KOREAN-CIV
#load-if-not-defined MALAY-CIV
#load-if-not-defined MALIAN-CIV
#load-if-not-defined MAYAN-CIV
#load-if-not-defined MONGOL-CIV
#load-if-not-defined PORTUGUESE-CIV
#load-if-not-defined SARACEN-CIV
#load-if-not-defined SPANISH-CIV
#load-if-not-defined VIETNAMESE-CIV
#load-if-not-defined VIKING-CIV; no arbs
(defrule
(or	(and	(up-research-status c: ri-bodkin-arrow >= research-pending)
		(up-research-status c: ri-crossbow >= research-pending))
(or	(up-compare-goal trainarcher != yes)
(or	(up-compare-goal position-goal != pocket)
	(up-compare-goal targetdistance < 45))))
=>
	(up-jump-rule 2))
(defrule
(or	(goal underattack yes)
(or	(strategic-number sn-military-superiority <= -3); test
(or	(unit-type-count-total archer-line >= 5)
	(strategic-number infantry >= 33)))); 25
(or	(up-compare-goal targetdistance < 45)
	(strategic-number sn-current-age >= imperial))
=>
	(up-jump-rule 1))
(defrule
	(goal milunits yes);(goal strategy usual)
(nand	(strategic-number spears >= 15); 15
	(or	(unit-type-count cavalry-class >= 10); 12
		(and	(strategic-number spears >= 20); 25
			(and	(strategic-number sn-current-age >= imperial)
				(or	(goal palagoal yes)
					(and	(goal uugoal yes)
						(up-compare-const uu-type == cavalry-uu)))))))
	(goal attacking no)
=>
	(set-goal trainarcher no)); end jump
(defrule
	(goal trainarcher yes)
(or	(unit-type-count-total scorpion-line >= 9); 10
	(up-compare-goal mangonel-set >= 6))
=>
	(set-goal trainarcher no))
#end-if
;#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
(defrule
	(goal trainarcher yes)
(or	(civ-selected celtic)
(or	(civ-selected gothic)
(or	(goal palagoal yes)
	(civ-selected turkish))))
	(up-research-status c: imperial-age >= research-pending)
=>
	(set-goal trainarcher no))
(defrule
	(goal trainarcher yes)
	(goal milunits yes);(goal strategy usual)
(or	(civ-selected celtic)
(or	(civ-selected gothic)
(or	(goal palagoal yes)
	(civ-selected turkish))))
	(current-age >= castle-age)
	(unit-type-count-total archer-line < 5)
	(building-type-count-total stable >= 1)
	(strategic-number spears < 9)
	(goal underattack no)
	(strategic-number sn-military-superiority >= -1)
=>
	(set-goal trainarcher no))
(defrule
	(goal trainarcher yes)
	(up-research-status c: ri-arbalest <= research-unavailable)
	(unit-available hand-cannoneer)
=>
	(set-goal trainarcher no)
	(set-goal trainhandcannon yes))
(defrule
	(goal trainarcher yes)
	(goal traincavarcher yes)
	(up-research-status c: ri-arbalest < research-pending)
=>
	(set-goal trainarcher no))


(defrule
(or	(up-compare-goal uugoal != yes)
(or	(goal underattack yes)
(or	(and	(goal position-goal flank)
		(strategic-number sn-military-superiority <= -1))
(or	(up-compare-goal milunits != yes)
	(and	(up-compare-const uu-type != archer-uu)
		(up-compare-const uu-type != powder-uu))))))
=>
	(up-jump-rule 1))
(defrule
	(strategic-number infantry < 25)
	(unit-type-count-total archer-line < 5)
(or	(building-type-count castle >= 2)
(or	(up-research-status c: imperial-age == research-pending)
(or	(and	(current-age >= imperial-age)
		(current-age-time < 60))
	(and	(up-research-status c: imperial-age >= research-pending)
		(building-type-count castle >= 1)))))
=>
	(set-goal temporary-goal 4294))
(defrule
(or	(strategic-number husks < 5)
	(up-compare-const uu-type == powder-uu))
(or	(goal temporary-goal 4294)
(or	(building-type-count castle >= 3)
	(and	(population >= max-civ-pop)
		(and	(building-type-count castle >= 2)
			(building-type-count-total castle >= 3)))))
=>
	(set-goal trainarcher no)
	(set-goal traincavarcher no)
	(set-goal trainhandcannon no))

#load-if-defined IMPERIAL-AGE-END
(defrule
	(up-research-status c: imperial-age <= research-available)
	(goal position-goal pocket)
;	(goal defend no)
	(goal underattack no)
	(up-compare-goal targetdistance >= 45)
	(strategic-number sn-military-superiority >= -2)
	(player-in-game every-ally)
(or	(and	(goal trainunique yes)
		(unit-available my-unique-unit-line))
	(and	(goal trainknight yes)
		(unit-available knight-line)))
=>
	(set-goal trainarcher no)
	(set-goal trainhussar no)
	(set-goal trainskirm no))
#end-if

(defrule
(or	(up-compare-goal milunits != yes)
(or	(up-compare-goal uugoal != yes)
(or	(strategic-number eagles >= 10)
(or	(up-compare-goal underattack != no)
	(unit-type-count-total militiaman >= 5)))))
=>
	(up-jump-rule 3))
(defrule
	(up-compare-const uu-type != infantry-uu)
(nor	(civ-selected gothic)
(or	(civ-selected aztec)
(or	(civ-selected frankish)
(or	(civ-selected malay)
	(civ-selected malian)))))
=>
	(up-jump-rule 2))
(defrule
(or	(building-type-count castle >= 2)
(or	(up-research-status c: imperial-age == research-pending)
(or	(and	(current-age >= imperial-age)
		(current-age-time < 60))
	(and	(up-research-status c: imperial-age >= research-pending)
		(building-type-count castle >= 1)))))
=>
	(set-goal trainchamp no))
(defrule
	(goal trainunique yes)
(or	(building-type-count castle >= 3)
	(and	(population >= max-civ-pop)
		(and	(building-type-count castle >= 2)
			(building-type-count-total castle >= 3))))
=>
	(set-goal trainchamp no)); end jump

(defrule; testing
	(goal trainskirm yes)
	(up-research-status c: castle-age == research-available)
	(strategic-number sn-military-superiority >= 0); 1
(or	(players-current-age any-enemy >= castle-age)
	(strategic-number sn-military-superiority >= 1)); 2
(or	(current-age-time >= 270); 240
	(up-compare-goal strategy-type >= imperial-war))
(nand	(current-age-time < 420); 360 ; test
	(goal sk-var yes))
	(food-amount < 835)
	(goal attacking no); hmm
	(goal underattack no)
=>
	(set-goal trainskirm no))
(defrule
	(goal trainskirm yes)
(or	(up-compare-goal enemy-goal2 == klew) ; klew => meso => no spears anyway => no need to disable them here
	(strategic-number eagles >= 7))
(or	(up-compare-goal excessGold >= 250)
(or	(up-compare-goal strategy != r-flush)
	(strategic-number sn-current-age <= feudal)))
	(strategic-number archers <= 3)
=>
	(set-goal trainskirm no))

(defrule
(or	(up-compare-goal milunits != yes);	(up-compare-goal strategy != usual)
(or	(not	(player-in-game any-ally))
	(and	(cc-players-unit-type-count 0 gold-mine <= 0)
		(and	(up-compare-goal excessGold < 250)
			(and	(up-compare-goal tradeunits <= 0)
;				(and
	(up-compare-goal relic-count <= 0)
;					(unit-type-count villager-gold <= 0))
)))))
=>
	(set-goal allowskirms yes)
	(up-jump-rule 6))
(defrule
(or	(up-compare-goal trainskirm != yes)
(or	(up-compare-goal position-goal != pocket)
	(and	(up-compare-goal excessGold < 200); (gold-amount
		(and	(up-compare-goal tradeunits < 12)
			(and	(up-compare-goal relic-count < 2)
				(and	(unit-type-count villager-gold < 6)
					(population < del-civ-pop)))))))
	(strategic-number sn-current-age >= imperial)
=>
	(up-jump-rule 5))
(defrule
(or	(goal underattack yes)
(or	(strategic-number sn-military-superiority <= -3); test
(or	(and	(up-research-status c: ri-bodkin-arrow >= research-pending)
		(up-research-status c: ri-elite-skirmisher >= research-pending))
(or	(up-compare-goal skirmisher-set >= 5)
	(strategic-number archers >= 45))))); 42
(or	(up-compare-goal targetdistance < 45)
	(strategic-number sn-current-age >= imperial))
=>
	(up-jump-rule 4))
(defrule
(or	(up-research-status c: imperial-age == research-pending)
	(and	(current-age >= imperial-age)
		(current-age-time < 10)))
(or	(up-compare-goal relic-count >= 5)
(or	(up-compare-goal excessGold >= 200)
(or	(unit-type-count villager-gold >= 6)
	(up-compare-goal tradeunits >= 18))))
	(strategic-number archers < 36); 33
	(goal attacking no)
=>
	(set-goal trainskirm no))
(defrule; test
	(strategic-number sn-current-age <= castlea)
	(current-age == castle-age)
	(up-research-status c: imperial-age <= research-available)
	(food-amount < 1225); 1125
	(up-compare-goal targetdistance >= 45)
(or	(unit-type-count-total knight-line >= 12); 7
(or	(strategic-number archers < 36); 33
(or	(goal attacking no)
	(up-compare-flag escrow-flag == 2))))
=>
	(set-goal trainskirm no))
(defrule
	(civ-selected gothic)
	(strategic-number gunpowder >= 15)
(or	(building-type-count-total siege-workshop <= 0); -total
(or	(not	(unit-available mangonel-line))
(or	(up-compare-goal trainmangonel != yes)
	(up-compare-goal excessGold < mangonel-gcost))))
=>
	(up-jump-rule 1))
(defrule
(or	(civ-selected celtic)
(or	(civ-selected gothic)
	(goal palagoal yes)))
	(up-research-status c: imperial-age >= research-pending)
(or	(current-age <= castle-age)
	(current-age-time < 300))
(or	(up-compare-goal excessGold >= 200)
(or	(unit-type-count villager-gold >= 6)
	(up-compare-goal tradeunits >= 18)))
=>
	(set-goal trainskirm no)); end jump

#load-if-defined GOTHIC-CIV
(defrule
	(goal milunits yes);(goal strategy usual)
	(building-type-count-total castle >= 1)
	(goal uugoal yes)
	(current-age >= castle-age)
	(up-compare-goal skirmisher-set < 5)
	(up-gaia-type-count c: gold >= 3)
	(strategic-number archers < 60)
(or	(goal underattack no)
	(building-type-count castle >= 1))
(or	(up-compare-goal excessGold >= 250);	(gold-amount >= 250); 200
(or	(unit-type-count villager-gold >= 9)
	(up-compare-goal tradeunits >= 27))); 33
=>
	(set-goal trainskirm no))
#end-if

#load-if-not-defined WONDER-RACE
#load-if-defined UP-ALLY-IN-GAME;
(defrule
(or	(up-research-status c: imperial-age == research-pending)
	(and	(current-age >= imperial-age)
		(current-age-time < 180)))
(or	(goal palagoal yes)
	(and	(goal uugoal yes)
		(up-compare-const uu-type == cavalry-uu)))
	(population < eightyp-pop);	(civilian-population < eightyp-pop);	(up-compare-goal custom-civ-pop < eightyp-pop)
	(up-compare-goal custom-civ-pop < 140);	(civilian-population < 140)
	(up-research-status c: ri-paladin <= research-available)
	(up-research-status c: my-unique-unit-upgrade <= research-available)
	(goal underattack no)
;	(strategic-number sn-current-age >= imperial)
=>
	(up-jump-rule 1))
#end-if
(defrule
	(goal trainvillager yes)
(or	(civilian-population >= up-max-civ)
	(and	(up-compare-goal custom-civ-pop >= up-max-civ)
		(unit-type-count-total villager >= 10)))
	(unit-type-count-total villager >= 2)
=>
	(set-goal trainvillager no))
(defrule
	(goal trainvillager yes)
(or	(population >= del-civ-pop)
	(and	(population >= max-civ-pop)
		(unit-type-count-total villager >= min-number-vills))); hmm
	(unit-type-count-total villager >= 2)
=>
	(set-goal trainvillager no))
#end-if

(defrule
	(strategic-number sn-current-age >= imperial)
	(population < max-civ-pop)
	(civilian-population < up-max-civ)
	(up-compare-flag escrow-flag != 16)
	(up-compare-flag escrow-flag != 32)
	(up-compare-flag escrow-flag2 != 1)
	(up-compare-flag escrow-flag2 != 2)
	(up-compare-flag escrow-flag2 != 4)
	(up-compare-flag escrow-flag2 != 8)
	(goal underattack no)
(or	(up-compare-goal relocating >= yes)
	(strategic-number sn-military-superiority >= -1))
=>
	(set-goal escrow-state with-escrow)
	(up-jump-rule 2))
(defrule
	(unit-type-count-total villager < min-number-vills)
	(up-compare-flag escrow-flag != 1)
	(up-compare-flag escrow-flag != 2)
	(up-compare-flag escrow-flag != 16)
	(up-compare-flag escrow-flag != 32)
	(up-compare-flag escrow-flag2 != 1)
	(up-compare-flag escrow-flag2 != 2)
	(up-compare-flag escrow-flag2 != 4)
	(up-compare-flag escrow-flag2 != 8)
	(goal underattack no)
(or	(up-compare-goal relocating >= yes)
	(strategic-number sn-military-superiority >= -1))
=>
	(set-goal escrow-state with-escrow)
	(up-jump-rule 1))
(defrule
	(true)
=>
	(set-goal escrow-state without-escrow))























(defrule
	(goal traintransport yes)
	(can-train transport-ship)
=>
	(train transport-ship))
(defrule
	(goal trainvillager yes)
	(current-age >= feudal-age);	(strategic-number sn-current-age >= feudal)
	(up-can-train escrow-state c: villager)
=>
	(disable-timer FDrop)(enable-timer FDrop ffdrop)
	(up-train escrow-state c: villager))
(defrule
	(goal trainvillager yes)
	(current-age <= dark-age);	(strategic-number sn-current-age <= dfeudal)
(or	(up-pending-objects c: villager <= 0)
	(building-type-count town-center >= 2))
	(up-can-train escrow-state c: villager)
=>
	(set-goal feudalvills 0)(enable-timer FDrop 21)
	(up-train escrow-state c: villager))
(defrule
	(goal trainvillager yes)
	(current-age <= dark-age);	(strategic-number sn-current-age <= dfeudal)
	(up-pending-objects c: villager >= 1)
	(building-type-count town-center <= 1)
	(up-compare-goal feudalvills <= 2)
	(up-can-train escrow-state c: villager)
=>
	(up-modify-goal feudalvills c:+ 1)(enable-timer FDrop 21);(enable-timer FDrop 24)
	(up-train escrow-state c: villager))
(defrule
	(goal trainvillager yes)
	(current-age <= dark-age);	(strategic-number sn-current-age <= dfeudal)
	(up-pending-objects c: villager >= 1)
	(building-type-count town-center <= 1)
	(up-compare-goal feudalvills >= 3)
	(up-can-train escrow-state c: villager)
=>
	(up-modify-goal feudalvills c:- 3)(enable-timer FDrop 21);(enable-timer FDrop 25)
	(up-train escrow-state c: villager))
(defrule
	(goal traincannon yes)
	(can-train cannon-galleon-line)
=>
	(train cannon-galleon-line))
(defrule
	(goal traintrebuchet yes)
	(can-train trebuchet)
=>
	(train trebuchet))
(defrule
	(goal trainbombard yes)
	(can-train bombard-cannon)
=>
	(train bombard-cannon))
(defrule
	(goal trainram yes)
	(can-train battering-ram-line)
=>
	(train battering-ram-line))
(defrule
	(goal traincart yes)
	(goal siegereq yes)
	(can-train trade-cart)
=>
	(train trade-cart))
(defrule
	(goal traincog yes)
	(goal siegereq yes)
	(can-train trade-cog)
=>
	(train trade-cog))
(defrule
	(civ-selected gothic)
	(goal trainunique yes)
	(goal siegereq yes)
	(can-train b-husk-line)
=>
	(train b-husk-line))
(defrule
	(goal trainunique yes)
	(goal siegereq yes)
	(can-train my-unique-unit-line)
=>
	(train my-unique-unit-line))
#load-if-defined UP-GAME-WK
(defrule
	(unit-type-count-total monk-set >= 1)
	(unit-type-count-total missionary < 2)
	(up-research-status c: ri-bloodlines >= research-pending)
	(goal trainmonk yes)
	(goal siegereq yes)
	(can-train missionary)
=>
	(train missionary))
#end-if
(defrule
	(goal trainmonk yes)
	(goal siegereq yes)
	(can-train monk)
=>
	(train monk))
(defrule
	(goal trainfish yes)
	(goal siegereq yes)
	(can-train fishing-ship)
=>
	(train fishing-ship))
(defrule
	(goal trainmangonel yes)
	(goal siegereq yes)
	(can-train mangonel-line)
=>
	(train mangonel-line))
(defrule
	(goal trainscorpion yes)
	(goal siegereq yes)
	(can-train scorpion-line)
=>
	(train scorpion-line))
(defrule
	(goal trainknight yes)
	(goal siegereq yes)
	(can-train knight-line)
=>
	(train knight-line))
(defrule
	(goal trainchamp yes)
	(goal siegereq yes)
	(can-train militiaman-line)
=>
	(train militiaman-line))
(defrule
	(goal trainhandcannon yes)
	(goal siegereq yes)
	(can-train hand-cannoneer)
=>
	(train hand-cannoneer))
(defrule
	(goal trainarcher yes)
	(goal siegereq yes)
	(can-train archer-line)
=>
	(train archer-line))
(defrule
	(goal traincavarcher yes)
	(goal siegereq yes)
	(can-train cavalry-archer-line)
=>
	(train cavalry-archer-line))
(defrule
	(goal trainpetard yes)
	(can-train petard)
=>
	(train petard))
(defrule
	(goal traineagle yes)
	(goal siegereq yes)
(or	(can-train eagle-warrior-line)
	(can-train heavy-eagle-warrior))
=>
	(train eagle-warrior-line)
	(train heavy-eagle-warrior))
#load-if-defined UP-GAME-WK
(defrule
	(goal trainbattle yes)
	(goal siegereq yes)
	(can-train battle-elephant)
=>
	(train battle-elephant))
#end-if
(defrule
	(goal trainhussar yes)
	(goal siegereq yes)
	(can-train scout-cavalry-line)
=>
	(train scout-cavalry-line))
#load-if-defined UP-GAME-WK
(defrule
	(goal trainslinger yes)
	(goal siegereq yes)
	(can-train slinger)
=>
	(train slinger))
#end-if
(defrule
	(goal trainpike yes)
	(goal siegereq yes)
	(goal allowspears yes);
	(can-train spearman-line)
=>
	(train spearman-line))
(defrule
	(goal traincondottiero yes)
	(goal siegereq yes)
	(can-train condottiero)
=>
	(train condottiero))
(defrule
	(goal traincamel yes)
	(goal siegereq yes)
(or	(can-train camel-line)
	(can-train imperial-camel))
=>
	(train camel-line)
	(train imperial-camel))
(defrule
	(goal trainskirm yes)
	(goal siegereq yes)
	(goal allowskirms yes)
(or	(can-train skirmisher-line)
	(can-train imperial-skirmisher))
=>
	(train skirmisher-line)
	(train imperial-skirmisher))
#load-if-defined UP-GAME-WK
(defrule
	(goal traincondo yes)
	(goal siegereq yes)
	(can-train condottiero)
=>
	(train condottiero))
(defrule
	(goal traingenitour yes)
	(goal siegereq yes)
	(goal allowskirms yes)
	(can-train 732)
=>
	(train 732))
#end-if
(defrule
	(goal traindemo yes)
	(goal siegereq yes)
	(can-train demolition-ship-line)
=>
	(train demolition-ship-line))
(defrule
	(goal trainturtle yes)
	(goal siegereq yes)
(or	(goal siegereq yes)
	(unit-type-count-total cannon-galleon-line >= 4))
	(can-train turtle-ship-line)
=>
	(train turtle-ship-line))
(defrule
	(goal trainlongboat yes)
(or	(goal siegereq yes)
	(unit-type-count-total cannon-galleon-line >= 4))
	(can-train longboat-line)
=>
	(train longboat-line))
(defrule
	(goal traincaravel yes)
(or	(goal siegereq yes)
	(unit-type-count-total cannon-galleon-line >= 4))
	(can-train caravel)
=>
	(train caravel))
(defrule
	(goal trainfire yes)
	(goal siegereq yes)
	(can-train fire-ship-line)
=>
	(train fire-ship-line))
(defrule
	(goal traingalley yes)
(or	(goal siegereq yes)
	(unit-type-count-total cannon-galleon-line >= 4))
	(can-train galley-line)
=>
	(train galley-line))


#load-if-defined POST-IMPERIAL-AGE-START
#load-if-defined DEATH-MATCH
(defrule; lowest priority
(or	(and	(game-time < 240)
		(strategic-number sn-military-superiority < 3))
	(and	(game-time < 300)
		(strategic-number sn-military-superiority < 1)))
	(can-train dm-unit)
=>
	(train dm-unit))
#end-if
#end-if